<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Insee, Département des Méthodes Statistiques">

<title>Appliquer le Target Record Swapping – La protection des données statistiques publiques</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ee2342c85b385a9f1e4dcc5adf89ea0a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-b57ea8551da85a3f5a419d309197adda.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-ee2342c85b385a9f1e4dcc5adf89ea0a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">La protection des données statistiques publiques</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../theorie/index.html"> 
<span class="menu-text">Un peu de théorie</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pratique/index.html"> 
<span class="menu-text">En pratique</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">À propos</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Basculer le mode sombre"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#objectif" id="toc-objectif" class="nav-link active" data-scroll-target="#objectif">Objectif:</a></li>
  <li><a href="#rappels-sur-la-méthode" id="toc-rappels-sur-la-méthode" class="nav-link" data-scroll-target="#rappels-sur-la-méthode">Rappels sur la méthode:</a>
  <ul class="collapse">
  <li><a href="#en-quoi-consiste-la-méthode" id="toc-en-quoi-consiste-la-méthode" class="nav-link" data-scroll-target="#en-quoi-consiste-la-méthode">En quoi consiste la méthode ?</a></li>
  <li><a href="#les-variables-de-similarité" id="toc-les-variables-de-similarité" class="nav-link" data-scroll-target="#les-variables-de-similarité">Les variables de similarité</a>
  <ul class="collapse">
  <li><a href="#comment-définir-des-individus-similaires" id="toc-comment-définir-des-individus-similaires" class="nav-link" data-scroll-target="#comment-définir-des-individus-similaires">Comment définir des individus similaires ?</a></li>
  <li><a href="#individus-ou-ménages" id="toc-individus-ou-ménages" class="nav-link" data-scroll-target="#individus-ou-ménages">Individus ou ménages ?</a></li>
  <li><a href="#le-taux-de-swapping" id="toc-le-taux-de-swapping" class="nav-link" data-scroll-target="#le-taux-de-swapping">Le taux de <em>swapping</em></a></li>
  </ul></li>
  <li><a href="#les-grandes-étapes-à-suivre-pour-appliquer-le-trs" id="toc-les-grandes-étapes-à-suivre-pour-appliquer-le-trs" class="nav-link" data-scroll-target="#les-grandes-étapes-à-suivre-pour-appliquer-le-trs">Les grandes étapes à suivre pour appliquer le <code>TRS</code></a></li>
  </ul></li>
  <li><a href="#en-pratique" id="toc-en-pratique" class="nav-link" data-scroll-target="#en-pratique">En pratique</a>
  <ul class="collapse">
  <li><a href="#les-packages" id="toc-les-packages" class="nav-link" data-scroll-target="#les-packages">Les packages</a></li>
  <li><a href="#les-données" id="toc-les-données" class="nav-link" data-scroll-target="#les-données">Les données</a></li>
  <li><a href="#mesurons-les-risques-du-fichier" id="toc-mesurons-les-risques-du-fichier" class="nav-link" data-scroll-target="#mesurons-les-risques-du-fichier">Mesurons les risques du fichier</a>
  <ul class="collapse">
  <li><a href="#les-types-de-variables" id="toc-les-types-de-variables" class="nav-link" data-scroll-target="#les-types-de-variables">Les types de variables</a></li>
  </ul></li>
  <li><a href="#préparation-pour-le-swapping" id="toc-préparation-pour-le-swapping" class="nav-link" data-scroll-target="#préparation-pour-le-swapping">Préparation pour le swapping</a></li>
  <li><a href="#swapper-les-individus" id="toc-swapper-les-individus" class="nav-link" data-scroll-target="#swapper-les-individus">Swapper les individus</a></li>
  <li><a href="#la-base-après-swapping" id="toc-la-base-après-swapping" class="nav-link" data-scroll-target="#la-base-après-swapping">La base après swapping</a>
  <ul class="collapse">
  <li><a href="#un-exemple-déchange" id="toc-un-exemple-déchange" class="nav-link" data-scroll-target="#un-exemple-déchange">Un exemple d’échange</a></li>
  <li><a href="#echanges-selon-lordre-des-priorités-de-similarité" id="toc-echanges-selon-lordre-des-priorités-de-similarité" class="nav-link" data-scroll-target="#echanges-selon-lordre-des-priorités-de-similarité">Echanges selon l’ordre des priorités de similarité</a></li>
  </ul></li>
  <li><a href="#echanger-les-ménages" id="toc-echanger-les-ménages" class="nav-link" data-scroll-target="#echanger-les-ménages">Echanger les ménages</a>
  <ul class="collapse">
  <li><a href="#taux-de-swapping-observé" id="toc-taux-de-swapping-observé" class="nav-link" data-scroll-target="#taux-de-swapping-observé">Taux de swapping observé</a></li>
  </ul></li>
  <li><a href="#mesurer-la-perte-dutilité" id="toc-mesurer-la-perte-dutilité" class="nav-link" data-scroll-target="#mesurer-la-perte-dutilité">Mesurer la perte d’utilité</a>
  <ul class="collapse">
  <li><a href="#robustesse-de-certains-comptages" id="toc-robustesse-de-certains-comptages" class="nav-link" data-scroll-target="#robustesse-de-certains-comptages">Robustesse de certains comptages</a></li>
  <li><a href="#analyse-statistique" id="toc-analyse-statistique" class="nav-link" data-scroll-target="#analyse-statistique">Analyse statistique</a></li>
  </ul></li>
  <li><a href="#exercice" id="toc-exercice" class="nav-link" data-scroll-target="#exercice">Exercice</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Appliquer le Target Record Swapping</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Montrer tout le code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Cacher tout le code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Voir les sources</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Auteur·rice</div>
    <div class="quarto-title-meta-contents">
             <p>Insee, Département des Méthodes Statistiques </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="objectif" class="level1">
<h1>Objectif:</h1>
<p>La fiche pratique présente comment appliquer le <code>Target Record Swapping</code> à un jeu de données individuelles afin d’assurer une protection optimale des informations confidentielles des individus (ou ménages ou entreprises) qui le composent.</p>
<p>La première partie s’attache à présenter les différentes étapes à suivre pour que cette application soit pertinente au regard des données utilisées.</p>
<p>La seconde partie montre comment utiliser la fonction <code>sdcMicro::recordSwap()</code> pour appliquer la méthode à un jeu de données dont on aura repérer les individus à risque préalablement.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Pour s’exercer
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour reproduire les résultats et réaliser les exercices, il est possible de travailler directement sur le <a href="datalab.sspcloud.fr"><code>datalab</code> de l’Insee</a>. Si vous disposez d’un compte, vous pouvez <a href="https://datalab.sspcloud.fr/launcher/ide/rstudio?name=rstudio-formation-protection&amp;version=2.3.1&amp;s3=region-ec97c721&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2FInseeFrLab%2Fformation_protection_donnees%2Frefs%2Fheads%2Fmain%2Finit-scripts%2Frstudio.sh»">Ouvrir un service RStudio</a> ou <a href="https://datalab.sspcloud.fr/launcher/ide/vscode-r-python-julia?name=vscode-formation-protection&amp;version=2.3.5&amp;s3=region-ec97c721&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2FInseeFrLab%2Fformation_protection_donnees%2Frefs%2Fheads%2Fmain%2Finit-scripts%2Fvscode-r-python.sh»">Ouvrir un service vscode R-Python</a>, à votre convenance. Ces services installeront automatiquement les packages nécessaires pour réaliser les exercices de l’ensemble des fiches pratiques.</p>
</div>
</div>
</section>
<section id="rappels-sur-la-méthode" class="level1 page-columns page-full">
<h1>Rappels sur la méthode:</h1>
<p>Le <code>Target Record Swapping (TRS)</code> est une méthode s’appliquant directement sur un jeu de données individuelles pour réduire principalement les risques de ré-identification. Il ciblera donc les individus pour lesquels ce risque est jugé trop élevé, c’est-à-dire<br>
ceux partageant des caractéristiques trop rares sur un ensemble de variables dites quasi-identifiantes. Les variables quasi-identifiantes sont celles qui sont susceptibles d’être déjà publiques ou du moins à la disposition d’un attaquant.</p>
<p>D’où son nom: le <em>swapping</em>, c’est-à-dire l’échange, va concerner des unités de la base (les <em>records</em>) détectés à l’avance, devenant ainsi les cibles (<em>target</em>) sur lesquelles on va se concentrer.</p>
<p>Bien qu’elle soit appliquée sur des microdonnées, la méthode a principalement vocation à protéger la diffusion de données tabulées <span class="citation" data-cites="hundepool_handbook_2024">(<a href="#ref-hundepool_handbook_2024" role="doc-biblioref">Hundepool et al. 2024, section 5.6</a>)</span>. Dans ce type d’utilisation, en tant que méthode pré-tabulée, elle permet de produire des tableaux parfaitement additifs.</p>
<div class="no-row-height column-margin column-container"><div id="ref-hundepool_handbook_2024" class="csl-entry" role="listitem">
Hundepool, Anco, Josep Domingo-Ferre, Luisa Franconi, Sarah Giessing, Rainer Lenz, Jane Longhurst, Eric Schulte Nordholt, et al. 2024. <em>Handbook on <span>Statistical</span> <span>Disclosure</span> <span>Control</span></em>. 2nd Edition. ESSNet SDC. <a href="https://sdctools.github.io/HandbookSDC/">https://sdctools.github.io/HandbookSDC/</a>.
</div></div><section id="en-quoi-consiste-la-méthode" class="level2">
<h2 class="anchored" data-anchor-id="en-quoi-consiste-la-méthode">En quoi consiste la méthode ?</h2>
<p>Après avoir détecté un individu dont le risque de ré-identification est jugé trop élevé, un autre individu est tiré aléatoirement parmi les individus au risque de ré-identification les plus faibles et certaines des caractéristiques de ces deux individus sont échangées (<em>swapped</em>).</p>
<p>Après l’échange, la ré-identification de l’individu est rendue beaucoup plus difficile et ne permet plus d’obtenir d’informations pertinentes à son sujet.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Un exemple très simple.
</div>
</div>
<div class="callout-body-container callout-body">
<p>Soit un territoire donné découpé en six zones où résident un certain nombre d’individus. Avec les informations disponibles à leur sujet, on considère qu’un seul individu a un risque de ré-identification trop élevé (croix rouge sur la <a href="#fig-swap-avant" class="quarto-xref">Figure&nbsp;1</a>).</p>
<div id="fig-swap-avant" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-swap-avant-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/swapping-exemple-avant.png" class="img-fluid figure-img"></p>
<figcaption>Avant swapping</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-swap-avant-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
<p>On tire alors au hasard un autre individu présent sur le territoire pour échanger certaines de leurs caractéristiques. Ce tirage pourrait être purement aléatoire. Mais, cela conduirait à détruire certaines statistiques bien utiles. Par exemple, en trouvant un individu d’une autre zone partageant certaines caractéristiques (par exemple le sexe, l’âge et la catégorie sociale, <a href="#fig-swap-apres" class="quarto-xref">Figure&nbsp;2</a>), on s’assure de conserver les marges sur ces variables au niveau géographique le plus fin.</p>
<p>En revanche, les autres caractéristiques sont bruitées de façon non contrôlée.</p>
<div id="fig-swap-apres" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-swap-apres-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/swapping-exemple-après.png" class="img-fluid figure-img"></p>
<figcaption>Après swapping</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-swap-apres-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption>
</figure>
</div>
<p>Ainsi, l’éventuelle ré-identification de l’individu à risque ne pourrait conduire l’attaquant qu’à obtenir des informations très probablement fausses à son sujet.</p>
</div>
</div>
</section>
<section id="les-variables-de-similarité" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="les-variables-de-similarité">Les variables de similarité</h2>
<p>La méthode est très souple puisqu’elle permet de s’adapter aux données dont on dispose et aux besoins en termes de diffusion. Les <strong>variables de similarité</strong> entre individus échangés peuvent ainsi être choisies parmi les variables dont on veut conserver le mieux possible l’information marginale. En effet, en échangeant des individus parfaitement similaires sur certaines caractéristiques (<strong>les variables de similarité</strong>), l’échange ne produira aucune perte d’information sur celles-ci.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Avertissement</span>Similarité et ré-identification
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si l’objectif est de réduire le risque de ré-identification, sélectionner toutes les variables quasi-identifiantes comme variables de similarité ne perturberait aucunement la capacité de l’attaquant à ré-identifier les individus. Ce choix produirait en revanche du bruit sur les autres variables: donc en ré-identifiant, l’attaquant ne serait pas en mesure d’obtenir des informations supplémentaires fiables.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Utiliser la hiérarchie des emboîtements géographiques
</div>
</div>
<div class="callout-body-container callout-body">
<p>Les données contiennent généralement des informations géographiques. Or, la géographie, en particulier à des niveaux fins, est très identifiante. On choisira en général d’échanger des individus résidant à des endroits différents, en tenant compte du niveau géographique auquel un individu est facilement ré-identifiable.</p>
<p>Par exemple, si un individu est facilement ré-identifiable dans sa commune mais pas dans son département de résidence, alors on privilégiera l’échange avec un autre individu du département en dehors de la commune de notre individu à risque. Si le niveau départemental posait lui aussi problème on remonterait au niveau régional, etc.</p>
<p>Ainsi, en général, la méthode consistera à échanger la localisation d’individus ou de ménages <span class="citation" data-cites="longhurst_statistical_nodate">(<a href="#ref-longhurst_statistical_nodate" role="doc-biblioref">Longhurst, Tromans, et Young, s.&nbsp;d.</a>)</span>.</p>
</div>
</div>
<div class="no-row-height column-margin column-container"><div id="ref-longhurst_statistical_nodate" class="csl-entry" role="listitem">
Longhurst, Jane, Nicola Tromans, et Caroline Young. s.&nbsp;d. <span>«&nbsp;Statistical <span>Disclosure</span> <span>Control</span> for the 2011 <span>UK</span> <span>Census</span>&nbsp;»</span>. Office for National Statistics (ONS - UK). <a href="https://www.ons.gov.uk/file?uri=/census/2011census/howourcensusworks/howwetookthe2011census/howweplannedfordatadelivery/protectingconfidentialitywithstatisticaldisclosurecontrol/statistical-disclosure-control-for-the-2011-uk-census_tcm77-189747.pdf">https://www.ons.gov.uk/file?uri=/census/2011census/howourcensusworks/howwetookthe2011census/howweplannedfordatadelivery/protectingconfidentialitywithstatisticaldisclosurecontrol/statistical-disclosure-control-for-the-2011-uk-census_tcm77-189747.pdf</a>.
</div></div><section id="comment-définir-des-individus-similaires" class="level3">
<h3 class="anchored" data-anchor-id="comment-définir-des-individus-similaires">Comment définir des individus similaires ?</h3>
<p>La <strong>similarité</strong> entre deux individus peut être envisagée de deux manières:</p>
<ul>
<li>en cherchant la <strong>correspondance exacte</strong> sur les variables de similarité, quitte à relâcher des contraintes quand il n’y pas de donneur: un donneur est tiré aléatoirement parmi la liste des prétendants.</li>
<li>en calculant une <strong>distance</strong> entre le receveur et l’ensemble des donneurs: un donneur est tiré parmi les individus avec lesquels la distance est la plus faible.</li>
</ul>
<p>La première option nécessite d’utiliser uniquement des variables catégorielles, quitte à créer des classes pour les variables continues qu’on souhaiterait inclure dans la liste.</p>
<p>Dans la pratique, cette première option est la moins gourmande en ressources de calcul, car elle ne nécessite pas de calculer une distance entre chaque receveur et chaque donneur potentiel. Elle est probablement la seule envisageable si le jeu de données contient plusieurs millions de lignes.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Une astuce pour gérer la présence de poids de sondage
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si nous disposons d’un échantillon, chaque individu dispose d’un poids de sondage. Avec le <code>Target Record Swapping</code>, on prend le risque d’échanger deux individus avec des poids très différents et de déséquilibrer des agrégats importants. Pour éviter ce genre de désagrément, il est possible d’ajouter le poids parmi les variables de similarité, sous la forme d’un arrondi à l’unité ou bien de tranches de valeurs. On pourra également exclure des donneurs potentiels, les individus ayant des poids très élevés comparés aux autres. Ceci permettra de limiter les déformations des distributions.</p>
</div>
</div>
</section>
<section id="individus-ou-ménages" class="level3">
<h3 class="anchored" data-anchor-id="individus-ou-ménages">Individus ou ménages ?</h3>
<p>Une autre souplesse de la méthode est de pouvoir prendre en compte des structures hiérarchiques entre les individus. Par exemple, lorsque le fichier d’individus contient également des informations sur la composition des ménages.</p>
<p>Dans ce cas, l’échange d’individus risque de déstabiliser la composition des ménages concernés, en termes d’âge en particulier: on pourrait voir se créer des ménages où il n’y a aucun individu majeur par exemple.</p>
<p>Une solution consisterait à échanger des ménages entiers plutôt que des individus. Mais cette solution n’est à retenir que si on dispose de suffisamment d’informations sur les ménages pour détecter des ménages similaires de bonne qualité. Si ce n’est pas le cas, il peut être préférable d’échanger des individus et de contrôler d’une autre manière, car un choix judicieux de variables de similarité peut limiter ces désagréments.</p>
<!-- La @tbl-exemple-ind-men présente un exemple de données individuelles contenant une information 
sur la composition des ménages. Ici, les individus sont répartis en deux ménages de trois individus, dont deux adultes.
Pour chaque individu, une mesure de risque de ré-identification est fournie. Le premier individu 
est le seul dont le risque de ré-identification est très élevé. 


| ID  | Géo. | Sexe | Age | Statut    | Diplome | Catégorie<br>Sociale | Risque | Ménage |
|-----|------|------|-----|-----------|---------|----------------------|-------:|--------|
| ID1 | C1   | H    | 35  | Chômage   | Bac+2   | Employé              |      1 | MEN1   |
| ID2 | C1   | F    | 40  | En emploi | Bac+5   | Cadre                |   0,05 | MEN1   |
| ID3 | C1   | F    | 12  | Inactif   |         | Elève                |   0,05 | MEN1   |
| ID4 | C2   | H    | 55  | En emploi | Bac+5   | Cadre                |   0,05 | MEN2   |
| ID5 | C2   | F    | 53  | En emploi | Bac+5   | Cadre                |   0,05 | MEN2   |
| ID6 | C2   | H    | 17  | Inactif   | BEP     | Ouvrier              |   0,05 | MEN2   |


: Table indiviudelle et composition des ménages {.striped #tbl-exemple-ind-men}


:::: {.columns}

::: {.column width="45%"}

:::

::: {.column width="5%"}

:::

::: {.column width="45%"}

:::

::::
 -->
</section>
<section id="le-taux-de-swapping" class="level3">
<h3 class="anchored" data-anchor-id="le-taux-de-swapping">Le taux de <em>swapping</em></h3>
<p>Le <strong>taux d’échange</strong> ou <strong>taux de <em>swapping</em></strong> est la part d’individus du jeu de données qui a pris part aux échanges, soit <span class="math inline">\(s=\frac{E+D}{N}\)</span>, où <span class="math inline">\(E\)</span> est le nombre d’individus à échanger, <span class="math inline">\(D\)</span> le nombre de donneurs (<span class="math inline">\(D=E\)</span>) et <span class="math inline">\(N\)</span> le nombre d’individus dans la base.</p>
<p>En pratique, on fixe un taux de swapping <span class="math inline">\(s\)</span> de telle sorte que l’algorithme procède à un minimum d’échanges. Si le nombre d’individus à risque ne permet pas d’atteindre ce seuil, des individus supplémentaires seront également échangés pour atteindre <span class="math inline">\(s\)</span>. Sinon, le taux de swapping étant atteint ou dépassé, aucun individu additionnel n’est ajouté.</p>
</section>
</section>
<section id="les-grandes-étapes-à-suivre-pour-appliquer-le-trs" class="level2">
<h2 class="anchored" data-anchor-id="les-grandes-étapes-à-suivre-pour-appliquer-le-trs">Les grandes étapes à suivre pour appliquer le <code>TRS</code></h2>
<ol type="1">
<li>De quels risques cherche-t-on à se protéger ?
<ol type="1">
<li>Si c’est du risque de ré-identification, le <code>TRS</code> est une méthode adaptée</li>
<li>Sinon, il faut peut-être aller voir ailleurs.</li>
</ol></li>
<li>Quelles sont les variables quasi-identifiantes dans mes données ?</li>
<li>Mesurer le risque de ré-identification basé sur ces variables ?</li>
<li>Choisir un seuil de risque de ré-identification maximal acceptable, au-delà duquel les individus devront être traités.</li>
<li>Quelles sont les marges que la méthode devrait conserver intactes en priorité ?</li>
<li>Un <em>swapping</em> des ménages est-il préférable à un swapping d’individus ?</li>
<li>Sélection des paramètres de la méthode:
<ol type="1">
<li>Les variables de similarités, en tenant compte des risques et des objectifs de diffusion.</li>
<li>Le taux de swapping.</li>
</ol></li>
<li>Procéder au swapping</li>
<li>Mesurer la perte d’information</li>
<li>Reprendre les étapes 4. à 9. si la perte d’information s’avère trop grande ou la protection trop faible</li>
</ol>
<p>L’avantage de la méthode est sa grande capacité d’adaptation aux données dont on dispose. Même si cette fiche va présenter comment l’appliquer avec le package <code>sdcMicro</code>, il est en réalité tout à fait possible de développer son propre algorithme pour affiner la façon de tirer les individus ou les ménages à échanger.</p>
<p>On pourra se reporter à la <a href="pratique/fiches/mesurer-risque.html">fiche sur les mesures de risque</a> pour en savoir plus sur les risques et la façon de les mesurer.</p>
</section>
</section>
<section id="en-pratique" class="level1">
<h1>En pratique</h1>
<p>Pour installer les packages nécessaires, vous trouverez les instructions à suivre dans la fiche <a href="../../ressources/fiches/outils-install.html">Ressources / Installer les packages et les outils sur R</a>.</p>
<section id="les-packages" class="level2">
<h2 class="anchored" data-anchor-id="les-packages">Les packages</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
</div>
</section>
<section id="les-données" class="level2">
<h2 class="anchored" data-anchor-id="les-données">Les données</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/fun_import_data.R"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>lfs_2023 <span class="ot">&lt;-</span> <span class="fu">import_lfs</span>()</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lfs_2023)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      REG    DEP    ARR   SEXE   AGE   AGE6  ACTEU   DIP7  PCS1Q ANCCHOM  HHID
   &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;int&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;fctr&gt; &lt;int&gt;
1:     28     76    761      1    53     50      1      4     30      99  3558
2:     28     76    761      2    43     25      1      7     52      99  3558
3:     28     76    761      2    17     15      3      5     99      99  3558
4:     28     76    761      1    17     15      3      4     99      99  3558
5:     11     92    922      1    42     25      1      7     62      99  5973
6:     11     92    922      2    54     50      1      7     62      99  5973
   HH_TAILLE HH_AGE HH_DIP HH_PCS IS_CHOM
      &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;   &lt;int&gt;
1:         4     53      4     30       0
2:         4     53      4     30       0
3:         4     53      4     30       0
4:         4     53      4     30       0
5:         2     54      7     62       0
6:         2     54      7     62       0</code></pre>
</div>
</div>
<p>Pour plus d’informations sur les données, on pourra se reporter à la fiche <a href="description-data.html">“Présentation des données”</a>.</p>
</section>
<section id="mesurons-les-risques-du-fichier" class="level2">
<h2 class="anchored" data-anchor-id="mesurons-les-risques-du-fichier">Mesurons les risques du fichier</h2>
<section id="les-types-de-variables" class="level3">
<h3 class="anchored" data-anchor-id="les-types-de-variables">Les types de variables</h3>
<p>On définit les variables selon les différentes catégories suivantes:</p>
<ul>
<li>les variables quasi-identifiantes (<code>key_vars</code>)</li>
<li>les variables sensibles (<code>sens_vars</code>)</li>
<li>les variables identifiant la composition des ménages (<code>hhid_vars</code>)</li>
</ul>
<p>Pour cet exercice, nous ferons les choix suivants:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>key_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGE6"</span>,<span class="st">"SEXE"</span>,<span class="st">"DEP"</span>,<span class="st">"DIP7"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sens_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ACTEU"</span>,<span class="st">"ANCCHOM"</span>,<span class="st">"IS_CHOM"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>hhid_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"HHID"</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Les comptages par croisement des modalités des variables quasi-identifiantes:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lfs_sdc <span class="ot">&lt;-</span> sdcMicro<span class="sc">::</span><span class="fu">createSdcObj</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  lfs_2023,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">keyVars =</span> key_vars</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Le tableau ci-dessous présente le nombre et la part d’individus du fichier ne répondant pas au critère du <span class="math inline">\(k\)</span>-anonymat, en fonction de la valeur de <span class="math inline">\(k\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ks <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> ks,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nb_ind_risk =</span> <span class="fu">sapply</span>(ks, \(k) <span class="fu">sum</span>(lfs_sdc<span class="sc">@</span>risk<span class="sc">$</span>individual[,<span class="st">"fk"</span>] <span class="sc">&lt;</span> k))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">part_ind_risk =</span> nb_ind_risk <span class="sc">/</span> <span class="fu">nrow</span>(lfs_2023) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">1</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">k</th>
<th style="text-align: right;">nb_ind_risk</th>
<th style="text-align: right;">part_ind_risk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">267</td>
<td style="text-align: right;">0.8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">465</td>
<td style="text-align: right;">1.4</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">825</td>
<td style="text-align: right;">2.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1105</td>
<td style="text-align: right;">3.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">1387</td>
<td style="text-align: right;">4.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">1723</td>
<td style="text-align: right;">5.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">2075</td>
<td style="text-align: right;">6.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">2498</td>
<td style="text-align: right;">7.3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>On dénombre 77 individus uniques et jusqu’à 7.3% d’individus à risque si nous nous fixons comme objectif de respecter un <span class="math inline">\(10\)</span>-anonymat dans notre fichier.</p>
<p>Pour traiter les individus à risque, on se propose d’utiliser un targeted record swapping.</p>
</section>
</section>
<section id="préparation-pour-le-swapping" class="level2">
<h2 class="anchored" data-anchor-id="préparation-pour-le-swapping">Préparation pour le swapping</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>risk_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGE6"</span>,<span class="st">"SEXE"</span>,<span class="st">"DIP7"</span>) <span class="co"># les variables permettant de mesurer le risque de ré-identification</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>hierarchy <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"REG"</span>, <span class="st">"DEP"</span>) <span class="co"># permet de renseigner l'existence d'une hiérarchie entre les var géographiques</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>carry_along <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ARR"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>similar <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="co"># Contraintes de similarité sur les individus échangés</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"AGE6"</span>,<span class="st">"SEXE"</span>),  <span class="co"># priorité 1</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"AGE6"</span>,<span class="st">"SEXE"</span>), <span class="co"># priorité 2 ...</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"SEXE"</span>), </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"AGE6"</span>), </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEXE"</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>hid <span class="ot">&lt;-</span> <span class="st">"ID"</span> <span class="co"># swapping d'individus</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>La fonction de swapping implémentée dans <code>sdcMicro</code> nécessite de transformer toutes les variables en <code>integer</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lfs_2023_pr_swap <span class="ot">&lt;-</span> lfs_2023 <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.integer))<span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="swapper-les-individus" class="level2">
<h2 class="anchored" data-anchor-id="swapper-les-individus">Swapper les individus</h2>
<p>On choisit de nous fixer comme objectif de traiter tous les individus ne respectant pas le <span class="math inline">\(5\)</span>-anonymat et d’échanger au moins <span class="math inline">\(10\)</span>% des individus. Le premier critère consiste à rendre obligatoire l’échange des individus ne respectant le niveau d’anonymat requis. Le second quant à lui fixe un minimum global d’échanges à atteindre.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>k_anonymity <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>swaprate <span class="ot">&lt;-</span> .<span class="dv">1</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="ot">&lt;-</span> <span class="fu">recordSwap</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> lfs_2023_pr_swap,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">hid =</span> hid,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hierarchy =</span> hierarchy,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">similar =</span> similar,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk_variables =</span> key_vars,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">carry_along =</span> carry_along,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">k_anonymity =</span> k_anonymity,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">swaprate =</span> swaprate,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_swapped_id =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123456</span> <span class="co"># pour la reproductibilité</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Recordswapping was successful!</code></pre>
</div>
</div>
<p>Le taux de swapping réel est légèrement supérieur au taux de swapping demandé 0.1:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ind_risk <span class="ot">&lt;-</span> <span class="fu">which</span>(lfs_sdc<span class="sc">@</span>risk<span class="sc">$</span>individual[,<span class="st">"fk"</span>] <span class="sc">&lt;</span> <span class="dv">5</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="sc">|&gt;</span> <span class="fu">summarise</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">part_indiv_risq =</span> <span class="fu">mean</span>(ID <span class="sc">%in%</span> ind_risk)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx_swap_reel =</span> <span class="fu">mean</span>(ID <span class="sc">!=</span> ID_swapped) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  part_indiv_risq tx_swap_reel
1        2.422694     11.67004</code></pre>
</div>
</div>
<p>En réalité, un certain nombre d’individus à risque ont été échangés entre eux :</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(ind_risk) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID_swapped <span class="sc">%in%</span> ind_risk) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="sc">/</span><span class="dv">2</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 85</code></pre>
</div>
</div>
<p>Et quelques individus, ne figurant pas dans la liste des individus à risque, ont également été échangés entre eux:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ID <span class="sc">!=</span> ID_swapped) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n_echanges_no_risque =</span> <span class="fu">sum</span>(<span class="sc">!</span>ID_swapped <span class="sc">%in%</span> ind_risk <span class="sc">&amp;</span> <span class="sc">!</span>ID <span class="sc">%in%</span> ind_risk)<span class="sc">/</span><span class="dv">2</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  n_echanges_no_risque
1                 1247</code></pre>
</div>
</div>
<p>Le taux d’échange est très différent selon les régions, dépendant du nombre d’individus problématiques en termes de risque de divulgation au sein de chacune d’elles:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(REG) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">part_indiv_risq =</span> <span class="fu">mean</span>(ID <span class="sc">%in%</span> ind_risk)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tx_swap_reel =</span> <span class="fu">mean</span>(ID <span class="sc">!=</span> ID_swapped) <span class="sc">*</span><span class="dv">100</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
    REG part_indiv_risq tx_swap_reel
  &lt;int&gt;           &lt;dbl&gt;        &lt;dbl&gt;
1     1            1.89         11.1
2     2            3.61         10.9
3     3            2.32         12.2
4     4           12.5          29.5</code></pre>
</div>
</div>
<p>La fonction fait en sorte d’atteindre le taux de swapping souhaité (dans notre cas <span class="math inline">\(10\%\)</span> dans chacune des régions). Cela explique pourquoi le taux de swapping global observé peut être légèrement supérieur au taux de swapping fixé initialement.</p>
</section>
<section id="la-base-après-swapping" class="level2">
<h2 class="anchored" data-anchor-id="la-base-après-swapping">La base après swapping</h2>
<p>La base de données fournit les informations individuelles de chaque individu dans leur nouvelle localisation.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(lfs_swapped)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  34053 obs. of  18 variables:
 $ REG       : int  2 2 1 2 1 1 1 1 1 3 ...
 $ DEP       : int  19 19 27 19 28 25 26 21 24 9 ...
 $ ARR       : int  53 53 79 53 83 73 75 62 70 27 ...
 $ SEXE      : int  1 2 2 1 1 2 2 1 2 1 ...
 $ AGE       : int  53 43 17 17 42 54 57 20 17 28 ...
 $ AGE6      : int  3 2 1 1 2 3 3 1 1 2 ...
 $ ACTEU     : int  1 1 3 3 1 1 1 3 3 1 ...
 $ DIP7      : int  4 7 5 4 7 7 7 7 7 5 ...
 $ PCS1Q     : int  4 7 10 10 9 9 7 10 10 8 ...
 $ ANCCHOM   : int  10 10 10 10 10 10 10 10 10 10 ...
 $ HHID      : int  3558 3558 3558 3558 5973 5973 6779 4906 4906 1135 ...
 $ HH_TAILLE : int  4 4 4 4 2 2 1 2 2 3 ...
 $ HH_AGE    : int  39 39 39 39 40 40 43 6 6 14 ...
 $ HH_DIP    : int  4 4 4 4 7 7 7 7 7 5 ...
 $ HH_PCS    : int  4 4 4 4 9 9 7 10 10 8 ...
 $ IS_CHOM   : int  0 0 0 0 0 0 0 0 0 0 ...
 $ ID        : int  1 2 3 4 5 6 7 8 9 10 ...
 $ ID_swapped: int  1 2 20669 4 7330 6 7 8 17652 10 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<section id="un-exemple-déchange" class="level3">
<h3 class="anchored" data-anchor-id="un-exemple-déchange">Un exemple d’échange</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>premier_couple <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span> <span class="fu">slice</span>(ind_risk[<span class="dv">1</span>]) <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(lfs_swapped <span class="sc">|&gt;</span> <span class="fu">filter</span>(ID_swapped <span class="sc">==</span> ind_risk[<span class="dv">1</span>]))</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>premier_couple </span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     REG   DEP   ARR  SEXE   AGE  AGE6 ACTEU  DIP7 PCS1Q ANCCHOM  HHID
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;
1:     1    27    79     2    17     1     3     5    10      10  3558
2:     2    19    53     2    23     1     3     2    10      10  7043
   HH_TAILLE HH_AGE HH_DIP HH_PCS IS_CHOM    ID ID_swapped
       &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;   &lt;int&gt; &lt;int&gt;      &lt;int&gt;
1:         4     39      4      4       0     3      20669
2:         8     43      3     10       0 20669          3</code></pre>
</div>
</div>
<p>On peut remarquer que ces individus ne sont similaires que sur les variables de similarité que sont le sexe et l’âge (<code>AGE6</code>). En revanche, l’échange a eu lieu entre deux individus de régions différentes: l’individu n°3 résidant dans la région <span class="math inline">\(2\)</span> originellement a été échangé avec un individu résidant dans la région <span class="math inline">\(1\)</span>.</p>
</section>
<section id="echanges-selon-lordre-des-priorités-de-similarité" class="level3">
<h3 class="anchored" data-anchor-id="echanges-selon-lordre-des-priorités-de-similarité">Echanges selon l’ordre des priorités de similarité</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>lfs_swap_vs_orig <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(lfs_2023_pr_swap, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_s"</span>,<span class="st">"_o"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">!=</span> ID_swapped) <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">test1 =</span> REG_s <span class="sc">==</span> REG_o,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">test2 =</span> SEXE_s <span class="sc">==</span> SEXE_o,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">test3 =</span> AGE6_s <span class="sc">==</span> AGE6_o</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>lfs_swap_vs_orig <span class="sc">|&gt;</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(ID %in% ind_risk) |&gt;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_reg_sex_age =</span> <span class="fu">sum</span>(test1 <span class="sc">&amp;</span> test2 <span class="sc">&amp;</span> test3),</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_sex_age =</span> <span class="fu">sum</span>(<span class="sc">!</span>test1 <span class="sc">&amp;</span> test2 <span class="sc">&amp;</span> test3),</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_reg_sex =</span> <span class="fu">sum</span>(test1 <span class="sc">&amp;</span> test2 <span class="sc">&amp;</span> <span class="sc">!</span>test3),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_reg_age =</span> <span class="fu">sum</span>(test1 <span class="sc">&amp;</span> <span class="sc">!</span>test2 <span class="sc">&amp;</span> test3),</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_reg =</span> <span class="fu">sum</span>(test1 <span class="sc">&amp;</span> <span class="sc">!</span>test2 <span class="sc">&amp;</span> <span class="sc">!</span>test3),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_sex =</span> <span class="fu">sum</span>(<span class="sc">!</span>test1 <span class="sc">&amp;</span> test2 <span class="sc">&amp;</span> <span class="sc">!</span>test3),</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"ordre_priorite"</span>, <span class="at">values_to =</span> <span class="st">"NB"</span>) </span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  ordre_priorite       NB
  &lt;chr&gt;             &lt;int&gt;
1 prior_reg_sex_age  2494
2 prior_sex_age      1480
3 prior_reg_sex         0
4 prior_reg_age         0
5 prior_reg             0
6 prior_sex             0</code></pre>
</div>
</div>
<p><span class="math inline">\(2~494\)</span> individus ont été échangés avec des individus résidant dans la même région, de même sexe et de la même catégorie d’âge. En revanche, <span class="math inline">\(1~480\)</span> individus (en réalité les individus à risque) ont été échangés avec des individus de même sexe et de même âge, mais résidant en dehors de la région.</p>
<p>Notons que dans cet exemple, tous les individus ayant été échangés avec des individus de même sexe et de même âge, le swapping ne génère pas d’incohérence dans la composition des ménages: leur taille et leur composition adultes/enfants restant parfaitement préservées.</p>
<!--

#### Vérifier que les individus à risque ont bien été swappés


::: {.cell}

```{.r .cell-code}
lfs_swapped 
```

::: {.cell-output .cell-output-stdout}

```
         REG   DEP   ARR  SEXE   AGE  AGE6 ACTEU  DIP7 PCS1Q ANCCHOM  HHID
       <int> <int> <int> <int> <int> <int> <int> <int> <int>   <int> <int>
    1:     2    19    53     1    53     3     1     4     4      10  3558
    2:     2    19    53     2    43     2     1     7     7      10  3558
    3:     1    27    79     2    17     1     3     5    10      10  3558
    4:     2    19    53     1    17     1     3     4    10      10  3558
    5:     1    28    83     1    42     2     1     7     9      10  5973
   ---                                                                    
34049:     1    20    57     1    74     4     1     4     3      10  4013
34050:     1    20    57     2    88     4     1     7     3      10  4013
34051:     1    27    80     2    54     3     1     7     7      10  7302
34052:     3     8    23     2    26     2     1     2     5      10  1121
34053:     3     8    23     1    47     2     1     1     4      10  1121
       HH_TAILLE HH_AGE HH_DIP HH_PCS IS_CHOM    ID ID_swapped
           <int>  <int>  <int>  <int>   <int> <int>      <int>
    1:         4     39      4      4       0     1          1
    2:         4     39      4      4       0     2          2
    3:         4     39      4      4       0     3      20669
    4:         4     39      4      4       0     4          4
    5:         2     40      7      9       0     5       7330
   ---                                                        
34049:         2     74      7      3       0 34049      34049
34050:         2     74      7      3       0 34050      34050
34051:         1     40      7      7       0 34051      22201
34052:         2     33      1      4       0 34052      34052
34053:         2     33      1      4       0 34053      34053
```


:::
:::


-->
</section>
</section>
<section id="echanger-les-ménages" class="level2">
<h2 class="anchored" data-anchor-id="echanger-les-ménages">Echanger les ménages</h2>
<p>Et si on avait échangé les ménages plutôt que les individus, qu’en aurait-il été ?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>similarHH <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"HH_TAILLE"</span>, <span class="st">"HH_AGE"</span>), <span class="fu">c</span>(<span class="st">"HH_TAILLE"</span>), <span class="fu">c</span>(<span class="st">"HH_AGE"</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>lfs_swapped_hh <span class="ot">&lt;-</span> <span class="fu">recordSwap</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> lfs_2023_pr_swap,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">hid =</span> <span class="st">"HHID"</span>, <span class="co"># identifiant des ménages</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hierarchy =</span> hierarchy,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">similar =</span> similarHH,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk_variables =</span> risk_variables,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">carry_along =</span> carry_along,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">k_anonymity =</span> k_anonymity,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">swaprate =</span> swaprate,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_swapped_id =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123456</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Recordswapping was successful!</code></pre>
</div>
</div>
<section id="taux-de-swapping-observé" class="level3">
<h3 class="anchored" data-anchor-id="taux-de-swapping-observé">Taux de swapping observé</h3>
<p>Combien d’individus ont-ils été échangés ?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>lfs_swapped_hh <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">tx_swap_reel =</span> <span class="fu">mean</span>(HHID <span class="sc">!=</span> HHID_swapped)<span class="sc">*</span><span class="dv">100</span>) </span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  tx_swap_reel
1     16.05732</code></pre>
</div>
</div>
<p>On observe que le taux de swapping observé est supérieur au taux observé lorsque l’échange n’est opéré qu’au niveau individuel.</p>
</section>
</section>
<section id="mesurer-la-perte-dutilité" class="level2">
<h2 class="anchored" data-anchor-id="mesurer-la-perte-dutilité">Mesurer la perte d’utilité</h2>
<p>Il est important de mesurer l’effet des traitements opérés sur la qualité des données qui seront transmises auprès du public. La mesure de la perte d’information peut s’opérer sur de nombreuses dimensions possibles. Le mieux est de se focaliser sur les besoins prioritaires en termes de restitution de l’information.</p>
<section id="robustesse-de-certains-comptages" class="level3">
<h3 class="anchored" data-anchor-id="robustesse-de-certains-comptages">Robustesse de certains comptages</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>reg_sex_age1 <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, AGE6, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, AGE6, <span class="at">name =</span> <span class="st">"n_o"</span>))<span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o))</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(REG, SEXE, AGE6)`</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>reg_sex_age2 <span class="ot">&lt;-</span> lfs_swapped_hh <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, AGE6, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, AGE6, <span class="at">name =</span> <span class="st">"n_o"</span>))<span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o))</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(REG, SEXE, AGE6)`</code></pre>
</div>
</div>
<p>Comparons pour les deux swappings (individus et ménages) l’écart absolu moyen du tableau croisant le niveau régional, le sexe et l’âge des individus:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mad_swap_indiv =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(reg_sex_age1<span class="sc">$</span>n_p <span class="sc">-</span> reg_sex_age1<span class="sc">$</span>n_o)),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mad_swap_menag =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(reg_sex_age2<span class="sc">$</span>n_p <span class="sc">-</span> reg_sex_age2<span class="sc">$</span>n_o))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  mad_swap_indiv mad_swap_menag
1      0.9473684       13.57895</code></pre>
</div>
</div>
<p>La conservation des marges régionales <code>SEXE*AGE</code> est de très bonne qualité dans le premier cas. En revanche, dans le cas d’un swapping de ménages, ces marges ont été plus fortement modifiées. Cela s’explique par le fait que dans le premier cas, les trois variables (région, sexe et age) font partie des variables de similarité, mais pas dans le second.</p>
<p>En comparant les distributions entre elles, on observe qu’elles sont très proches, excepté pour la région <span class="math inline">\(4\)</span>, région plus petite et contenant le plus d’individus à risque.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>reg_sex_age1 <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(reg_sex_age2 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>n_o) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">n_sm =</span> n_p), <span class="at">by=</span><span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"SEXE"</span>,<span class="st">"AGE6"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(n_p<span class="sc">:</span>n_sm, <span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n), <span class="dv">0</span>, n)) <span class="sc">|&gt;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">case_when</span>(type <span class="sc">==</span> <span class="st">"n_o"</span><span class="sc">~</span><span class="st">"original"</span>,type<span class="sc">==</span><span class="st">"n_p"</span><span class="sc">~</span><span class="st">"swap_ind"</span>,<span class="cn">TRUE</span><span class="sc">~</span><span class="st">"swap_men"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>AGE6, <span class="at">y=</span>n, <span class="at">fill=</span>type), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"data"</span>, <span class="at">palette =</span> <span class="dv">7</span>, <span class="at">type=</span><span class="st">"qual"</span>) <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(REG<span class="sc">~</span>SEXE, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">label =</span> <span class="st">"label_both"</span>) <span class="sc">+</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distributions par sexe, âge et région, selon les données utilisées"</span>) <span class="sc">+</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="proteger-micro-swapping_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Testons un autre tableau, en prenant une variable qui n’a pas été sélectionnée parmi les variables de similarité.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>reg_sex_dip1 <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, DIP7, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, DIP7, <span class="at">name =</span> <span class="st">"n_o"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o)) <span class="sc">|&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_abs =</span> <span class="fu">abs</span>(n_p <span class="sc">-</span> n_o)) <span class="sc">|&gt;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_rel =</span> <span class="fu">ifelse</span>(n_o <span class="sc">&gt;</span> <span class="dv">0</span>, diff_abs<span class="sc">/</span>n_o<span class="sc">*</span><span class="dv">100</span>, (n_p<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">*</span><span class="dv">100</span>))</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(REG, SEXE, DIP7)`</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>reg_sex_dip2 <span class="ot">&lt;-</span> lfs_swapped_hh <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, DIP7, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, DIP7, <span class="at">name =</span> <span class="st">"n_o"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o)) <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_abs =</span> <span class="fu">abs</span>(n_p <span class="sc">-</span> n_o)) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_rel =</span> <span class="fu">ifelse</span>(n_o <span class="sc">&gt;</span> <span class="dv">0</span>, diff_abs<span class="sc">/</span>n_o<span class="sc">*</span><span class="dv">100</span>, (n_p<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">*</span><span class="dv">100</span>))</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(REG, SEXE, DIP7)`</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mad_swap_indiv =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(reg_sex_dip1<span class="sc">$</span>n_p <span class="sc">-</span> reg_sex_dip1<span class="sc">$</span>n_o)),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mad_swap_menag =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(reg_sex_dip2<span class="sc">$</span>n_p <span class="sc">-</span> reg_sex_dip2<span class="sc">$</span>n_o))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  mad_swap_indiv mad_swap_menag
1       6.173913       12.26087</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>reg_sex_dip1 <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(reg_sex_dip2 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>n_o) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">n_sm =</span> n_p), <span class="at">by=</span><span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"SEXE"</span>,<span class="st">"DIP7"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(n_p<span class="sc">:</span>n_sm, <span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n), <span class="dv">0</span>, n)) <span class="sc">|&gt;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">case_when</span>(type <span class="sc">==</span> <span class="st">"n_o"</span><span class="sc">~</span><span class="st">"original"</span>,type<span class="sc">==</span><span class="st">"n_p"</span><span class="sc">~</span><span class="st">"swap_ind"</span>,<span class="cn">TRUE</span><span class="sc">~</span><span class="st">"swap_men"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>DIP7, <span class="at">y=</span>n, <span class="at">fill=</span>type), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"data"</span>, <span class="at">palette =</span> <span class="dv">7</span>, <span class="at">type=</span><span class="st">"qual"</span>) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(REG<span class="sc">~</span>SEXE, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">label =</span> <span class="st">"label_both"</span>) <span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distributions par sexe, diplôme et région, selon les données utilisées"</span>) <span class="sc">+</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="proteger-micro-swapping_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="analyse-statistique" class="level3">
<h3 class="anchored" data-anchor-id="analyse-statistique">Analyse statistique</h3>
<p>On se propose de comparer les intervalles de confiance des coefficients d’un modèle logistique pour évaluer la perte d’information engendrée par le swapping. L’idée est de tester les limites d’utilisation du jeu de données traité par les futurs utilisateurs.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/fun_cio.R"</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Étudions la stabilité d’un modèle relativement simple, cherchant à expliquer le fait d’être au chômage par différentes variables à notre disposition: l’âge, le diplôme et le sexe.</p>
<p>On entraînera ce modèle uniquement sur la population active. On retire donc notamment la population étudiante et retraitée.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>lfs_2023_pr_glm <span class="ot">&lt;-</span> lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>IS_CHOM, as.character))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>lfs_pert_pr_glm <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>IS_CHOM, as.character))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>lfs_pert_hh_pr_glm <span class="ot">&lt;-</span> lfs_swapped_hh <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>IS_CHOM, as.character))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>m_original <span class="ot">&lt;-</span> <span class="fu">glm</span>(IS_CHOM <span class="sc">~</span> REG <span class="sc">+</span> SEXE <span class="sc">+</span> AGE6 <span class="sc">+</span> DIP7, <span class="at">data =</span> lfs_2023_pr_glm <span class="sc">|&gt;</span> <span class="fu">filter</span>(ACTEU <span class="sc">!=</span> <span class="dv">3</span>))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>m_swapped <span class="ot">&lt;-</span> <span class="fu">glm</span>(IS_CHOM <span class="sc">~</span> REG <span class="sc">+</span> SEXE <span class="sc">+</span> AGE6 <span class="sc">+</span> DIP7, <span class="at">data =</span> lfs_pert_pr_glm <span class="sc">|&gt;</span> <span class="fu">filter</span>(ACTEU <span class="sc">!=</span> <span class="dv">3</span>))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>m_swapped_hh <span class="ot">&lt;-</span> <span class="fu">glm</span>(IS_CHOM <span class="sc">~</span> REG <span class="sc">+</span> SEXE <span class="sc">+</span> AGE6 <span class="sc">+</span> DIP7, <span class="at">data =</span> lfs_pert_hh_pr_glm <span class="sc">|&gt;</span> <span class="fu">filter</span>(ACTEU <span class="sc">!=</span> <span class="dv">3</span>))</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>mes_modeles <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"original"</span> <span class="ot">=</span> m_original,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"swapped_indiv"</span> <span class="ot">=</span> m_swapped,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"swapped_menag"</span> <span class="ot">=</span> m_swapped_hh</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>all_cios <span class="ot">&lt;-</span> <span class="fu">get_all_confints</span>(mes_modeles)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(vars)`</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">graph_cios</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  all_cios <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">substr</span>(vars, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DEP1"</span>,<span class="st">"AGE6"</span>,<span class="st">"DIP7"</span>)), <span class="at">titre =</span> <span class="st">"Superposition des intervalles de confiance à 95%</span><span class="sc">\n</span><span class="st">des Odds Ratio du modèle logistique selon le jeu de données"</span>) </span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="proteger-micro-swapping_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le modèle conduit aux mêmes conclusions quelque soit les traitements opérés que celles tenues àpartir du jeu original. Dans ce cas simple, la perturbation rend possible une analyse statistique multivariée.</p>
</section>
</section>
<section id="exercice" class="level2">
<h2 class="anchored" data-anchor-id="exercice">Exercice</h2>
<p>Comparer la perte d’information de différents taux de swapping ou de différents niveaux d’anonymité. Vous utiliserez la mesure de perte d’information que vous souhaitez.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">k_anonymity =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">swaprate =</span> <span class="fl">0.1</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">KEEP.OUT.ATTRS =</span> <span class="cn">FALSE</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>map_ru <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seq_along</span>(params<span class="sc">$</span>k_anonymity),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  \(i){</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> params<span class="sc">$</span>k_anonymity[i]</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> params<span class="sc">$</span>swaprate[i]</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    data_swapped <span class="ot">&lt;-</span> <span class="fu">recordSwap</span>(</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> lfs_2023_pr_swap,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">hid =</span> <span class="st">"ID"</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">hierarchy =</span> hierarchy,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">similar =</span> similar,</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">risk_variables =</span> risk_variables,</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">carry_along =</span> carry_along,</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">k_anonymity =</span> k,</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">swaprate =</span> s,</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">return_swapped_id =</span> <span class="cn">TRUE</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># seed = 123456 # pour la reproductibilité</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    dep_sex_dip_pcs <span class="ot">&lt;-</span> data_swapped <span class="sc">|&gt;</span> <span class="fu">count</span>(DEP,  SEXE, DIP7, PCS1Q, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(DEP,  SEXE, DIP7, PCS1Q, <span class="at">name =</span> <span class="st">"n_o"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o)) <span class="sc">|&gt;</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">diff_abs =</span> <span class="fu">abs</span>(n_p <span class="sc">-</span> n_o)) <span class="sc">|&gt;</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">diff_rel =</span> <span class="fu">ifelse</span>(n_o <span class="sc">&gt;</span> <span class="dv">0</span>, diff_abs<span class="sc">/</span>n_o<span class="sc">*</span><span class="dv">100</span>, (n_p<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">k =</span> k,</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">s =</span> s, </span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">sr_reel =</span> <span class="fu">as.numeric</span>(data_swapped <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">mean</span>(ID <span class="sc">!=</span> ID_swapped)) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">mdr =</span> <span class="fu">mean</span>(dep_sex_dip_pcs<span class="sc">$</span>diff_rel)</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">list_rbind</span>()</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>map_ru <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>mdr, <span class="at">y=</span>k), <span class="at">color =</span> <span class="st">"forestgreen"</span>)  <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Ecart relatif moyen (en %)"</span>, <span class="at">y =</span> <span class="st">"Niveau d'anonymité"</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">1.6</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Protection vs Perte d'information"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Le niveau de protection est mesuré le niveau d'anonymat et</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="st">    la perte d'information par l'écart relatif moyen observé</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="st">    dans le tableau DEP*SEXE*DIP*PCS"</span>) <span class="sc">+</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>


<!-- -->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copié");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copié");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/InseeFrLab\.github\.io\/formation_protection_donnees\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Code source</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Appliquer le Target Record Swapping</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="an">href:</span><span class="co"> pratique/fiches/proteger-micro-swapping.html</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="an">code-block-bg:</span><span class="co"> true</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="an">code-block-border-left:</span><span class="co"> "#bf9aff"</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="an">code-fold:</span><span class="co"> show</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="fu"># Objectif:</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>La fiche pratique présente comment appliquer le <span class="in">`Target Record Swapping`</span> à</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>un jeu de données individuelles afin d'assurer une protection optimale </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>des informations confidentielles des individus (ou ménages ou entreprises) qui </span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>le composent.</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>La première partie s'attache à présenter les différentes étapes à suivre pour </span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>que cette application soit pertinente au regard des données utilisées.</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>La seconde partie montre comment utiliser la fonction <span class="in">`sdcMicro::recordSwap()`</span> </span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>pour appliquer la méthode à un jeu de données dont on aura repérer les </span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>individus à risque préalablement.</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Pour s'exercer</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>Pour reproduire les résultats et réaliser les exercices, il est possible de travailler </span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>directement sur le <span class="co">[</span><span class="ot">`datalab` de l'Insee</span><span class="co">](datalab.sspcloud.fr)</span>. Si vous disposez d'un compte, vous pouvez <span class="co">[</span><span class="ot">Ouvrir un service RStudio</span><span class="co">](https://datalab.sspcloud.fr/launcher/ide/rstudio?name=rstudio-formation-protection&amp;version=2.3.1&amp;s3=region-ec97c721&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2FInseeFrLab%2Fformation_protection_donnees%2Frefs%2Fheads%2Fmain%2Finit-scripts%2Frstudio.sh»)</span> ou <span class="co">[</span><span class="ot">Ouvrir un service vscode R-Python</span><span class="co">](https://datalab.sspcloud.fr/launcher/ide/vscode-r-python-julia?name=vscode-formation-protection&amp;version=2.3.5&amp;s3=region-ec97c721&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2FInseeFrLab%2Fformation_protection_donnees%2Frefs%2Fheads%2Fmain%2Finit-scripts%2Fvscode-r-python.sh»)</span>, à votre convenance. Ces services installeront automatiquement les packages </span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>nécessaires pour réaliser les exercices de l'ensemble des fiches pratiques.</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a><span class="fu"># Rappels sur la méthode:</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>Le <span class="in">`Target Record Swapping (TRS)`</span> est une méthode s'appliquant directement sur un jeu </span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>de données individuelles pour réduire principalement les risques de ré-identification.</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>Il ciblera donc les individus pour lesquels ce risque est jugé trop élevé, c'est-à-dire  </span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>ceux partageant des caractéristiques trop rares sur un ensemble </span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>de variables dites quasi-identifiantes. Les variables quasi-identifiantes sont celles </span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>qui sont susceptibles d'être déjà publiques ou du moins à la disposition d'un attaquant.</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>D'où son nom: le *swapping*, c'est-à-dire </span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>l'échange, va concerner des unités de la base (les *records*) détectés à l'avance, </span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>devenant ainsi les cibles (*target*) sur lesquelles on va se concentrer.</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>Bien qu'elle soit appliquée sur des microdonnées, la méthode a principalement vocation à </span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>protéger la diffusion de données tabulées <span class="co">[</span><span class="ot">@hundepool_handbook_2024, [section 5.6](https://sdctools.github.io/HandbookSDC/05-frequency-tables.html#sec-TRS)</span><span class="co">]</span>. Dans ce type d'utilisation, en tant que méthode pré-tabulée, </span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>elle permet de produire des tableaux parfaitement additifs.</span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a><span class="fu">## En quoi consiste la méthode ?</span></span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>Après avoir détecté un individu dont le risque de ré-identification est jugé trop </span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>élevé, un autre individu est tiré aléatoirement parmi les individus au risque de ré-identification </span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>les plus faibles et certaines des caractéristiques de ces deux individus sont échangées (*swapped*).</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>Après l'échange, la ré-identification de l'individu est rendue beaucoup plus difficile et </span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>ne permet plus d'obtenir d'informations pertinentes à son sujet.</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a><span class="fu">### Un exemple très simple. </span></span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a>Soit un territoire donné découpé en six zones où résident un certain nombre d'individus. </span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a>Avec les informations disponibles à leur sujet, on considère qu'un seul individu a un risque </span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a>de ré-identification trop élevé (croix rouge sur la @fig-swap-avant).</span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a>::: {#fig-swap-avant}</span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a><span class="al">![Avant swapping](images/swapping-exemple-avant.png)</span></span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a>On tire alors au hasard un autre individu présent sur le territoire pour échanger </span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a>certaines de leurs caractéristiques. Ce tirage pourrait être purement aléatoire. Mais, cela </span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a>conduirait à détruire certaines statistiques bien utiles. Par exemple, en trouvant </span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>un individu d'une autre zone partageant certaines caractéristiques (par exemple </span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a>le sexe, l'âge et la catégorie sociale, @fig-swap-apres), on s'assure de conserver les marges </span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a>sur ces variables au niveau géographique le plus fin. </span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a>En revanche, les autres caractéristiques sont bruitées de façon non contrôlée.</span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a>::: {#fig-swap-apres}</span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a><span class="al">![Après swapping](images/swapping-exemple-après.png)</span></span>
<span id="cb54-91"><a href="#cb54-91" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-92"><a href="#cb54-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a>Ainsi, l'éventuelle ré-identification de l'individu à risque ne pourrait conduire </span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a>l'attaquant qu'à obtenir des informations très probablement fausses à son sujet.</span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a><span class="fu">## Les variables de similarité</span></span>
<span id="cb54-99"><a href="#cb54-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-100"><a href="#cb54-100" aria-hidden="true" tabindex="-1"></a>La méthode est très souple puisqu'elle permet de s'adapter aux données dont on dispose et </span>
<span id="cb54-101"><a href="#cb54-101" aria-hidden="true" tabindex="-1"></a>aux besoins en termes de diffusion. Les **variables de similarité** entre individus échangés </span>
<span id="cb54-102"><a href="#cb54-102" aria-hidden="true" tabindex="-1"></a>peuvent ainsi être choisies parmi les variables dont on veut conserver </span>
<span id="cb54-103"><a href="#cb54-103" aria-hidden="true" tabindex="-1"></a>le mieux possible l'information marginale. En effet, en échangeant des individus </span>
<span id="cb54-104"><a href="#cb54-104" aria-hidden="true" tabindex="-1"></a>parfaitement similaires sur certaines caractéristiques (**les variables de similarité**), </span>
<span id="cb54-105"><a href="#cb54-105" aria-hidden="true" tabindex="-1"></a>l'échange ne produira aucune perte d'information sur celles-ci. </span>
<span id="cb54-106"><a href="#cb54-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-107"><a href="#cb54-107" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb54-108"><a href="#cb54-108" aria-hidden="true" tabindex="-1"></a><span class="fu">### Similarité et ré-identification</span></span>
<span id="cb54-109"><a href="#cb54-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-110"><a href="#cb54-110" aria-hidden="true" tabindex="-1"></a>Si l'objectif est de réduire le risque de ré-identification, sélectionner toutes les variables </span>
<span id="cb54-111"><a href="#cb54-111" aria-hidden="true" tabindex="-1"></a>quasi-identifiantes comme variables de similarité ne perturberait aucunement </span>
<span id="cb54-112"><a href="#cb54-112" aria-hidden="true" tabindex="-1"></a>la capacité de l'attaquant à ré-identifier les individus. Ce choix produirait </span>
<span id="cb54-113"><a href="#cb54-113" aria-hidden="true" tabindex="-1"></a>en revanche du bruit sur les autres variables: donc en ré-identifiant, l'attaquant </span>
<span id="cb54-114"><a href="#cb54-114" aria-hidden="true" tabindex="-1"></a>ne serait pas en mesure d'obtenir des informations supplémentaires fiables.</span>
<span id="cb54-115"><a href="#cb54-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-116"><a href="#cb54-116" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-117"><a href="#cb54-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-118"><a href="#cb54-118" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb54-119"><a href="#cb54-119" aria-hidden="true" tabindex="-1"></a><span class="fu">### Utiliser la hiérarchie des emboîtements géographiques</span></span>
<span id="cb54-120"><a href="#cb54-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-121"><a href="#cb54-121" aria-hidden="true" tabindex="-1"></a>Les données contiennent généralement des informations géographiques. Or, la géographie, </span>
<span id="cb54-122"><a href="#cb54-122" aria-hidden="true" tabindex="-1"></a>en particulier à des niveaux fins, est très identifiante. On choisira en général </span>
<span id="cb54-123"><a href="#cb54-123" aria-hidden="true" tabindex="-1"></a>d'échanger des individus résidant à des endroits différents, en tenant compte </span>
<span id="cb54-124"><a href="#cb54-124" aria-hidden="true" tabindex="-1"></a>du niveau géographique auquel un individu est facilement ré-identifiable.</span>
<span id="cb54-125"><a href="#cb54-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-126"><a href="#cb54-126" aria-hidden="true" tabindex="-1"></a>Par exemple, si un individu est facilement ré-identifiable dans sa commune mais </span>
<span id="cb54-127"><a href="#cb54-127" aria-hidden="true" tabindex="-1"></a>pas dans son département de résidence, alors on privilégiera l'échange avec </span>
<span id="cb54-128"><a href="#cb54-128" aria-hidden="true" tabindex="-1"></a>un autre individu du département en dehors de la commune de notre individu à risque.</span>
<span id="cb54-129"><a href="#cb54-129" aria-hidden="true" tabindex="-1"></a>Si le niveau départemental posait lui aussi problème on remonterait au niveau régional, etc.</span>
<span id="cb54-130"><a href="#cb54-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-131"><a href="#cb54-131" aria-hidden="true" tabindex="-1"></a>Ainsi, en général, la méthode consistera à échanger la localisation d'individus ou de ménages <span class="co">[</span><span class="ot">@longhurst_statistical_nodate</span><span class="co">]</span>.</span>
<span id="cb54-132"><a href="#cb54-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-133"><a href="#cb54-133" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-134"><a href="#cb54-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-135"><a href="#cb54-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-136"><a href="#cb54-136" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comment définir des individus similaires ?</span></span>
<span id="cb54-137"><a href="#cb54-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-138"><a href="#cb54-138" aria-hidden="true" tabindex="-1"></a>La **similarité** entre deux individus peut être envisagée de deux manières:</span>
<span id="cb54-139"><a href="#cb54-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-140"><a href="#cb54-140" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>en cherchant la **correspondance exacte** sur les variables de similarité, quitte à relâcher </span>
<span id="cb54-141"><a href="#cb54-141" aria-hidden="true" tabindex="-1"></a>des contraintes quand il n'y pas de donneur: un donneur est tiré aléatoirement parmi la liste </span>
<span id="cb54-142"><a href="#cb54-142" aria-hidden="true" tabindex="-1"></a>des prétendants.</span>
<span id="cb54-143"><a href="#cb54-143" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>en calculant une **distance** entre le receveur et l'ensemble des donneurs: un donneur est </span>
<span id="cb54-144"><a href="#cb54-144" aria-hidden="true" tabindex="-1"></a>tiré parmi les individus avec lesquels la distance est la plus faible.</span>
<span id="cb54-145"><a href="#cb54-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-146"><a href="#cb54-146" aria-hidden="true" tabindex="-1"></a>La première option nécessite d'utiliser uniquement des variables catégorielles, </span>
<span id="cb54-147"><a href="#cb54-147" aria-hidden="true" tabindex="-1"></a>quitte à créer des classes pour les variables continues qu'on souhaiterait inclure </span>
<span id="cb54-148"><a href="#cb54-148" aria-hidden="true" tabindex="-1"></a>dans la liste. </span>
<span id="cb54-149"><a href="#cb54-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-150"><a href="#cb54-150" aria-hidden="true" tabindex="-1"></a>Dans la pratique, cette première option est la moins gourmande en ressources de calcul, </span>
<span id="cb54-151"><a href="#cb54-151" aria-hidden="true" tabindex="-1"></a>car elle ne nécessite pas de calculer une distance entre chaque receveur et chaque donneur potentiel. </span>
<span id="cb54-152"><a href="#cb54-152" aria-hidden="true" tabindex="-1"></a>Elle est probablement la seule envisageable si le jeu de données contient plusieurs millions de lignes.</span>
<span id="cb54-153"><a href="#cb54-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-154"><a href="#cb54-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-155"><a href="#cb54-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-156"><a href="#cb54-156" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb54-157"><a href="#cb54-157" aria-hidden="true" tabindex="-1"></a><span class="fu">### Une astuce pour gérer la présence de poids de sondage</span></span>
<span id="cb54-158"><a href="#cb54-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-159"><a href="#cb54-159" aria-hidden="true" tabindex="-1"></a>Si nous disposons d'un échantillon, chaque individu dispose d'un poids de sondage. </span>
<span id="cb54-160"><a href="#cb54-160" aria-hidden="true" tabindex="-1"></a>Avec le <span class="in">`Target Record Swapping`</span>, on prend le risque d'échanger deux individus avec des poids très différents et </span>
<span id="cb54-161"><a href="#cb54-161" aria-hidden="true" tabindex="-1"></a>de déséquilibrer des agrégats importants. Pour éviter ce genre de désagrément, il est possible</span>
<span id="cb54-162"><a href="#cb54-162" aria-hidden="true" tabindex="-1"></a>d'ajouter le poids parmi les variables de similarité, sous la forme d'un arrondi à l'unité </span>
<span id="cb54-163"><a href="#cb54-163" aria-hidden="true" tabindex="-1"></a>ou bien de tranches de valeurs. On pourra également exclure des donneurs potentiels, </span>
<span id="cb54-164"><a href="#cb54-164" aria-hidden="true" tabindex="-1"></a>les individus ayant des poids très élevés comparés aux autres. Ceci permettra de limiter </span>
<span id="cb54-165"><a href="#cb54-165" aria-hidden="true" tabindex="-1"></a>les déformations des distributions.</span>
<span id="cb54-166"><a href="#cb54-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-167"><a href="#cb54-167" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-168"><a href="#cb54-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-169"><a href="#cb54-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-170"><a href="#cb54-170" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individus ou ménages ?</span></span>
<span id="cb54-171"><a href="#cb54-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-172"><a href="#cb54-172" aria-hidden="true" tabindex="-1"></a>Une autre souplesse de la méthode est de pouvoir prendre en compte des </span>
<span id="cb54-173"><a href="#cb54-173" aria-hidden="true" tabindex="-1"></a>structures hiérarchiques entre les individus. Par exemple, lorsque le fichier </span>
<span id="cb54-174"><a href="#cb54-174" aria-hidden="true" tabindex="-1"></a>d'individus contient également des informations sur la composition des ménages. </span>
<span id="cb54-175"><a href="#cb54-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-176"><a href="#cb54-176" aria-hidden="true" tabindex="-1"></a>Dans ce cas, l'échange d'individus risque de déstabiliser la composition des </span>
<span id="cb54-177"><a href="#cb54-177" aria-hidden="true" tabindex="-1"></a>ménages concernés, en termes d'âge en particulier: on pourrait voir se créer des </span>
<span id="cb54-178"><a href="#cb54-178" aria-hidden="true" tabindex="-1"></a>ménages où il n'y a aucun individu majeur par exemple. </span>
<span id="cb54-179"><a href="#cb54-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-180"><a href="#cb54-180" aria-hidden="true" tabindex="-1"></a>Une solution consisterait à échanger des ménages entiers plutôt que des individus. </span>
<span id="cb54-181"><a href="#cb54-181" aria-hidden="true" tabindex="-1"></a>Mais cette solution n'est à retenir que si on dispose de suffisamment d'informations </span>
<span id="cb54-182"><a href="#cb54-182" aria-hidden="true" tabindex="-1"></a>sur les ménages pour détecter des ménages similaires de bonne qualité. </span>
<span id="cb54-183"><a href="#cb54-183" aria-hidden="true" tabindex="-1"></a>Si ce n'est pas le cas, il peut être préférable d'échanger des individus et de contrôler </span>
<span id="cb54-184"><a href="#cb54-184" aria-hidden="true" tabindex="-1"></a>d'une autre manière, car un choix judicieux de variables de similarité peut limiter ces </span>
<span id="cb54-185"><a href="#cb54-185" aria-hidden="true" tabindex="-1"></a>désagréments.</span>
<span id="cb54-186"><a href="#cb54-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-187"><a href="#cb54-187" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- La @tbl-exemple-ind-men présente un exemple de données individuelles contenant une information </span></span>
<span id="cb54-188"><a href="#cb54-188" aria-hidden="true" tabindex="-1"></a><span class="co">sur la composition des ménages. Ici, les individus sont répartis en deux ménages de trois individus, dont deux adultes.</span></span>
<span id="cb54-189"><a href="#cb54-189" aria-hidden="true" tabindex="-1"></a><span class="co">Pour chaque individu, une mesure de risque de ré-identification est fournie. Le premier individu </span></span>
<span id="cb54-190"><a href="#cb54-190" aria-hidden="true" tabindex="-1"></a><span class="co">est le seul dont le risque de ré-identification est très élevé. </span></span>
<span id="cb54-191"><a href="#cb54-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-192"><a href="#cb54-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-193"><a href="#cb54-193" aria-hidden="true" tabindex="-1"></a><span class="co">| ID  | Géo. | Sexe | Age | Statut    | Diplome | Catégorie&lt;br&gt;Sociale | Risque | Ménage |</span></span>
<span id="cb54-194"><a href="#cb54-194" aria-hidden="true" tabindex="-1"></a><span class="co">|-----|------|------|-----|-----------|---------|----------------------|-------:|--------|</span></span>
<span id="cb54-195"><a href="#cb54-195" aria-hidden="true" tabindex="-1"></a><span class="co">| ID1 | C1   | H    | 35  | Chômage   | Bac+2   | Employé              |      1 | MEN1   |</span></span>
<span id="cb54-196"><a href="#cb54-196" aria-hidden="true" tabindex="-1"></a><span class="co">| ID2 | C1   | F    | 40  | En emploi | Bac+5   | Cadre                |   0,05 | MEN1   |</span></span>
<span id="cb54-197"><a href="#cb54-197" aria-hidden="true" tabindex="-1"></a><span class="co">| ID3 | C1   | F    | 12  | Inactif   |         | Elève                |   0,05 | MEN1   |</span></span>
<span id="cb54-198"><a href="#cb54-198" aria-hidden="true" tabindex="-1"></a><span class="co">| ID4 | C2   | H    | 55  | En emploi | Bac+5   | Cadre                |   0,05 | MEN2   |</span></span>
<span id="cb54-199"><a href="#cb54-199" aria-hidden="true" tabindex="-1"></a><span class="co">| ID5 | C2   | F    | 53  | En emploi | Bac+5   | Cadre                |   0,05 | MEN2   |</span></span>
<span id="cb54-200"><a href="#cb54-200" aria-hidden="true" tabindex="-1"></a><span class="co">| ID6 | C2   | H    | 17  | Inactif   | BEP     | Ouvrier              |   0,05 | MEN2   |</span></span>
<span id="cb54-201"><a href="#cb54-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-202"><a href="#cb54-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-203"><a href="#cb54-203" aria-hidden="true" tabindex="-1"></a><span class="co">: Table indiviudelle et composition des ménages {.striped #tbl-exemple-ind-men}</span></span>
<span id="cb54-204"><a href="#cb54-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-205"><a href="#cb54-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-206"><a href="#cb54-206" aria-hidden="true" tabindex="-1"></a><span class="co">:::: {.columns}</span></span>
<span id="cb54-207"><a href="#cb54-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-208"><a href="#cb54-208" aria-hidden="true" tabindex="-1"></a><span class="co">::: {.column width="45%"}</span></span>
<span id="cb54-209"><a href="#cb54-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-210"><a href="#cb54-210" aria-hidden="true" tabindex="-1"></a><span class="co">:::</span></span>
<span id="cb54-211"><a href="#cb54-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-212"><a href="#cb54-212" aria-hidden="true" tabindex="-1"></a><span class="co">::: {.column width="5%"}</span></span>
<span id="cb54-213"><a href="#cb54-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-214"><a href="#cb54-214" aria-hidden="true" tabindex="-1"></a><span class="co">:::</span></span>
<span id="cb54-215"><a href="#cb54-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-216"><a href="#cb54-216" aria-hidden="true" tabindex="-1"></a><span class="co">::: {.column width="45%"}</span></span>
<span id="cb54-217"><a href="#cb54-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-218"><a href="#cb54-218" aria-hidden="true" tabindex="-1"></a><span class="co">:::</span></span>
<span id="cb54-219"><a href="#cb54-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-220"><a href="#cb54-220" aria-hidden="true" tabindex="-1"></a><span class="co">::::</span></span>
<span id="cb54-221"><a href="#cb54-221" aria-hidden="true" tabindex="-1"></a><span class="co"> --&gt;</span></span>
<span id="cb54-222"><a href="#cb54-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-223"><a href="#cb54-223" aria-hidden="true" tabindex="-1"></a><span class="fu">### Le taux de *swapping*</span></span>
<span id="cb54-224"><a href="#cb54-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-225"><a href="#cb54-225" aria-hidden="true" tabindex="-1"></a>Le __taux d'échange__ ou __taux de *swapping*__ est la part d'individus du jeu de données </span>
<span id="cb54-226"><a href="#cb54-226" aria-hidden="true" tabindex="-1"></a>qui a pris part aux échanges, soit $s=\frac{E+D}{N}$, où $E$ est le nombre d'individus à échanger,</span>
<span id="cb54-227"><a href="#cb54-227" aria-hidden="true" tabindex="-1"></a>$D$ le nombre de donneurs ($D=E$) et $N$ le nombre d'individus dans la base. </span>
<span id="cb54-228"><a href="#cb54-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-229"><a href="#cb54-229" aria-hidden="true" tabindex="-1"></a>En pratique, on fixe un taux de swapping $s$ de telle sorte que l'algorithme procède à un minimum </span>
<span id="cb54-230"><a href="#cb54-230" aria-hidden="true" tabindex="-1"></a>d'échanges. Si le nombre d'individus à risque ne permet pas d'atteindre ce seuil, des individus </span>
<span id="cb54-231"><a href="#cb54-231" aria-hidden="true" tabindex="-1"></a>supplémentaires seront également échangés pour atteindre $s$. Sinon, le taux de swapping étant atteint ou dépassé,</span>
<span id="cb54-232"><a href="#cb54-232" aria-hidden="true" tabindex="-1"></a>aucun individu additionnel n'est ajouté.</span>
<span id="cb54-233"><a href="#cb54-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-234"><a href="#cb54-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-235"><a href="#cb54-235" aria-hidden="true" tabindex="-1"></a><span class="fu">## Les grandes étapes à suivre pour appliquer le `TRS`</span></span>
<span id="cb54-236"><a href="#cb54-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-237"><a href="#cb54-237" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>De quels risques cherche-t-on à se protéger ?</span>
<span id="cb54-238"><a href="#cb54-238" aria-hidden="true" tabindex="-1"></a><span class="ss">   1. </span>Si c'est du risque de ré-identification, le <span class="in">`TRS`</span> est une méthode adaptée</span>
<span id="cb54-239"><a href="#cb54-239" aria-hidden="true" tabindex="-1"></a><span class="ss">   2. </span>Sinon, il faut peut-être aller voir ailleurs.</span>
<span id="cb54-240"><a href="#cb54-240" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Quelles sont les variables quasi-identifiantes dans mes données ?</span>
<span id="cb54-241"><a href="#cb54-241" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Mesurer le risque de ré-identification basé sur ces variables ? </span>
<span id="cb54-242"><a href="#cb54-242" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Choisir un seuil de risque de ré-identification maximal acceptable, au-delà duquel les individus devront être traités.</span>
<span id="cb54-243"><a href="#cb54-243" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Quelles sont les marges que la méthode devrait conserver intactes en priorité ?</span>
<span id="cb54-244"><a href="#cb54-244" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Un *swapping* des ménages est-il préférable à un swapping d'individus ? </span>
<span id="cb54-245"><a href="#cb54-245" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Sélection des paramètres de la méthode:</span>
<span id="cb54-246"><a href="#cb54-246" aria-hidden="true" tabindex="-1"></a><span class="ss">   1. </span>Les variables de similarités, en tenant compte des risques et des objectifs de diffusion.</span>
<span id="cb54-247"><a href="#cb54-247" aria-hidden="true" tabindex="-1"></a><span class="ss">   2. </span>Le taux de swapping.</span>
<span id="cb54-248"><a href="#cb54-248" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Procéder au swapping</span>
<span id="cb54-249"><a href="#cb54-249" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Mesurer la perte d'information </span>
<span id="cb54-250"><a href="#cb54-250" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>Reprendre les étapes 4. à 9. si la perte d'information s'avère trop grande ou la protection trop faible</span>
<span id="cb54-251"><a href="#cb54-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-252"><a href="#cb54-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-253"><a href="#cb54-253" aria-hidden="true" tabindex="-1"></a>L'avantage de la méthode  est sa grande capacité d'adaptation aux données dont on dispose. </span>
<span id="cb54-254"><a href="#cb54-254" aria-hidden="true" tabindex="-1"></a>Même si cette fiche va présenter comment l'appliquer avec le package <span class="in">`sdcMicro`</span>, </span>
<span id="cb54-255"><a href="#cb54-255" aria-hidden="true" tabindex="-1"></a>il est en réalité tout à fait possible de développer son propre algorithme pour </span>
<span id="cb54-256"><a href="#cb54-256" aria-hidden="true" tabindex="-1"></a>affiner la façon de tirer les individus ou les ménages à échanger.</span>
<span id="cb54-257"><a href="#cb54-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-258"><a href="#cb54-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-259"><a href="#cb54-259" aria-hidden="true" tabindex="-1"></a>On pourra se reporter à la </span>
<span id="cb54-260"><a href="#cb54-260" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">fiche sur les mesures de risque</span><span class="co">](pratique/fiches/mesurer-risque.html)</span> </span>
<span id="cb54-261"><a href="#cb54-261" aria-hidden="true" tabindex="-1"></a>pour en savoir plus sur les risques et la façon de les mesurer.</span>
<span id="cb54-262"><a href="#cb54-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-263"><a href="#cb54-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-264"><a href="#cb54-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-265"><a href="#cb54-265" aria-hidden="true" tabindex="-1"></a><span class="fu"># En pratique</span></span>
<span id="cb54-266"><a href="#cb54-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-267"><a href="#cb54-267" aria-hidden="true" tabindex="-1"></a>Pour installer les packages nécessaires, vous trouverez les instructions à suivre </span>
<span id="cb54-268"><a href="#cb54-268" aria-hidden="true" tabindex="-1"></a>dans la fiche <span class="co">[</span><span class="ot">Ressources / Installer les packages et les outils sur R</span><span class="co">](../../ressources/fiches/outils-install.html)</span>.  </span>
<span id="cb54-269"><a href="#cb54-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-270"><a href="#cb54-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-271"><a href="#cb54-271" aria-hidden="true" tabindex="-1"></a><span class="fu">## Les packages</span></span>
<span id="cb54-272"><a href="#cb54-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-275"><a href="#cb54-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-276"><a href="#cb54-276" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb54-277"><a href="#cb54-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-278"><a href="#cb54-278" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"./pratique/fiches"</span>)</span>
<span id="cb54-279"><a href="#cb54-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-280"><a href="#cb54-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-281"><a href="#cb54-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-284"><a href="#cb54-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-285"><a href="#cb54-285" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-286"><a href="#cb54-286" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb54-287"><a href="#cb54-287" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb54-288"><a href="#cb54-288" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb54-289"><a href="#cb54-289" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb54-290"><a href="#cb54-290" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sdcMicro)</span>
<span id="cb54-291"><a href="#cb54-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-292"><a href="#cb54-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-293"><a href="#cb54-293" aria-hidden="true" tabindex="-1"></a><span class="fu">## Les données</span></span>
<span id="cb54-294"><a href="#cb54-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-297"><a href="#cb54-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-298"><a href="#cb54-298" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/fun_import_data.R"</span>)</span>
<span id="cb54-299"><a href="#cb54-299" aria-hidden="true" tabindex="-1"></a>lfs_2023 <span class="ot">&lt;-</span> <span class="fu">import_lfs</span>()</span>
<span id="cb54-300"><a href="#cb54-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-301"><a href="#cb54-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-302"><a href="#cb54-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-305"><a href="#cb54-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-306"><a href="#cb54-306" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lfs_2023)</span>
<span id="cb54-307"><a href="#cb54-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-308"><a href="#cb54-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-309"><a href="#cb54-309" aria-hidden="true" tabindex="-1"></a>Pour plus d'informations sur les données, on pourra se reporter à la fiche </span>
<span id="cb54-310"><a href="#cb54-310" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">"Présentation des données"</span><span class="co">](description-data.html)</span>.  </span>
<span id="cb54-311"><a href="#cb54-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-312"><a href="#cb54-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-313"><a href="#cb54-313" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mesurons les risques du fichier</span></span>
<span id="cb54-314"><a href="#cb54-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-315"><a href="#cb54-315" aria-hidden="true" tabindex="-1"></a><span class="fu">### Les types de variables</span></span>
<span id="cb54-316"><a href="#cb54-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-317"><a href="#cb54-317" aria-hidden="true" tabindex="-1"></a>On définit les variables selon les différentes catégories suivantes:</span>
<span id="cb54-318"><a href="#cb54-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-319"><a href="#cb54-319" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>les variables quasi-identifiantes (<span class="in">`key_vars`</span>)</span>
<span id="cb54-320"><a href="#cb54-320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>les variables sensibles (<span class="in">`sens_vars`</span>)</span>
<span id="cb54-321"><a href="#cb54-321" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>les variables identifiant la composition des ménages (<span class="in">`hhid_vars`</span>)</span>
<span id="cb54-322"><a href="#cb54-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-323"><a href="#cb54-323" aria-hidden="true" tabindex="-1"></a>Pour cet exercice, nous ferons les choix suivants:</span>
<span id="cb54-324"><a href="#cb54-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-327"><a href="#cb54-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-328"><a href="#cb54-328" aria-hidden="true" tabindex="-1"></a>key_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGE6"</span>,<span class="st">"SEXE"</span>,<span class="st">"DEP"</span>,<span class="st">"DIP7"</span>)</span>
<span id="cb54-329"><a href="#cb54-329" aria-hidden="true" tabindex="-1"></a>sens_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ACTEU"</span>,<span class="st">"ANCCHOM"</span>,<span class="st">"IS_CHOM"</span>)</span>
<span id="cb54-330"><a href="#cb54-330" aria-hidden="true" tabindex="-1"></a>hhid_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"HHID"</span>)</span>
<span id="cb54-331"><a href="#cb54-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-332"><a href="#cb54-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-333"><a href="#cb54-333" aria-hidden="true" tabindex="-1"></a>Les comptages par croisement des modalités des variables quasi-identifiantes:</span>
<span id="cb54-334"><a href="#cb54-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-337"><a href="#cb54-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-338"><a href="#cb54-338" aria-hidden="true" tabindex="-1"></a>lfs_sdc <span class="ot">&lt;-</span> sdcMicro<span class="sc">::</span><span class="fu">createSdcObj</span>(</span>
<span id="cb54-339"><a href="#cb54-339" aria-hidden="true" tabindex="-1"></a>  lfs_2023,</span>
<span id="cb54-340"><a href="#cb54-340" aria-hidden="true" tabindex="-1"></a>  <span class="at">keyVars =</span> key_vars</span>
<span id="cb54-341"><a href="#cb54-341" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-342"><a href="#cb54-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-343"><a href="#cb54-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-344"><a href="#cb54-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-345"><a href="#cb54-345" aria-hidden="true" tabindex="-1"></a>Le tableau ci-dessous présente le nombre et la part d'individus du fichier ne répondant pas </span>
<span id="cb54-346"><a href="#cb54-346" aria-hidden="true" tabindex="-1"></a>au critère du $k$-anonymat, en fonction de la valeur de $k$.</span>
<span id="cb54-347"><a href="#cb54-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-350"><a href="#cb54-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-351"><a href="#cb54-351" aria-hidden="true" tabindex="-1"></a>ks <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb54-352"><a href="#cb54-352" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb54-353"><a href="#cb54-353" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> ks,</span>
<span id="cb54-354"><a href="#cb54-354" aria-hidden="true" tabindex="-1"></a>  <span class="at">nb_ind_risk =</span> <span class="fu">sapply</span>(ks, \(k) <span class="fu">sum</span>(lfs_sdc<span class="sc">@</span>risk<span class="sc">$</span>individual[,<span class="st">"fk"</span>] <span class="sc">&lt;</span> k))</span>
<span id="cb54-355"><a href="#cb54-355" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb54-356"><a href="#cb54-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">part_ind_risk =</span> nb_ind_risk <span class="sc">/</span> <span class="fu">nrow</span>(lfs_2023) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-357"><a href="#cb54-357" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">1</span>)</span>
<span id="cb54-358"><a href="#cb54-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-359"><a href="#cb54-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-360"><a href="#cb54-360" aria-hidden="true" tabindex="-1"></a>On dénombre 77 individus uniques et jusqu'à 7.3% d'individus à risque si nous nous fixons comme objectif de </span>
<span id="cb54-361"><a href="#cb54-361" aria-hidden="true" tabindex="-1"></a>respecter un $10$-anonymat dans notre fichier.</span>
<span id="cb54-362"><a href="#cb54-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-363"><a href="#cb54-363" aria-hidden="true" tabindex="-1"></a>Pour traiter les individus à risque, on se propose d'utiliser un targeted record swapping.</span>
<span id="cb54-364"><a href="#cb54-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-365"><a href="#cb54-365" aria-hidden="true" tabindex="-1"></a><span class="fu">## Préparation pour le swapping</span></span>
<span id="cb54-366"><a href="#cb54-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-369"><a href="#cb54-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-370"><a href="#cb54-370" aria-hidden="true" tabindex="-1"></a>risk_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGE6"</span>,<span class="st">"SEXE"</span>,<span class="st">"DIP7"</span>) <span class="co"># les variables permettant de mesurer le risque de ré-identification</span></span>
<span id="cb54-371"><a href="#cb54-371" aria-hidden="true" tabindex="-1"></a>hierarchy <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"REG"</span>, <span class="st">"DEP"</span>) <span class="co"># permet de renseigner l'existence d'une hiérarchie entre les var géographiques</span></span>
<span id="cb54-372"><a href="#cb54-372" aria-hidden="true" tabindex="-1"></a>carry_along <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ARR"</span>)</span>
<span id="cb54-373"><a href="#cb54-373" aria-hidden="true" tabindex="-1"></a>similar <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="co"># Contraintes de similarité sur les individus échangés</span></span>
<span id="cb54-374"><a href="#cb54-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"AGE6"</span>,<span class="st">"SEXE"</span>),  <span class="co"># priorité 1</span></span>
<span id="cb54-375"><a href="#cb54-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"AGE6"</span>,<span class="st">"SEXE"</span>), <span class="co"># priorité 2 ...</span></span>
<span id="cb54-376"><a href="#cb54-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"SEXE"</span>), </span>
<span id="cb54-377"><a href="#cb54-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"AGE6"</span>), </span>
<span id="cb54-378"><a href="#cb54-378" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SEXE"</span></span>
<span id="cb54-379"><a href="#cb54-379" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-380"><a href="#cb54-380" aria-hidden="true" tabindex="-1"></a>hid <span class="ot">&lt;-</span> <span class="st">"ID"</span> <span class="co"># swapping d'individus</span></span>
<span id="cb54-381"><a href="#cb54-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-382"><a href="#cb54-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-383"><a href="#cb54-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-384"><a href="#cb54-384" aria-hidden="true" tabindex="-1"></a>La fonction de swapping implémentée dans <span class="in">`sdcMicro`</span> nécessite de transformer toutes les variables en <span class="in">`integer`</span>.</span>
<span id="cb54-387"><a href="#cb54-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-388"><a href="#cb54-388" aria-hidden="true" tabindex="-1"></a>lfs_2023_pr_swap <span class="ot">&lt;-</span> lfs_2023 <span class="sc">|&gt;</span></span>
<span id="cb54-389"><a href="#cb54-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.integer))<span class="sc">|&gt;</span></span>
<span id="cb54-390"><a href="#cb54-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb54-391"><a href="#cb54-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-392"><a href="#cb54-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-393"><a href="#cb54-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-394"><a href="#cb54-394" aria-hidden="true" tabindex="-1"></a><span class="fu">## Swapper les individus</span></span>
<span id="cb54-395"><a href="#cb54-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-396"><a href="#cb54-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-397"><a href="#cb54-397" aria-hidden="true" tabindex="-1"></a>On choisit de nous fixer comme objectif de traiter tous les individus ne respectant pas </span>
<span id="cb54-398"><a href="#cb54-398" aria-hidden="true" tabindex="-1"></a>le $5$-anonymat et d'échanger au moins $10$% des individus. Le premier critère </span>
<span id="cb54-399"><a href="#cb54-399" aria-hidden="true" tabindex="-1"></a>consiste à rendre obligatoire l'échange des individus ne respectant le </span>
<span id="cb54-400"><a href="#cb54-400" aria-hidden="true" tabindex="-1"></a>niveau d'anonymat requis. Le second quant à lui fixe un minimum global d'échanges </span>
<span id="cb54-401"><a href="#cb54-401" aria-hidden="true" tabindex="-1"></a>à atteindre.</span>
<span id="cb54-402"><a href="#cb54-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-405"><a href="#cb54-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-406"><a href="#cb54-406" aria-hidden="true" tabindex="-1"></a>k_anonymity <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb54-407"><a href="#cb54-407" aria-hidden="true" tabindex="-1"></a>swaprate <span class="ot">&lt;-</span> .<span class="dv">1</span></span>
<span id="cb54-408"><a href="#cb54-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-409"><a href="#cb54-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-412"><a href="#cb54-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-413"><a href="#cb54-413" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="ot">&lt;-</span> <span class="fu">recordSwap</span>(</span>
<span id="cb54-414"><a href="#cb54-414" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> lfs_2023_pr_swap,</span>
<span id="cb54-415"><a href="#cb54-415" aria-hidden="true" tabindex="-1"></a>  <span class="at">hid =</span> hid,</span>
<span id="cb54-416"><a href="#cb54-416" aria-hidden="true" tabindex="-1"></a>  <span class="at">hierarchy =</span> hierarchy,</span>
<span id="cb54-417"><a href="#cb54-417" aria-hidden="true" tabindex="-1"></a>  <span class="at">similar =</span> similar,</span>
<span id="cb54-418"><a href="#cb54-418" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk_variables =</span> key_vars,</span>
<span id="cb54-419"><a href="#cb54-419" aria-hidden="true" tabindex="-1"></a>  <span class="at">carry_along =</span> carry_along,</span>
<span id="cb54-420"><a href="#cb54-420" aria-hidden="true" tabindex="-1"></a>  <span class="at">k_anonymity =</span> k_anonymity,</span>
<span id="cb54-421"><a href="#cb54-421" aria-hidden="true" tabindex="-1"></a>  <span class="at">swaprate =</span> swaprate,</span>
<span id="cb54-422"><a href="#cb54-422" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_swapped_id =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-423"><a href="#cb54-423" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123456</span> <span class="co"># pour la reproductibilité</span></span>
<span id="cb54-424"><a href="#cb54-424" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-425"><a href="#cb54-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-426"><a href="#cb54-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-427"><a href="#cb54-427" aria-hidden="true" tabindex="-1"></a>Le taux de swapping réel est légèrement supérieur au taux de swapping demandé <span class="in">`r swaprate`</span>:</span>
<span id="cb54-428"><a href="#cb54-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-431"><a href="#cb54-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-432"><a href="#cb54-432" aria-hidden="true" tabindex="-1"></a>ind_risk <span class="ot">&lt;-</span> <span class="fu">which</span>(lfs_sdc<span class="sc">@</span>risk<span class="sc">$</span>individual[,<span class="st">"fk"</span>] <span class="sc">&lt;</span> <span class="dv">5</span>)</span>
<span id="cb54-433"><a href="#cb54-433" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="sc">|&gt;</span> <span class="fu">summarise</span>(</span>
<span id="cb54-434"><a href="#cb54-434" aria-hidden="true" tabindex="-1"></a>  <span class="at">part_indiv_risq =</span> <span class="fu">mean</span>(ID <span class="sc">%in%</span> ind_risk)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb54-435"><a href="#cb54-435" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx_swap_reel =</span> <span class="fu">mean</span>(ID <span class="sc">!=</span> ID_swapped) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb54-436"><a href="#cb54-436" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-437"><a href="#cb54-437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-438"><a href="#cb54-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-439"><a href="#cb54-439" aria-hidden="true" tabindex="-1"></a>En réalité, un certain nombre d'individus à risque ont été échangés entre eux :</span>
<span id="cb54-440"><a href="#cb54-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-443"><a href="#cb54-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-444"><a href="#cb54-444" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="sc">|&gt;</span></span>
<span id="cb54-445"><a href="#cb54-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(ind_risk) <span class="sc">|&gt;</span></span>
<span id="cb54-446"><a href="#cb54-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID_swapped <span class="sc">%in%</span> ind_risk) <span class="sc">|&gt;</span></span>
<span id="cb54-447"><a href="#cb54-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="sc">/</span><span class="dv">2</span></span>
<span id="cb54-448"><a href="#cb54-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-449"><a href="#cb54-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-450"><a href="#cb54-450" aria-hidden="true" tabindex="-1"></a>Et quelques individus, ne figurant pas dans la liste des individus à risque, </span>
<span id="cb54-451"><a href="#cb54-451" aria-hidden="true" tabindex="-1"></a>ont également été échangés entre eux:</span>
<span id="cb54-452"><a href="#cb54-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-455"><a href="#cb54-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-456"><a href="#cb54-456" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="sc">|&gt;</span></span>
<span id="cb54-457"><a href="#cb54-457" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ID <span class="sc">!=</span> ID_swapped) <span class="sc">|&gt;</span></span>
<span id="cb54-458"><a href="#cb54-458" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n_echanges_no_risque =</span> <span class="fu">sum</span>(<span class="sc">!</span>ID_swapped <span class="sc">%in%</span> ind_risk <span class="sc">&amp;</span> <span class="sc">!</span>ID <span class="sc">%in%</span> ind_risk)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb54-459"><a href="#cb54-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-460"><a href="#cb54-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-461"><a href="#cb54-461" aria-hidden="true" tabindex="-1"></a>Le taux d'échange est très différent selon les régions, dépendant du nombre </span>
<span id="cb54-462"><a href="#cb54-462" aria-hidden="true" tabindex="-1"></a>d'individus problématiques en termes de risque de divulgation au sein de chacune d'elles:</span>
<span id="cb54-463"><a href="#cb54-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-466"><a href="#cb54-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-467"><a href="#cb54-467" aria-hidden="true" tabindex="-1"></a>lfs_swapped <span class="sc">|&gt;</span> </span>
<span id="cb54-468"><a href="#cb54-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(REG) <span class="sc">%&gt;%</span></span>
<span id="cb54-469"><a href="#cb54-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb54-470"><a href="#cb54-470" aria-hidden="true" tabindex="-1"></a>    <span class="at">part_indiv_risq =</span> <span class="fu">mean</span>(ID <span class="sc">%in%</span> ind_risk)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb54-471"><a href="#cb54-471" aria-hidden="true" tabindex="-1"></a>    <span class="at">tx_swap_reel =</span> <span class="fu">mean</span>(ID <span class="sc">!=</span> ID_swapped) <span class="sc">*</span><span class="dv">100</span></span>
<span id="cb54-472"><a href="#cb54-472" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb54-473"><a href="#cb54-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-474"><a href="#cb54-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-475"><a href="#cb54-475" aria-hidden="true" tabindex="-1"></a>La fonction fait en sorte d'atteindre le taux de swapping souhaité (dans notre </span>
<span id="cb54-476"><a href="#cb54-476" aria-hidden="true" tabindex="-1"></a>cas $10\%$ dans chacune des régions). Cela explique pourquoi le taux de swapping </span>
<span id="cb54-477"><a href="#cb54-477" aria-hidden="true" tabindex="-1"></a>global observé peut être légèrement supérieur au taux de swapping fixé initialement.</span>
<span id="cb54-478"><a href="#cb54-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-479"><a href="#cb54-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-480"><a href="#cb54-480" aria-hidden="true" tabindex="-1"></a><span class="fu">## La base après swapping</span></span>
<span id="cb54-481"><a href="#cb54-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-482"><a href="#cb54-482" aria-hidden="true" tabindex="-1"></a>La base de données fournit les informations individuelles de chaque individu </span>
<span id="cb54-483"><a href="#cb54-483" aria-hidden="true" tabindex="-1"></a>dans leur nouvelle localisation.</span>
<span id="cb54-484"><a href="#cb54-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-487"><a href="#cb54-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-488"><a href="#cb54-488" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(lfs_swapped)</span>
<span id="cb54-489"><a href="#cb54-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-490"><a href="#cb54-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-491"><a href="#cb54-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-492"><a href="#cb54-492" aria-hidden="true" tabindex="-1"></a><span class="fu">### Un exemple d'échange</span></span>
<span id="cb54-493"><a href="#cb54-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-496"><a href="#cb54-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-497"><a href="#cb54-497" aria-hidden="true" tabindex="-1"></a>premier_couple <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span> <span class="fu">slice</span>(ind_risk[<span class="dv">1</span>]) <span class="sc">|&gt;</span></span>
<span id="cb54-498"><a href="#cb54-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(lfs_swapped <span class="sc">|&gt;</span> <span class="fu">filter</span>(ID_swapped <span class="sc">==</span> ind_risk[<span class="dv">1</span>]))</span>
<span id="cb54-499"><a href="#cb54-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-500"><a href="#cb54-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-503"><a href="#cb54-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-504"><a href="#cb54-504" aria-hidden="true" tabindex="-1"></a>premier_couple </span>
<span id="cb54-505"><a href="#cb54-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-506"><a href="#cb54-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-507"><a href="#cb54-507" aria-hidden="true" tabindex="-1"></a>On peut remarquer que ces individus ne sont similaires que sur les variables </span>
<span id="cb54-508"><a href="#cb54-508" aria-hidden="true" tabindex="-1"></a>de similarité que sont le sexe et l'âge (<span class="in">`AGE6`</span>). En revanche, l'échange a eu </span>
<span id="cb54-509"><a href="#cb54-509" aria-hidden="true" tabindex="-1"></a>lieu entre deux individus de régions différentes: l'individu n°3 résidant </span>
<span id="cb54-510"><a href="#cb54-510" aria-hidden="true" tabindex="-1"></a>dans la région $2$ originellement a été échangé avec un individu résidant </span>
<span id="cb54-511"><a href="#cb54-511" aria-hidden="true" tabindex="-1"></a>dans la région $1$.</span>
<span id="cb54-512"><a href="#cb54-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-513"><a href="#cb54-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-514"><a href="#cb54-514" aria-hidden="true" tabindex="-1"></a><span class="fu">### Echanges selon l'ordre des priorités de similarité</span></span>
<span id="cb54-515"><a href="#cb54-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-518"><a href="#cb54-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-519"><a href="#cb54-519" aria-hidden="true" tabindex="-1"></a>lfs_swap_vs_orig <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span></span>
<span id="cb54-520"><a href="#cb54-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(lfs_2023_pr_swap, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_s"</span>,<span class="st">"_o"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb54-521"><a href="#cb54-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">!=</span> ID_swapped) <span class="sc">|&gt;</span></span>
<span id="cb54-522"><a href="#cb54-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-523"><a href="#cb54-523" aria-hidden="true" tabindex="-1"></a>    <span class="at">test1 =</span> REG_s <span class="sc">==</span> REG_o,</span>
<span id="cb54-524"><a href="#cb54-524" aria-hidden="true" tabindex="-1"></a>    <span class="at">test2 =</span> SEXE_s <span class="sc">==</span> SEXE_o,</span>
<span id="cb54-525"><a href="#cb54-525" aria-hidden="true" tabindex="-1"></a>    <span class="at">test3 =</span> AGE6_s <span class="sc">==</span> AGE6_o</span>
<span id="cb54-526"><a href="#cb54-526" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb54-527"><a href="#cb54-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-528"><a href="#cb54-528" aria-hidden="true" tabindex="-1"></a>lfs_swap_vs_orig <span class="sc">|&gt;</span></span>
<span id="cb54-529"><a href="#cb54-529" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(ID %in% ind_risk) |&gt;</span></span>
<span id="cb54-530"><a href="#cb54-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb54-531"><a href="#cb54-531" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_reg_sex_age =</span> <span class="fu">sum</span>(test1 <span class="sc">&amp;</span> test2 <span class="sc">&amp;</span> test3),</span>
<span id="cb54-532"><a href="#cb54-532" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_sex_age =</span> <span class="fu">sum</span>(<span class="sc">!</span>test1 <span class="sc">&amp;</span> test2 <span class="sc">&amp;</span> test3),</span>
<span id="cb54-533"><a href="#cb54-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_reg_sex =</span> <span class="fu">sum</span>(test1 <span class="sc">&amp;</span> test2 <span class="sc">&amp;</span> <span class="sc">!</span>test3),</span>
<span id="cb54-534"><a href="#cb54-534" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_reg_age =</span> <span class="fu">sum</span>(test1 <span class="sc">&amp;</span> <span class="sc">!</span>test2 <span class="sc">&amp;</span> test3),</span>
<span id="cb54-535"><a href="#cb54-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_reg =</span> <span class="fu">sum</span>(test1 <span class="sc">&amp;</span> <span class="sc">!</span>test2 <span class="sc">&amp;</span> <span class="sc">!</span>test3),</span>
<span id="cb54-536"><a href="#cb54-536" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_sex =</span> <span class="fu">sum</span>(<span class="sc">!</span>test1 <span class="sc">&amp;</span> test2 <span class="sc">&amp;</span> <span class="sc">!</span>test3),</span>
<span id="cb54-537"><a href="#cb54-537" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb54-538"><a href="#cb54-538" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"ordre_priorite"</span>, <span class="at">values_to =</span> <span class="st">"NB"</span>) </span>
<span id="cb54-539"><a href="#cb54-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-540"><a href="#cb54-540" aria-hidden="true" tabindex="-1"></a>$2~494$ individus ont été échangés avec des individus résidant dans la même </span>
<span id="cb54-541"><a href="#cb54-541" aria-hidden="true" tabindex="-1"></a>région, de même sexe et de la même catégorie d'âge. En revanche, $1~480$ individus</span>
<span id="cb54-542"><a href="#cb54-542" aria-hidden="true" tabindex="-1"></a>(en réalité les individus à risque) ont été échangés avec des individus de même </span>
<span id="cb54-543"><a href="#cb54-543" aria-hidden="true" tabindex="-1"></a>sexe et de même âge, mais résidant en dehors de la région. </span>
<span id="cb54-544"><a href="#cb54-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-545"><a href="#cb54-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-546"><a href="#cb54-546" aria-hidden="true" tabindex="-1"></a>Notons que dans cet exemple, tous les individus ayant été échangés avec des </span>
<span id="cb54-547"><a href="#cb54-547" aria-hidden="true" tabindex="-1"></a>individus de même sexe et de même âge, le swapping ne génère pas d'incohérence </span>
<span id="cb54-548"><a href="#cb54-548" aria-hidden="true" tabindex="-1"></a>dans la composition des ménages: leur taille et leur composition adultes/enfants </span>
<span id="cb54-549"><a href="#cb54-549" aria-hidden="true" tabindex="-1"></a>restant parfaitement préservées.</span>
<span id="cb54-550"><a href="#cb54-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-551"><a href="#cb54-551" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb54-552"><a href="#cb54-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-553"><a href="#cb54-553" aria-hidden="true" tabindex="-1"></a><span class="co">#### Vérifier que les individus à risque ont bien été swappés</span></span>
<span id="cb54-554"><a href="#cb54-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-557"><a href="#cb54-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-558"><a href="#cb54-558" aria-hidden="true" tabindex="-1"></a><span class="co">lfs_swapped </span></span>
<span id="cb54-559"><a href="#cb54-559" aria-hidden="true" tabindex="-1"></a><span class="co">```</span></span>
<span id="cb54-560"><a href="#cb54-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-561"><a href="#cb54-561" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb54-562"><a href="#cb54-562" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb54-563"><a href="#cb54-563" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb54-564"><a href="#cb54-564" aria-hidden="true" tabindex="-1"></a><span class="fu">## Echanger les ménages</span></span>
<span id="cb54-565"><a href="#cb54-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-566"><a href="#cb54-566" aria-hidden="true" tabindex="-1"></a>Et si on avait échangé les ménages plutôt que les individus, qu'en aurait-il </span>
<span id="cb54-567"><a href="#cb54-567" aria-hidden="true" tabindex="-1"></a>été ?</span>
<span id="cb54-568"><a href="#cb54-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-571"><a href="#cb54-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-572"><a href="#cb54-572" aria-hidden="true" tabindex="-1"></a>similarHH <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"HH_TAILLE"</span>, <span class="st">"HH_AGE"</span>), <span class="fu">c</span>(<span class="st">"HH_TAILLE"</span>), <span class="fu">c</span>(<span class="st">"HH_AGE"</span>))</span>
<span id="cb54-573"><a href="#cb54-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-574"><a href="#cb54-574" aria-hidden="true" tabindex="-1"></a>lfs_swapped_hh <span class="ot">&lt;-</span> <span class="fu">recordSwap</span>(</span>
<span id="cb54-575"><a href="#cb54-575" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> lfs_2023_pr_swap,</span>
<span id="cb54-576"><a href="#cb54-576" aria-hidden="true" tabindex="-1"></a>  <span class="at">hid =</span> <span class="st">"HHID"</span>, <span class="co"># identifiant des ménages</span></span>
<span id="cb54-577"><a href="#cb54-577" aria-hidden="true" tabindex="-1"></a>  <span class="at">hierarchy =</span> hierarchy,</span>
<span id="cb54-578"><a href="#cb54-578" aria-hidden="true" tabindex="-1"></a>  <span class="at">similar =</span> similarHH,</span>
<span id="cb54-579"><a href="#cb54-579" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk_variables =</span> risk_variables,</span>
<span id="cb54-580"><a href="#cb54-580" aria-hidden="true" tabindex="-1"></a>  <span class="at">carry_along =</span> carry_along,</span>
<span id="cb54-581"><a href="#cb54-581" aria-hidden="true" tabindex="-1"></a>  <span class="at">k_anonymity =</span> k_anonymity,</span>
<span id="cb54-582"><a href="#cb54-582" aria-hidden="true" tabindex="-1"></a>  <span class="at">swaprate =</span> swaprate,</span>
<span id="cb54-583"><a href="#cb54-583" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_swapped_id =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-584"><a href="#cb54-584" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123456</span></span>
<span id="cb54-585"><a href="#cb54-585" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-586"><a href="#cb54-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-587"><a href="#cb54-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-588"><a href="#cb54-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-589"><a href="#cb54-589" aria-hidden="true" tabindex="-1"></a><span class="fu">### Taux de swapping observé</span></span>
<span id="cb54-590"><a href="#cb54-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-591"><a href="#cb54-591" aria-hidden="true" tabindex="-1"></a>Combien d'individus ont-ils été échangés ? </span>
<span id="cb54-592"><a href="#cb54-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-595"><a href="#cb54-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-596"><a href="#cb54-596" aria-hidden="true" tabindex="-1"></a>lfs_swapped_hh <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">tx_swap_reel =</span> <span class="fu">mean</span>(HHID <span class="sc">!=</span> HHID_swapped)<span class="sc">*</span><span class="dv">100</span>) </span>
<span id="cb54-597"><a href="#cb54-597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-598"><a href="#cb54-598" aria-hidden="true" tabindex="-1"></a>On observe que le taux de swapping observé est supérieur au taux observé lorsque </span>
<span id="cb54-599"><a href="#cb54-599" aria-hidden="true" tabindex="-1"></a>l'échange n'est opéré qu'au niveau individuel.</span>
<span id="cb54-600"><a href="#cb54-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-601"><a href="#cb54-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-602"><a href="#cb54-602" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mesurer la perte d'utilité </span></span>
<span id="cb54-603"><a href="#cb54-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-604"><a href="#cb54-604" aria-hidden="true" tabindex="-1"></a>Il est important de mesurer l'effet des traitements opérés sur la qualité des </span>
<span id="cb54-605"><a href="#cb54-605" aria-hidden="true" tabindex="-1"></a>données qui seront transmises auprès du public. La mesure de la perte d'information </span>
<span id="cb54-606"><a href="#cb54-606" aria-hidden="true" tabindex="-1"></a>peut s'opérer sur de nombreuses dimensions possibles. Le mieux est de se focaliser </span>
<span id="cb54-607"><a href="#cb54-607" aria-hidden="true" tabindex="-1"></a>sur les besoins prioritaires en termes de restitution de l'information.</span>
<span id="cb54-608"><a href="#cb54-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-609"><a href="#cb54-609" aria-hidden="true" tabindex="-1"></a><span class="fu">### Robustesse de certains comptages</span></span>
<span id="cb54-610"><a href="#cb54-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-613"><a href="#cb54-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-614"><a href="#cb54-614" aria-hidden="true" tabindex="-1"></a>reg_sex_age1 <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, AGE6, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-615"><a href="#cb54-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, AGE6, <span class="at">name =</span> <span class="st">"n_o"</span>))<span class="sc">|&gt;</span></span>
<span id="cb54-616"><a href="#cb54-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb54-617"><a href="#cb54-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o))</span>
<span id="cb54-618"><a href="#cb54-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-619"><a href="#cb54-619" aria-hidden="true" tabindex="-1"></a>reg_sex_age2 <span class="ot">&lt;-</span> lfs_swapped_hh <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, AGE6, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-620"><a href="#cb54-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, AGE6, <span class="at">name =</span> <span class="st">"n_o"</span>))<span class="sc">|&gt;</span></span>
<span id="cb54-621"><a href="#cb54-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb54-622"><a href="#cb54-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o))</span>
<span id="cb54-623"><a href="#cb54-623" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-624"><a href="#cb54-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-625"><a href="#cb54-625" aria-hidden="true" tabindex="-1"></a>Comparons pour les deux swappings (individus et ménages) l'écart absolu moyen du </span>
<span id="cb54-626"><a href="#cb54-626" aria-hidden="true" tabindex="-1"></a>tableau croisant le niveau régional, le sexe et l'âge des individus:</span>
<span id="cb54-627"><a href="#cb54-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-630"><a href="#cb54-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-631"><a href="#cb54-631" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb54-632"><a href="#cb54-632" aria-hidden="true" tabindex="-1"></a>  <span class="at">mad_swap_indiv =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(reg_sex_age1<span class="sc">$</span>n_p <span class="sc">-</span> reg_sex_age1<span class="sc">$</span>n_o)),</span>
<span id="cb54-633"><a href="#cb54-633" aria-hidden="true" tabindex="-1"></a>  <span class="at">mad_swap_menag =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(reg_sex_age2<span class="sc">$</span>n_p <span class="sc">-</span> reg_sex_age2<span class="sc">$</span>n_o))</span>
<span id="cb54-634"><a href="#cb54-634" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-635"><a href="#cb54-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-636"><a href="#cb54-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-637"><a href="#cb54-637" aria-hidden="true" tabindex="-1"></a>La conservation des marges régionales <span class="in">`SEXE*AGE`</span> est de très bonne qualité dans </span>
<span id="cb54-638"><a href="#cb54-638" aria-hidden="true" tabindex="-1"></a>le premier cas. En revanche, dans le cas d'un swapping de ménages, ces marges </span>
<span id="cb54-639"><a href="#cb54-639" aria-hidden="true" tabindex="-1"></a>ont été plus fortement modifiées. Cela s'explique par le fait que dans le premier cas, </span>
<span id="cb54-640"><a href="#cb54-640" aria-hidden="true" tabindex="-1"></a>les trois variables (région, sexe et age) font partie des variables de similarité, </span>
<span id="cb54-641"><a href="#cb54-641" aria-hidden="true" tabindex="-1"></a>mais pas dans le second.</span>
<span id="cb54-642"><a href="#cb54-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-643"><a href="#cb54-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-644"><a href="#cb54-644" aria-hidden="true" tabindex="-1"></a>En comparant les distributions entre elles, on observe qu'elles sont très proches,</span>
<span id="cb54-645"><a href="#cb54-645" aria-hidden="true" tabindex="-1"></a>excepté pour la région $4$, région plus petite et contenant le plus d'individus </span>
<span id="cb54-646"><a href="#cb54-646" aria-hidden="true" tabindex="-1"></a>à risque.</span>
<span id="cb54-647"><a href="#cb54-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-650"><a href="#cb54-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-651"><a href="#cb54-651" aria-hidden="true" tabindex="-1"></a>reg_sex_age1 <span class="sc">|&gt;</span></span>
<span id="cb54-652"><a href="#cb54-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(reg_sex_age2 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>n_o) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">n_sm =</span> n_p), <span class="at">by=</span><span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"SEXE"</span>,<span class="st">"AGE6"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb54-653"><a href="#cb54-653" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(n_p<span class="sc">:</span>n_sm, <span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-654"><a href="#cb54-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n), <span class="dv">0</span>, n)) <span class="sc">|&gt;</span></span>
<span id="cb54-655"><a href="#cb54-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">case_when</span>(type <span class="sc">==</span> <span class="st">"n_o"</span><span class="sc">~</span><span class="st">"original"</span>,type<span class="sc">==</span><span class="st">"n_p"</span><span class="sc">~</span><span class="st">"swap_ind"</span>,<span class="cn">TRUE</span><span class="sc">~</span><span class="st">"swap_men"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb54-656"><a href="#cb54-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb54-657"><a href="#cb54-657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>AGE6, <span class="at">y=</span>n, <span class="at">fill=</span>type), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb54-658"><a href="#cb54-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"data"</span>, <span class="at">palette =</span> <span class="dv">7</span>, <span class="at">type=</span><span class="st">"qual"</span>) <span class="sc">+</span></span>
<span id="cb54-659"><a href="#cb54-659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(REG<span class="sc">~</span>SEXE, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">label =</span> <span class="st">"label_both"</span>) <span class="sc">+</span></span>
<span id="cb54-660"><a href="#cb54-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distributions par sexe, âge et région, selon les données utilisées"</span>) <span class="sc">+</span></span>
<span id="cb54-661"><a href="#cb54-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb54-662"><a href="#cb54-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-663"><a href="#cb54-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-664"><a href="#cb54-664" aria-hidden="true" tabindex="-1"></a>Testons un autre tableau, en prenant une variable qui n'a pas été sélectionnée</span>
<span id="cb54-665"><a href="#cb54-665" aria-hidden="true" tabindex="-1"></a>parmi les variables de similarité.</span>
<span id="cb54-666"><a href="#cb54-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-669"><a href="#cb54-669" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-670"><a href="#cb54-670" aria-hidden="true" tabindex="-1"></a>reg_sex_dip1 <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, DIP7, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-671"><a href="#cb54-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, DIP7, <span class="at">name =</span> <span class="st">"n_o"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb54-672"><a href="#cb54-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb54-673"><a href="#cb54-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o)) <span class="sc">|&gt;</span></span>
<span id="cb54-674"><a href="#cb54-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_abs =</span> <span class="fu">abs</span>(n_p <span class="sc">-</span> n_o)) <span class="sc">|&gt;</span></span>
<span id="cb54-675"><a href="#cb54-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_rel =</span> <span class="fu">ifelse</span>(n_o <span class="sc">&gt;</span> <span class="dv">0</span>, diff_abs<span class="sc">/</span>n_o<span class="sc">*</span><span class="dv">100</span>, (n_p<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb54-676"><a href="#cb54-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-677"><a href="#cb54-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-678"><a href="#cb54-678" aria-hidden="true" tabindex="-1"></a>reg_sex_dip2 <span class="ot">&lt;-</span> lfs_swapped_hh <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, DIP7, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-679"><a href="#cb54-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(REG, SEXE, DIP7, <span class="at">name =</span> <span class="st">"n_o"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb54-680"><a href="#cb54-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb54-681"><a href="#cb54-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o)) <span class="sc">|&gt;</span></span>
<span id="cb54-682"><a href="#cb54-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_abs =</span> <span class="fu">abs</span>(n_p <span class="sc">-</span> n_o)) <span class="sc">|&gt;</span></span>
<span id="cb54-683"><a href="#cb54-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_rel =</span> <span class="fu">ifelse</span>(n_o <span class="sc">&gt;</span> <span class="dv">0</span>, diff_abs<span class="sc">/</span>n_o<span class="sc">*</span><span class="dv">100</span>, (n_p<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb54-684"><a href="#cb54-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-685"><a href="#cb54-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-686"><a href="#cb54-686" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb54-687"><a href="#cb54-687" aria-hidden="true" tabindex="-1"></a>  <span class="at">mad_swap_indiv =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(reg_sex_dip1<span class="sc">$</span>n_p <span class="sc">-</span> reg_sex_dip1<span class="sc">$</span>n_o)),</span>
<span id="cb54-688"><a href="#cb54-688" aria-hidden="true" tabindex="-1"></a>  <span class="at">mad_swap_menag =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(reg_sex_dip2<span class="sc">$</span>n_p <span class="sc">-</span> reg_sex_dip2<span class="sc">$</span>n_o))</span>
<span id="cb54-689"><a href="#cb54-689" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-690"><a href="#cb54-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-691"><a href="#cb54-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-692"><a href="#cb54-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-695"><a href="#cb54-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-696"><a href="#cb54-696" aria-hidden="true" tabindex="-1"></a>reg_sex_dip1 <span class="sc">|&gt;</span></span>
<span id="cb54-697"><a href="#cb54-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(reg_sex_dip2 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>n_o) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">n_sm =</span> n_p), <span class="at">by=</span><span class="fu">c</span>(<span class="st">"REG"</span>,<span class="st">"SEXE"</span>,<span class="st">"DIP7"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb54-698"><a href="#cb54-698" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(n_p<span class="sc">:</span>n_sm, <span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-699"><a href="#cb54-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n), <span class="dv">0</span>, n)) <span class="sc">|&gt;</span></span>
<span id="cb54-700"><a href="#cb54-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">case_when</span>(type <span class="sc">==</span> <span class="st">"n_o"</span><span class="sc">~</span><span class="st">"original"</span>,type<span class="sc">==</span><span class="st">"n_p"</span><span class="sc">~</span><span class="st">"swap_ind"</span>,<span class="cn">TRUE</span><span class="sc">~</span><span class="st">"swap_men"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb54-701"><a href="#cb54-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb54-702"><a href="#cb54-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>DIP7, <span class="at">y=</span>n, <span class="at">fill=</span>type), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb54-703"><a href="#cb54-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"data"</span>, <span class="at">palette =</span> <span class="dv">7</span>, <span class="at">type=</span><span class="st">"qual"</span>) <span class="sc">+</span></span>
<span id="cb54-704"><a href="#cb54-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(REG<span class="sc">~</span>SEXE, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">label =</span> <span class="st">"label_both"</span>) <span class="sc">+</span></span>
<span id="cb54-705"><a href="#cb54-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distributions par sexe, diplôme et région, selon les données utilisées"</span>) <span class="sc">+</span></span>
<span id="cb54-706"><a href="#cb54-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb54-707"><a href="#cb54-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-708"><a href="#cb54-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-709"><a href="#cb54-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-710"><a href="#cb54-710" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analyse statistique </span></span>
<span id="cb54-711"><a href="#cb54-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-712"><a href="#cb54-712" aria-hidden="true" tabindex="-1"></a>On se propose de  comparer les intervalles de confiance des coefficients d'un modèle logistique </span>
<span id="cb54-713"><a href="#cb54-713" aria-hidden="true" tabindex="-1"></a>pour évaluer la perte d'information engendrée par le swapping. L'idée est de tester </span>
<span id="cb54-714"><a href="#cb54-714" aria-hidden="true" tabindex="-1"></a>les limites d'utilisation du jeu de données traité par les futurs utilisateurs.</span>
<span id="cb54-715"><a href="#cb54-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-718"><a href="#cb54-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-719"><a href="#cb54-719" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/fun_cio.R"</span>)</span>
<span id="cb54-720"><a href="#cb54-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-721"><a href="#cb54-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-722"><a href="#cb54-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-723"><a href="#cb54-723" aria-hidden="true" tabindex="-1"></a>Étudions la stabilité d'un modèle relativement simple, cherchant à expliquer </span>
<span id="cb54-724"><a href="#cb54-724" aria-hidden="true" tabindex="-1"></a>le fait d'être au chômage par différentes variables à notre disposition:</span>
<span id="cb54-725"><a href="#cb54-725" aria-hidden="true" tabindex="-1"></a>l'âge, le diplôme et le sexe.</span>
<span id="cb54-726"><a href="#cb54-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-727"><a href="#cb54-727" aria-hidden="true" tabindex="-1"></a>On entraînera ce modèle uniquement sur la population active. On retire donc notamment </span>
<span id="cb54-728"><a href="#cb54-728" aria-hidden="true" tabindex="-1"></a>la population étudiante et retraitée.</span>
<span id="cb54-729"><a href="#cb54-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-730"><a href="#cb54-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-733"><a href="#cb54-733" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-734"><a href="#cb54-734" aria-hidden="true" tabindex="-1"></a>lfs_2023_pr_glm <span class="ot">&lt;-</span> lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>IS_CHOM, as.character))</span>
<span id="cb54-735"><a href="#cb54-735" aria-hidden="true" tabindex="-1"></a>lfs_pert_pr_glm <span class="ot">&lt;-</span> lfs_swapped <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>IS_CHOM, as.character))</span>
<span id="cb54-736"><a href="#cb54-736" aria-hidden="true" tabindex="-1"></a>lfs_pert_hh_pr_glm <span class="ot">&lt;-</span> lfs_swapped_hh <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>IS_CHOM, as.character))</span>
<span id="cb54-737"><a href="#cb54-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-738"><a href="#cb54-738" aria-hidden="true" tabindex="-1"></a>m_original <span class="ot">&lt;-</span> <span class="fu">glm</span>(IS_CHOM <span class="sc">~</span> REG <span class="sc">+</span> SEXE <span class="sc">+</span> AGE6 <span class="sc">+</span> DIP7, <span class="at">data =</span> lfs_2023_pr_glm <span class="sc">|&gt;</span> <span class="fu">filter</span>(ACTEU <span class="sc">!=</span> <span class="dv">3</span>))</span>
<span id="cb54-739"><a href="#cb54-739" aria-hidden="true" tabindex="-1"></a>m_swapped <span class="ot">&lt;-</span> <span class="fu">glm</span>(IS_CHOM <span class="sc">~</span> REG <span class="sc">+</span> SEXE <span class="sc">+</span> AGE6 <span class="sc">+</span> DIP7, <span class="at">data =</span> lfs_pert_pr_glm <span class="sc">|&gt;</span> <span class="fu">filter</span>(ACTEU <span class="sc">!=</span> <span class="dv">3</span>))</span>
<span id="cb54-740"><a href="#cb54-740" aria-hidden="true" tabindex="-1"></a>m_swapped_hh <span class="ot">&lt;-</span> <span class="fu">glm</span>(IS_CHOM <span class="sc">~</span> REG <span class="sc">+</span> SEXE <span class="sc">+</span> AGE6 <span class="sc">+</span> DIP7, <span class="at">data =</span> lfs_pert_hh_pr_glm <span class="sc">|&gt;</span> <span class="fu">filter</span>(ACTEU <span class="sc">!=</span> <span class="dv">3</span>))</span>
<span id="cb54-741"><a href="#cb54-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-742"><a href="#cb54-742" aria-hidden="true" tabindex="-1"></a>mes_modeles <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb54-743"><a href="#cb54-743" aria-hidden="true" tabindex="-1"></a>  <span class="st">"original"</span> <span class="ot">=</span> m_original,</span>
<span id="cb54-744"><a href="#cb54-744" aria-hidden="true" tabindex="-1"></a>  <span class="st">"swapped_indiv"</span> <span class="ot">=</span> m_swapped,</span>
<span id="cb54-745"><a href="#cb54-745" aria-hidden="true" tabindex="-1"></a>  <span class="st">"swapped_menag"</span> <span class="ot">=</span> m_swapped_hh</span>
<span id="cb54-746"><a href="#cb54-746" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-747"><a href="#cb54-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-748"><a href="#cb54-748" aria-hidden="true" tabindex="-1"></a>all_cios <span class="ot">&lt;-</span> <span class="fu">get_all_confints</span>(mes_modeles)</span>
<span id="cb54-749"><a href="#cb54-749" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-750"><a href="#cb54-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-751"><a href="#cb54-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-754"><a href="#cb54-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-755"><a href="#cb54-755" aria-hidden="true" tabindex="-1"></a><span class="fu">graph_cios</span>(</span>
<span id="cb54-756"><a href="#cb54-756" aria-hidden="true" tabindex="-1"></a>  all_cios <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">substr</span>(vars, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DEP1"</span>,<span class="st">"AGE6"</span>,<span class="st">"DIP7"</span>)), <span class="at">titre =</span> <span class="st">"Superposition des intervalles de confiance à 95%</span><span class="sc">\n</span><span class="st">des Odds Ratio du modèle logistique selon le jeu de données"</span>) </span>
<span id="cb54-757"><a href="#cb54-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-758"><a href="#cb54-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-759"><a href="#cb54-759" aria-hidden="true" tabindex="-1"></a>Le modèle conduit aux mêmes conclusions quelque soit les traitements opérés </span>
<span id="cb54-760"><a href="#cb54-760" aria-hidden="true" tabindex="-1"></a>que celles tenues àpartir du jeu original. Dans ce cas simple, la perturbation </span>
<span id="cb54-761"><a href="#cb54-761" aria-hidden="true" tabindex="-1"></a>rend possible une analyse statistique multivariée.</span>
<span id="cb54-762"><a href="#cb54-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-763"><a href="#cb54-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-764"><a href="#cb54-764" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercice </span></span>
<span id="cb54-765"><a href="#cb54-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-766"><a href="#cb54-766" aria-hidden="true" tabindex="-1"></a>Comparer la perte d'information de différents taux de swapping ou de différents</span>
<span id="cb54-767"><a href="#cb54-767" aria-hidden="true" tabindex="-1"></a>niveaux d'anonymité. Vous utiliserez la mesure de perte d'information </span>
<span id="cb54-768"><a href="#cb54-768" aria-hidden="true" tabindex="-1"></a>que vous souhaitez.</span>
<span id="cb54-769"><a href="#cb54-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-770"><a href="#cb54-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-773"><a href="#cb54-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-774"><a href="#cb54-774" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb54-775"><a href="#cb54-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb54-776"><a href="#cb54-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-777"><a href="#cb54-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-778"><a href="#cb54-778" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb54-779"><a href="#cb54-779" aria-hidden="true" tabindex="-1"></a>  <span class="at">k_anonymity =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb54-780"><a href="#cb54-780" aria-hidden="true" tabindex="-1"></a>  <span class="at">swaprate =</span> <span class="fl">0.1</span>,</span>
<span id="cb54-781"><a href="#cb54-781" aria-hidden="true" tabindex="-1"></a>  <span class="at">KEEP.OUT.ATTRS =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-782"><a href="#cb54-782" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb54-783"><a href="#cb54-783" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb54-784"><a href="#cb54-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb54-785"><a href="#cb54-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-786"><a href="#cb54-786" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb54-787"><a href="#cb54-787" aria-hidden="true" tabindex="-1"></a>map_ru <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb54-788"><a href="#cb54-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seq_along</span>(params<span class="sc">$</span>k_anonymity),</span>
<span id="cb54-789"><a href="#cb54-789" aria-hidden="true" tabindex="-1"></a>  \(i){</span>
<span id="cb54-790"><a href="#cb54-790" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> params<span class="sc">$</span>k_anonymity[i]</span>
<span id="cb54-791"><a href="#cb54-791" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> params<span class="sc">$</span>swaprate[i]</span>
<span id="cb54-792"><a href="#cb54-792" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-793"><a href="#cb54-793" aria-hidden="true" tabindex="-1"></a>    data_swapped <span class="ot">&lt;-</span> <span class="fu">recordSwap</span>(</span>
<span id="cb54-794"><a href="#cb54-794" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> lfs_2023_pr_swap,</span>
<span id="cb54-795"><a href="#cb54-795" aria-hidden="true" tabindex="-1"></a>      <span class="at">hid =</span> <span class="st">"ID"</span>,</span>
<span id="cb54-796"><a href="#cb54-796" aria-hidden="true" tabindex="-1"></a>      <span class="at">hierarchy =</span> hierarchy,</span>
<span id="cb54-797"><a href="#cb54-797" aria-hidden="true" tabindex="-1"></a>      <span class="at">similar =</span> similar,</span>
<span id="cb54-798"><a href="#cb54-798" aria-hidden="true" tabindex="-1"></a>      <span class="at">risk_variables =</span> risk_variables,</span>
<span id="cb54-799"><a href="#cb54-799" aria-hidden="true" tabindex="-1"></a>      <span class="at">carry_along =</span> carry_along,</span>
<span id="cb54-800"><a href="#cb54-800" aria-hidden="true" tabindex="-1"></a>      <span class="at">k_anonymity =</span> k,</span>
<span id="cb54-801"><a href="#cb54-801" aria-hidden="true" tabindex="-1"></a>      <span class="at">swaprate =</span> s,</span>
<span id="cb54-802"><a href="#cb54-802" aria-hidden="true" tabindex="-1"></a>      <span class="at">return_swapped_id =</span> <span class="cn">TRUE</span></span>
<span id="cb54-803"><a href="#cb54-803" aria-hidden="true" tabindex="-1"></a>      <span class="co"># seed = 123456 # pour la reproductibilité</span></span>
<span id="cb54-804"><a href="#cb54-804" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-805"><a href="#cb54-805" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-806"><a href="#cb54-806" aria-hidden="true" tabindex="-1"></a>    dep_sex_dip_pcs <span class="ot">&lt;-</span> data_swapped <span class="sc">|&gt;</span> <span class="fu">count</span>(DEP,  SEXE, DIP7, PCS1Q, <span class="at">name=</span><span class="st">"n_p"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-807"><a href="#cb54-807" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(lfs_2023_pr_swap <span class="sc">|&gt;</span> <span class="fu">count</span>(DEP,  SEXE, DIP7, PCS1Q, <span class="at">name =</span> <span class="st">"n_o"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb54-808"><a href="#cb54-808" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">n_p =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_p), <span class="dv">0</span>, n_p))<span class="sc">|&gt;</span></span>
<span id="cb54-809"><a href="#cb54-809" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">n_o =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n_o), <span class="dv">0</span>, n_o)) <span class="sc">|&gt;</span></span>
<span id="cb54-810"><a href="#cb54-810" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">diff_abs =</span> <span class="fu">abs</span>(n_p <span class="sc">-</span> n_o)) <span class="sc">|&gt;</span></span>
<span id="cb54-811"><a href="#cb54-811" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">diff_rel =</span> <span class="fu">ifelse</span>(n_o <span class="sc">&gt;</span> <span class="dv">0</span>, diff_abs<span class="sc">/</span>n_o<span class="sc">*</span><span class="dv">100</span>, (n_p<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb54-812"><a href="#cb54-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-813"><a href="#cb54-813" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-814"><a href="#cb54-814" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb54-815"><a href="#cb54-815" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb54-816"><a href="#cb54-816" aria-hidden="true" tabindex="-1"></a>        <span class="at">k =</span> k,</span>
<span id="cb54-817"><a href="#cb54-817" aria-hidden="true" tabindex="-1"></a>        <span class="at">s =</span> s, </span>
<span id="cb54-818"><a href="#cb54-818" aria-hidden="true" tabindex="-1"></a>        <span class="at">sr_reel =</span> <span class="fu">as.numeric</span>(data_swapped <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">mean</span>(ID <span class="sc">!=</span> ID_swapped)) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb54-819"><a href="#cb54-819" aria-hidden="true" tabindex="-1"></a>        <span class="at">mdr =</span> <span class="fu">mean</span>(dep_sex_dip_pcs<span class="sc">$</span>diff_rel)</span>
<span id="cb54-820"><a href="#cb54-820" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb54-821"><a href="#cb54-821" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-822"><a href="#cb54-822" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-823"><a href="#cb54-823" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb54-824"><a href="#cb54-824" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">list_rbind</span>()</span>
<span id="cb54-825"><a href="#cb54-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-826"><a href="#cb54-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-829"><a href="#cb54-829" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-830"><a href="#cb54-830" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb54-831"><a href="#cb54-831" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb54-832"><a href="#cb54-832" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-833"><a href="#cb54-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-834"><a href="#cb54-834" aria-hidden="true" tabindex="-1"></a>map_ru <span class="sc">|&gt;</span></span>
<span id="cb54-835"><a href="#cb54-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb54-836"><a href="#cb54-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>mdr, <span class="at">y=</span>k), <span class="at">color =</span> <span class="st">"forestgreen"</span>)  <span class="sc">+</span></span>
<span id="cb54-837"><a href="#cb54-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Ecart relatif moyen (en %)"</span>, <span class="at">y =</span> <span class="st">"Niveau d'anonymité"</span>) <span class="sc">+</span></span>
<span id="cb54-838"><a href="#cb54-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">1.6</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb54-839"><a href="#cb54-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb54-840"><a href="#cb54-840" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Protection vs Perte d'information"</span>,</span>
<span id="cb54-841"><a href="#cb54-841" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> </span>
<span id="cb54-842"><a href="#cb54-842" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Le niveau de protection est mesuré le niveau d'anonymat et</span></span>
<span id="cb54-843"><a href="#cb54-843" aria-hidden="true" tabindex="-1"></a><span class="st">    la perte d'information par l'écart relatif moyen observé</span></span>
<span id="cb54-844"><a href="#cb54-844" aria-hidden="true" tabindex="-1"></a><span class="st">    dans le tableau DEP*SEXE*DIP*PCS"</span>) <span class="sc">+</span></span>
<span id="cb54-845"><a href="#cb54-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb54-846"><a href="#cb54-846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-847"><a href="#cb54-847" aria-hidden="true" tabindex="-1"></a></span>
</code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 - Insee</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Site réalisé avec Quarto</p>
</div>
  </div>
</footer>




</body></html>