<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Protéger des tableaux avec une méthode suppressive – La protection des données statistiques publiques</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2381ef16587ee3545dadc46b3ee177f2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-6ffa9f061b0aa16b3c8ef6825797175e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-2381ef16587ee3545dadc46b3ee177f2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">La protection des données statistiques publiques</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../theorie/index.html"> 
<span class="menu-text">Un peu de théorie</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pratique/index.html"> 
<span class="menu-text">En pratique</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">À propos</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#initialisation" id="toc-initialisation" class="nav-link active" data-scroll-target="#initialisation">Initialisation</a></li>
  <li><a href="#tabuler-les-données" id="toc-tabuler-les-données" class="nav-link" data-scroll-target="#tabuler-les-données">Tabuler les données</a>
  <ul class="collapse">
  <li><a href="#présentation-des-données-individuelles" id="toc-présentation-des-données-individuelles" class="nav-link" data-scroll-target="#présentation-des-données-individuelles">Présentation des données individuelles</a></li>
  <li><a href="#tabuler-un-indicateur" id="toc-tabuler-un-indicateur" class="nav-link" data-scroll-target="#tabuler-un-indicateur">Tabuler un indicateur</a></li>
  <li><a href="#calculer-plusieurs-indicateurs-en-même-temps" id="toc-calculer-plusieurs-indicateurs-en-même-temps" class="nav-link" data-scroll-target="#calculer-plusieurs-indicateurs-en-même-temps">Calculer plusieurs indicateurs en même temps</a></li>
  </ul></li>
  <li><a href="#poser-le-secret-primaire" id="toc-poser-le-secret-primaire" class="nav-link" data-scroll-target="#poser-le-secret-primaire">Poser le secret primaire</a></li>
  <li><a href="#protéger-un-tableau-simple" id="toc-protéger-un-tableau-simple" class="nav-link" data-scroll-target="#protéger-un-tableau-simple">Protéger un tableau simple</a>
  <ul class="collapse">
  <li><a href="#poser-le-secret-secondaire" id="toc-poser-le-secret-secondaire" class="nav-link" data-scroll-target="#poser-le-secret-secondaire">Poser le secret secondaire</a></li>
  <li><a href="#analyser-les-résultats" id="toc-analyser-les-résultats" class="nav-link" data-scroll-target="#analyser-les-résultats">Analyser les résultats</a>
  <ul class="collapse">
  <li><a href="#les-fichiers-créés-lors-de-lexécution-de-tau-argus" id="toc-les-fichiers-créés-lors-de-lexécution-de-tau-argus" class="nav-link" data-scroll-target="#les-fichiers-créés-lors-de-lexécution-de-tau-argus">Les fichiers créés lors de l’exécution de Tau-Argus</a></li>
  <li><a href="#le-masque" id="toc-le-masque" class="nav-link" data-scroll-target="#le-masque">Le masque</a></li>
  <li><a href="#bilan-du-secret" id="toc-bilan-du-secret" class="nav-link" data-scroll-target="#bilan-du-secret">Bilan du secret</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#proteger-un-tableau-hierarchique" id="toc-proteger-un-tableau-hierarchique" class="nav-link" data-scroll-target="#proteger-un-tableau-hierarchique">Protéger un tableau hiérarchique</a>
  <ul class="collapse">
  <li><a href="#construction-du-fichier-hiérarchique-pour-tau-argus" id="toc-construction-du-fichier-hiérarchique-pour-tau-argus" class="nav-link" data-scroll-target="#construction-du-fichier-hiérarchique-pour-tau-argus">Construction du fichier hiérarchique pour Tau-Argus</a>
  <ul class="collapse">
  <li><a href="#a-la-main" id="toc-a-la-main" class="nav-link" data-scroll-target="#a-la-main">“A la main”</a></li>
  <li><a href="#automatiquement" id="toc-automatiquement" class="nav-link" data-scroll-target="#automatiquement">Automatiquement</a></li>
  </ul></li>
  <li><a href="#protection" id="toc-protection" class="nav-link" data-scroll-target="#protection">Protection</a>
  <ul class="collapse">
  <li><a href="#poser-le-secret-primaire-1" id="toc-poser-le-secret-primaire-1" class="nav-link" data-scroll-target="#poser-le-secret-primaire-1">1. Poser le secret primaire</a></li>
  <li><a href="#lancer-tau-argus-pour-poser-le-secret-secondaire" id="toc-lancer-tau-argus-pour-poser-le-secret-secondaire" class="nav-link" data-scroll-target="#lancer-tau-argus-pour-poser-le-secret-secondaire">2. Lancer Tau-Argus pour poser le secret secondaire</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#protéger-des-tableaux-liés" id="toc-protéger-des-tableaux-liés" class="nav-link" data-scroll-target="#protéger-des-tableaux-liés">Protéger des tableaux liés</a>
  <ul class="collapse">
  <li><a href="#analyser-la-demande" id="toc-analyser-la-demande" class="nav-link" data-scroll-target="#analyser-la-demande">Analyser la demande</a>
  <ul class="collapse">
  <li><a href="#les-tableaux-sont-ils-sur-le-même-champ" id="toc-les-tableaux-sont-ils-sur-le-même-champ" class="nav-link" data-scroll-target="#les-tableaux-sont-ils-sur-le-même-champ">Les tableaux sont-ils sur le même champ ?</a></li>
  <li><a href="#les-tableaux-ont-ils-les-mêmes-variables-réponses" id="toc-les-tableaux-ont-ils-les-mêmes-variables-réponses" class="nav-link" data-scroll-target="#les-tableaux-ont-ils-les-mêmes-variables-réponses">Les tableaux ont-ils les mêmes variables réponses ?</a></li>
  <li><a href="#les-variables-réponses-ont-elles-un-lien-entre-elles" id="toc-les-variables-réponses-ont-elles-un-lien-entre-elles" class="nav-link" data-scroll-target="#les-variables-réponses-ont-elles-un-lien-entre-elles">Les variables réponses ont-elles un lien entre elles ?</a></li>
  <li><a href="#dans-chacun-des-clusters-variables-de-croisement-identiques" id="toc-dans-chacun-des-clusters-variables-de-croisement-identiques" class="nav-link" data-scroll-target="#dans-chacun-des-clusters-variables-de-croisement-identiques">Dans chacun des clusters variables de croisement identiques ?</a></li>
  </ul></li>
  <li><a href="#tabuler-les-données-1" id="toc-tabuler-les-données-1" class="nav-link" data-scroll-target="#tabuler-les-données-1">Tabuler les données</a></li>
  <li><a href="#poser-le-secret-primaire-2" id="toc-poser-le-secret-primaire-2" class="nav-link" data-scroll-target="#poser-le-secret-primaire-2">Poser le secret primaire</a></li>
  <li><a href="#création-des-listes-de-tableaux" id="toc-création-des-listes-de-tableaux" class="nav-link" data-scroll-target="#création-des-listes-de-tableaux">Création des listes de tableaux</a></li>
  <li><a href="#créer-les-hiérarchies" id="toc-créer-les-hiérarchies" class="nav-link" data-scroll-target="#créer-les-hiérarchies">Créer les hiérarchies</a></li>
  <li><a href="#poser-le-secret-secondaire-1" id="toc-poser-le-secret-secondaire-1" class="nav-link" data-scroll-target="#poser-le-secret-secondaire-1">Poser le secret secondaire</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Protéger des tableaux avec une méthode suppressive</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Cette fiche pratique présente une façon de protéger des tableaux en utilisant une méthode suppressive grâce au package <code>rtauargus</code> qui appelle Tau-Argus depuis R. Le code peut être entièrement caché ou visible grâce au bouton à droite du titre. Vous pouvez aussi le faire apparaître ou disparaître au fur et à mesure de la lecture en appuyant sur les boutons &lt;/&gt; Code.</p>
<section id="initialisation" class="level1">
<h1>Initialisation</h1>
<p>Installation du package rtauargus.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'InseeFrLab/rtauargus'</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dependencies =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">build_vignettes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">upgrade =</span> <span class="st">'never'</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import des packages.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtauargus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Modifier le chemin ci-dessous :</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># préciser le chemin de Tau-Argus avant d'utiliser tab_rtauargus() et </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tab_multi_manger() car ces fonctions appelent Tau-Argus</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>loc_tauargus <span class="ot">&lt;-</span> <span class="st">"chemin_vers/TauArgus.exe"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">rtauargus.tauargus_exe =</span> loc_tauargus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tabuler-les-données" class="level1">
<h1>Tabuler les données</h1>
<p>Pour faciliter le passage des microdonnées aux données tabulées une fonction est incluse dans <code>rtauargus</code> : <code>tabulate_micro_data()</code>.</p>
<p>Les arguments de la fonction sont les suivants :<br>
- <code>df</code>: jeu de données individuelles (data.frame ou data.table)<br>
- <code>cat_vars</code>: variables de croisements (catégorielles) non hiérarchiques (vecteur)<br>
- <code>hrc_vars</code>: variables de croisements hiérarchiques sous la forme d’une liste nommée<br>
- <code>pond_var</code>: variable de pondération<br>
- <code>resp_var</code>: indicateur(s), variable(s) de réponse<br>
- <code>marge_label</code>: label utilisé pour les marges (sous-totaux)</p>
<section id="présentation-des-données-individuelles" class="level2">
<h2 class="anchored" data-anchor-id="présentation-des-données-individuelles">Présentation des données individuelles</h2>
<p>Nous créons un jeu de données entreprises (1 ligne = 1 entreprise) pour lesquelles on dispose d’informations telles que l’activité, la catégorie juridique, la géographie d’implantation (variables NUTS) et la tranche d’effectifs. Pour chaque entreprise on dispose également du chiffre d’affaires (CA) selon le type de produits (salades, pizzas, batavias, légumes rouges, etc.).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(micro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [10,000 × 14] (S3: tbl_df/tbl/data.frame)
 $ a10     : chr [1:10000] "BE" "MN" "BE" "OQ" ...
 $ a21     : chr [1:10000] "C" "N" "E" "Q" ...
 $ a88     : chr [1:10000] "C27" "N78" "E38" "Q87" ...
 $ nuts1   : chr [1:10000] "FR1" "FRC" "FRJ" "FRF" ...
 $ nuts2   : chr [1:10000] "FR10" "FRC2" "FRJ2" "FRF2" ...
 $ nuts3   : chr [1:10000] "FR103" "FRC22" "FRJ25" "FRF22" ...
 $ treff   : chr [1:10000] "tr3" "tr1" "tr1" "tr3" ...
 $ cj      : chr [1:10000] "LL" "LL" "LL" "PA" ...
 $ maches  : num [1:10000] 73625 72960 49101 61880 61224 ...
 $ batavias: num [1:10000] 55324 52754 31679 33658 38232 ...
 $ salades : num [1:10000] 128949 125714 80780 95538 99456 ...
 $ tomates : num [1:10000] 130212 344992 164522 176079 145249 ...
 $ pizzas  : num [1:10000] 116520 0 0 267409 0 ...
 $ poids   : num [1:10000] 242 179 184 50 164 103 53 234 239 243 ...</code></pre>
</div>
</div>
</section>
<section id="tabuler-un-indicateur" class="level2">
<h2 class="anchored" data-anchor-id="tabuler-un-indicateur">Tabuler un indicateur</h2>
<p>On veut construire le chiffre d’affaires en salades des entreprises par activité (niveau a88) et par tranche d’effectifs (treff).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>salades <span class="ot">&lt;-</span> <span class="fu">tabulate_micro_data</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> micro,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_var =</span> <span class="fu">c</span>(<span class="st">"a88"</span>, <span class="st">"treff"</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pond_var =</span> <span class="st">"poids"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp_var =</span> <span class="st">"salades"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">marge_label =</span> <span class="st">"Total"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Le résultat est un tableau long avec :</p>
<ul>
<li>Les variables de croisement (a88 et treff)</li>
<li>Différents indicateurs :
<ul>
<li><code>nb_obs</code>: comptage du nombre d’entreprises (pour appliquer la règle de fréquence)</li>
<li><code>salades_tot</code>: indicateur / variable de réponse (ici total du chiffre d’affaire de salades)</li>
<li><code>salades_max</code>: contribution maximale au chiffre d’affaires (pour appliquer la règle de dominance) Toutes les marges (totaux et sous-totaux) ont été ajoutées à la table.</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(salades)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  351 obs. of  5 variables:
 $ a88        : chr  "C27" "N78" "E38" "Q87" ...
 $ treff      : chr  "Total" "Total" "Total" "Total" ...
 $ nb_obs     : num  19554 17371 20839 20224 17122 ...
 $ salades_tot: num  1.74e+09 1.54e+09 1.82e+09 1.86e+09 1.57e+09 ...
 $ salades_max: num  137073 137203 140522 144429 140834 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
</section>
<section id="calculer-plusieurs-indicateurs-en-même-temps" class="level2">
<h2 class="anchored" data-anchor-id="calculer-plusieurs-indicateurs-en-même-temps">Calculer plusieurs indicateurs en même temps</h2>
<p>On veut construire deux tableaux :</p>
<ul>
<li>le chiffre d’affaires de la production de pizzas des entreprises par activité (niveau A10), par tranche d’effectifs (treff) et catégorie juridique (cj);</li>
<li>le chiffre d’affaires de la production de tomates des entreprises par activité (niveau A10), par tranche d’effectifs (treff) et catégorie juridique (cj).</li>
</ul>
<p>Ces deux tableaux ont les mêmes variables de croisement et deux indicateurs différents. Ils peuvent être construits en même temps.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pizzas_tomates <span class="ot">&lt;-</span> <span class="fu">tabulate_micro_data</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> micro,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"a10"</span>, <span class="st">"treff"</span>,<span class="st">"cj"</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pond_var =</span> <span class="st">"poids"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp_var =</span> <span class="fu">c</span>(<span class="st">"pizzas"</span>,<span class="st">"tomates"</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">marge_label =</span> <span class="st">"Ensemble"</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pizzas_tomates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  174 obs. of  8 variables:
 $ a10        : chr  "BE" "MN" "OQ" "RU" ...
 $ treff      : chr  "Ensemble" "Ensemble" "Ensemble" "Ensemble" ...
 $ cj         : chr  "Ensemble" "Ensemble" "Ensemble" "Ensemble" ...
 $ nb_obs     : num  608493 239202 75471 171537 184607 ...
 $ pizzas_tot : num  2.34e+11 9.00e+10 3.14e+10 6.65e+10 7.09e+10 ...
 $ tomates_tot: num  1.54e+11 6.20e+10 1.83e+10 4.44e+10 4.62e+10 ...
 $ pizzas_max : num  899871 898861 899157 898798 899906 ...
 $ tomates_max: num  499928 499883 494816 499526 499837 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
</section>
</section>
<section id="poser-le-secret-primaire" class="level1">
<h1>Poser le secret primaire</h1>
<p><strong>Objectif</strong> : détecter les cellules ne respectant pas les règles de confidentialité dans les tableaux proposés.</p>
<p><strong>Consignes</strong> : vous utiliserez les règles en vigueur à l’Insee pour la diffusion des tableaux issus des enquêtes entreprises.</p>
<ol type="1">
<li>Pour chacun des tableaux, vous ajouterez une variable booléenne indiquant si la cellule est problématique (<code>TRUE</code>) ou non (<code>FALSE</code>), au regard de chacune des règles pertinentes à appliquer:</li>
</ol>
<ul>
<li>Si vous appliquez la règle de fréquence, la variable créée s’appellera <code>is_secret_freq</code>;</li>
<li>Si vous appliquez la règle de dominance, la variable créée s’appellera <code>is_secret_dom</code>.</li>
</ul>
<ol start="2" type="1">
<li>Après avoir posé le secret, vous calculerez le nombre de cellules détectées comme à risque.</li>
</ol>
<p>Le tableau <code>salades</code> est un tableau de volumes (CA), les règles de fréquence et de dominance s’appliquent. D’après la jurisprudence Insee sur la diffusion des données entreprises, le seuil de fréquence est fixé à 3 et le plus gros contributeur ne doit pas contribuer à plus de 85% de la cellule.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>salades_detect <span class="ot">&lt;-</span> salades <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_secret_freq =</span> nb_obs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> nb_obs <span class="sc">&lt;</span> <span class="dv">3</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_secret_dom =</span> (salades_tot <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">&amp;</span> (salades_max <span class="sc">&gt;</span> <span class="fl">0.85</span><span class="sc">*</span>salades_tot),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_secret_prim =</span> is_secret_freq <span class="sc">|</span> is_secret_dom</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>salades_detect <span class="sc">%&gt;%</span> <span class="fu">count</span>(is_secret_freq, is_secret_dom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   is_secret_freq is_secret_dom     n
           &lt;lgcl&gt;        &lt;lgcl&gt; &lt;int&gt;
1:          FALSE         FALSE   347
2:           TRUE         FALSE     2
3:           TRUE          TRUE     2</code></pre>
</div>
</div>
</section>
<section id="protéger-un-tableau-simple" class="level1">
<h1>Protéger un tableau simple</h1>
<p><strong>Objectif</strong> : protéger un tableau simple en appelant Tau-Argus depuis R pour poser le secret secondaire.</p>
<p><strong>Consignes</strong> : vous utiliserez les règles en vigueur à l’Insee pour la diffusion des tableaux issus des enquêtes entreprises.</p>
<section id="poser-le-secret-secondaire" class="level2">
<h2 class="anchored" data-anchor-id="poser-le-secret-secondaire">Poser le secret secondaire</h2>
<p>Poser un masque de secret sur un tableau comprend les étapes suivantes:</p>
<ol type="1">
<li>Tout d’abord on pose le secret primaire. Pour cela, il faut créer créer des variables indicatrices :
<ol type="1">
<li>Pour chacun des tableaux, vous ajouterez une variable booléenne indiquant si la cellule est problématique (<code>TRUE</code>) ou non (<code>FALSE</code>), au regard de chacune des règles pertinentes à appliquer :
<ul>
<li>Si vous appliquez la règle de fréquence, la variable créée s’appellera <code>is_secret_freq</code>;</li>
<li>Si vous appliquez la règle de dominance, la variable créée s’appellera <code>is_secret_dom</code>.</li>
</ul></li>
<li>Puis de créer une variable qu’on appellera <code>is_secret_prim</code>, définie ainsi :
<ul>
<li><code>is_secret_prim = is_secret_freq</code> si seule la règle de fréquence doit s’appliquer;</li>
<li><code>is_secret_prim = is_secret_freq | is_secret_dom</code> si les deux règles doivent s’appliquer;</li>
</ul></li>
</ol></li>
<li>Après avoir posé le secret primaire, vous calculerez le nombre de cellules détectées comme à risque.</li>
<li>Ensuite, il s’agit de poser le secret secondaire en utilisant le package <code>rtauargus</code>. Les consignes d’installation de <code>rtauargus</code> et du logiciel Tau-Argus sont indiquées dans la partie <a href="#initialisation">Initialisation</a>. Vous utiliserez la fonction <code>tab_rtauargus()</code>.</li>
<li>Enfin, vous calculerez le nombre de cellules selon leur statut final. Nous utiliserons pour cela la norme européenne en notant :</li>
</ol>
<ul>
<li><code>A</code> les cellules en secret primaire à cause de la règle de fréquence</li>
<li><code>B</code> les cellules en secret primaire à cause de la règle de dominance (dans le futur ces cellules pourraient être notées <code>O</code>)</li>
<li><code>D</code> les cellules concernées par le secret secondaire</li>
<li><code>V</code> les cellules non touchées par le secret, cad les cellules qui pourront être diffusées.</li>
</ul>
<p>La fonction <code>tab_rtauargus()</code> permet de poser le secret secondaire et requiert les arguments suivants :<br>
- <code>tabular</code> : la table à protéger - <code>dir_name</code> : le nom du répertoire où les fichiers seront sauvegardés - <code>files_name</code> : le nom utilisé pour nommer les fichiers (chaque fichier a une extension différente); - <code>explanatory_vars</code> : le nom des variables de croisements présents dans la table; - <code>secret_var</code> : le nom de la variable indiquant si une cellule est à risque ou non (secret primaire); - <code>value</code> : nom de la variable de réponse; - <code>freq</code> : nom de la variable d’effectifs; - <code>totcode</code> : le code utilisé pour indiquer le total pour chacune des variables de croisements (<code>explanatory_vars</code>).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>salades_masq <span class="ot">&lt;-</span> <span class="fu">tab_rtauargus</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  salades_detect,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"tauargus_files/exo2"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">files_name =</span> <span class="st">"T0"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">explanatory_vars =</span> <span class="fu">c</span>(<span class="st">"a88"</span>,<span class="st">"treff"</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_prim"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"salades_tot"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="st">"nb_obs"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="fu">c</span>(<span class="at">a88=</span><span class="st">"Total"</span>,<span class="at">treff=</span><span class="st">"Total"</span>),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="analyser-les-résultats" class="level2">
<h2 class="anchored" data-anchor-id="analyser-les-résultats">Analyser les résultats</h2>
<section id="les-fichiers-créés-lors-de-lexécution-de-tau-argus" class="level3">
<h3 class="anchored" data-anchor-id="les-fichiers-créés-lors-de-lexécution-de-tau-argus">Les fichiers créés lors de l’exécution de Tau-Argus</h3>
<p>L’ensemble des fichiers créés pendant le processus se trouvent dans le répertoire mentionné dans l’argument <code>dir_name</code>. Tous les fichiers ont le même nom, mais pas la même extension:</p>
<ul>
<li><code>T0.tab</code> : tableau de données</li>
<li><code>T0.hst</code> : fichier d’apriori où sont listées les cellules à risque (secret primaire)</li>
<li><code>T0.rda</code> : fichier de métadonnées;</li>
<li><code>T0.arb</code> : fichier batch, qui sera exécuté par Tau-Argus</li>
<li><code>T0.txt</code> : fichier log, retraçant les étapes exécutées par Tau-Argus</li>
<li><code>T0.csv</code> : masque au format csv</li>
</ul>
</section>
<section id="le-masque" class="level3">
<h3 class="anchored" data-anchor-id="le-masque">Le masque</h3>
<p>Le masque est retourné par la fonction. Ce masque est une copie de la table fournie en entrée à laquelle une variable supplémentaire, <code>Status</code>, est fournie indiquant le statut final de la cellule:</p>
<ul>
<li><code>B</code> : secret primaire (ou apriori)</li>
<li><code>D</code> : secret secondaire</li>
<li><code>V</code> : cellule valide, cad qui peut être diffusée</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(salades_masq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  351 obs. of  9 variables:
 $ a88           : chr  "A01" "A01" "A01" "A01" ...
 $ treff         : chr  "Total" "tr1" "tr2" "tr3" ...
 $ nb_obs        : num  16978 7660 856 8462 19026 ...
 $ salades_tot   : num  1.53e+09 6.99e+08 7.44e+07 7.61e+08 1.67e+09 ...
 $ salades_max   : num  136845 130891 106591 136845 142618 ...
 $ is_secret_freq: logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ is_secret_dom : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ is_secret_prim: logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ Status        : chr  "V" "V" "V" "V" ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 - attr(*, "sorted")= chr [1:2] "a88" "treff"</code></pre>
</div>
</div>
</section>
<section id="bilan-du-secret" class="level3">
<h3 class="anchored" data-anchor-id="bilan-du-secret">Bilan du secret</h3>
<p>Pour faire le bilan du secret le mieux est de modifier la variable <code>Status</code> fournie par Tau-Argus. En effet, cette variable ne permet pas de faire la distinction entre l’origine du secret primaire (fréquence ou dominance).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>salades_masq_statut_final <span class="ot">&lt;-</span> salades_masq <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">statut_final =</span> <span class="fu">case_when</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      is_secret_freq <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      is_secret_dom <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> Status,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Afin de bien appréhender l’impact du secret posé, on va non seulement compter le nombre de cellules masquées, mais aussi calculer la valeur des cellules masquées.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>salades_masq_statut_final <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(statut_final) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cell =</span> <span class="fu">n</span>(),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">val_cell =</span> <span class="fu">sum</span>(salades_tot)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_n_cell =</span> n_cell<span class="sc">/</span><span class="fu">sum</span>(n_cell)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_val_cell =</span> val_cell<span class="sc">/</span><span class="fu">sum</span>(val_cell)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  statut_final n_cell     val_cell pc_n_cell pc_val_cell
  &lt;chr&gt;         &lt;int&gt;        &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
1 A                 4       402294     1.14    0.0000714
2 D                 2       625022     0.570   0.000111 
3 V               345 563464335844    98.3   100.       </code></pre>
</div>
</div>
<p>On masque 1.5% des cellules mais moins de 0.01% de l’information totale.</p>
</section>
</section>
</section>
<section id="proteger-un-tableau-hierarchique" class="level1">
<h1>Protéger un tableau hiérarchique</h1>
<p><strong>Objectifs</strong> : comprendre la notion de variables hiérarchiques et savoir manipuler les objets et fichiers argus qui y sont associés. Pour ensuite, protéger un tableau contenant une ou plusieurs variables hiérarchiques en appelant Tau-Argus depuis R pour poser le secret secondaire.</p>
<p>Reprenons l’exemple présenté dans le diaporama:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>T0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geo =</span> <span class="fu">c</span>(<span class="st">"Pays"</span>,<span class="st">"Nord"</span>,<span class="st">"Ouest"</span>,<span class="st">"Est"</span>,<span class="st">"Sud"</span>,<span class="fu">paste0</span>(<span class="st">"N"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),<span class="fu">paste0</span>(<span class="st">"O"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),<span class="fu">paste0</span>(<span class="st">"E"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">paste0</span>(<span class="st">"S"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="fu">c</span>(<span class="dv">400</span>, <span class="dv">46</span>, <span class="dv">191</span>, <span class="dv">80</span>, <span class="dv">83</span>, <span class="dv">21</span>, <span class="dv">2</span>, <span class="dv">23</span>, <span class="dv">32</span>, <span class="dv">54</span>, <span class="dv">67</span>, <span class="dv">38</span>, <span class="dv">27</span>, <span class="dv">41</span>, <span class="dv">12</span>, <span class="dv">44</span>, <span class="dv">39</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(T0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   17 obs. of  2 variables:
 $ geo : chr  "Pays" "Nord" "Ouest" "Est" ...
 $ freq: num  400 46 191 80 83 21 2 23 32 54 ...</code></pre>
</div>
</div>
<p>La variable <code>geo</code> est une variable hiérarchique puisqu’il existe des emboîtements entre les différents niveaux :</p>
<ul>
<li>Pays = Nord + Ouest + Est + Sud</li>
<li>Nord = N1 + N2 + N3</li>
<li>Ouest = O1 + O2 + O3 + O4</li>
<li>Est = E1 + E2 + E3</li>
<li>Sud = S1 + S2</li>
</ul>
<p>Avant de penser à protéger un tel tableau, il faut pouvoir représenter correctement cette hiérarchie, c’est-à-dire de telle sorte que tau-argus sache comprendre les différents emboîtements présents.</p>
<section id="construction-du-fichier-hiérarchique-pour-tau-argus" class="level2">
<h2 class="anchored" data-anchor-id="construction-du-fichier-hiérarchique-pour-tau-argus">Construction du fichier hiérarchique pour Tau-Argus</h2>
<section id="a-la-main" class="level3">
<h3 class="anchored" data-anchor-id="a-la-main">“A la main”</h3>
<p>La première option consiste à créer le fichier nécessaire (extension .hrc) à la main. Ceci est tout à fait pertinent si la hiérarchie n’est pas trop étendue.</p>
<p>Tau-Argus attend en effet un type de fichier bien particulier, dont l’extension est <code>.hrc</code>. Il s’agit d’un simple fichier texte où les différents emboîtements sont écrits les uns en-dessous des autres. Un symbole (le <code>@</code>) est utilisé pour préciser le niveau de chacun des emboîtements au sein de la hiérarchie.</p>
<p>Par exemple, un fichier contenant les lignes suivantes :</p>
<p>ALL<br>
<span class="citation" data-cites="A">(<a href="#ref-A" role="doc-biblioref"><strong>A?</strong></a>)</span><br>
@<span class="citation" data-cites="A1">(<a href="#ref-A1" role="doc-biblioref"><strong>A1?</strong></a>)</span><br>
@<span class="citation" data-cites="A2">(<a href="#ref-A2" role="doc-biblioref"><strong>A2?</strong></a>)</span><br>
<span class="citation" data-cites="B">(<a href="#ref-B" role="doc-biblioref"><strong>B?</strong></a>)</span><br>
@<span class="citation" data-cites="B1">(<a href="#ref-B1" role="doc-biblioref"><strong>B1?</strong></a>)</span><br>
@<span class="citation" data-cites="B2">(<a href="#ref-B2" role="doc-biblioref"><strong>B2?</strong></a>)</span><br>
@@<span class="citation" data-cites="B21">(<a href="#ref-B21" role="doc-biblioref"><strong>B21?</strong></a>)</span><br>
@@<span class="citation" data-cites="B22">(<a href="#ref-B22" role="doc-biblioref"><strong>B22?</strong></a>)</span><br>
<span class="citation" data-cites="C">(<a href="#ref-C" role="doc-biblioref"><strong>C?</strong></a>)</span></p>
<p>décrit une hiérarchie contenant les emboîtements suivants:</p>
<ul>
<li>ALL = A + B + C =&gt; ALL est le total et A, B et C sont les emboîtements de niveau 1;</li>
<li>A = A1 + A2 =&gt; A1 et A2 sont des sous-niveaux de A, donc des emboîtements de niveau 2;</li>
<li>B = B1 + B2</li>
<li>B2 = B21 + B22</li>
</ul>
<p>Néanmoins, pour utiliser cette hiérarchie avec Tau-Argus, <strong>le super-total (ici “ALL”) ne doit pas apparaître dans le fichier .hrc</strong> qui lui est fourni.</p>
<p>Le bon fichier est donc le suivant :</p>
<p><span class="citation" data-cites="A">(<a href="#ref-A" role="doc-biblioref"><strong>A?</strong></a>)</span><br>
@<span class="citation" data-cites="A1">(<a href="#ref-A1" role="doc-biblioref"><strong>A1?</strong></a>)</span><br>
@<span class="citation" data-cites="A2">(<a href="#ref-A2" role="doc-biblioref"><strong>A2?</strong></a>)</span><br>
<span class="citation" data-cites="B">(<a href="#ref-B" role="doc-biblioref"><strong>B?</strong></a>)</span><br>
@<span class="citation" data-cites="B1">(<a href="#ref-B1" role="doc-biblioref"><strong>B1?</strong></a>)</span><br>
@<span class="citation" data-cites="B2">(<a href="#ref-B2" role="doc-biblioref"><strong>B2?</strong></a>)</span><br>
@@<span class="citation" data-cites="B21">(<a href="#ref-B21" role="doc-biblioref"><strong>B21?</strong></a>)</span><br>
@@<span class="citation" data-cites="B22">(<a href="#ref-B22" role="doc-biblioref"><strong>B22?</strong></a>)</span><br>
<span class="citation" data-cites="C">(<a href="#ref-C" role="doc-biblioref"><strong>C?</strong></a>)</span></p>
</section>
<section id="automatiquement" class="level3">
<h3 class="anchored" data-anchor-id="automatiquement">Automatiquement</h3>
<p>Quand la hiérarchie est très étendue, l’écriture manuelle du fichier de hiérarchie est pénible. Or, quand ce genre de cas se présente, il existe souvent une table de correspondance permettant d’associer les différents niveaux entre eux.</p>
<p>Nous appelons table de correspondance une table qui précise l’ensemble des niveaux associés aux emboîtements les plus fins.</p>
<p>La table de correspondance représentant la hiérarchie suivante :</p>
<p>ALL<br>
<span class="citation" data-cites="A">(<a href="#ref-A" role="doc-biblioref"><strong>A?</strong></a>)</span><br>
@<span class="citation" data-cites="A1">(<a href="#ref-A1" role="doc-biblioref"><strong>A1?</strong></a>)</span><br>
@<span class="citation" data-cites="A2">(<a href="#ref-A2" role="doc-biblioref"><strong>A2?</strong></a>)</span><br>
<span class="citation" data-cites="B">(<a href="#ref-B" role="doc-biblioref"><strong>B?</strong></a>)</span><br>
@<span class="citation" data-cites="B1">(<a href="#ref-B1" role="doc-biblioref"><strong>B1?</strong></a>)</span><br>
@<span class="citation" data-cites="B2">(<a href="#ref-B2" role="doc-biblioref"><strong>B2?</strong></a>)</span><br>
@@<span class="citation" data-cites="B21">(<a href="#ref-B21" role="doc-biblioref"><strong>B21?</strong></a>)</span><br>
@@<span class="citation" data-cites="B22">(<a href="#ref-B22" role="doc-biblioref"><strong>B22?</strong></a>)</span><br>
<span class="citation" data-cites="C">(<a href="#ref-C" role="doc-biblioref"><strong>C?</strong></a>)</span></p>
<p>est la suivante:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>corr_tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv0 =</span> <span class="st">"ALL"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv1 =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"A"</span>,<span class="dv">2</span>),<span class="fu">rep</span>(<span class="st">"B"</span>,<span class="dv">3</span>), <span class="st">"C"</span>),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv2 =</span> <span class="fu">c</span>(<span class="st">"A1"</span>,<span class="st">"A2"</span>,<span class="st">"B1"</span>,<span class="fu">rep</span>(<span class="st">"B2"</span>,<span class="dv">2</span>), <span class="st">"C"</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv3 =</span> <span class="fu">c</span>(<span class="st">"A1"</span>,<span class="st">"A2"</span>,<span class="st">"B1"</span>, <span class="st">"B21"</span>, <span class="st">"B22"</span>, <span class="st">"C"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>corr_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  niv0  niv1  niv2  niv3 
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 ALL   A     A1    A1   
2 ALL   A     A2    A2   
3 ALL   B     B1    B1   
4 ALL   B     B2    B21  
5 ALL   B     B2    B22  
6 ALL   C     C     C    </code></pre>
</div>
</div>
<p>Remarque: La fonction <code>rtauargus::write_hrc2()</code> qui permet de construire le fichier <code>.hrc</code> à partir d’une table de correspondance n’accepte pas de valeurs manquantes dans la table en entrée. C’est pourquoi, à la dernière ligne, par exemple, <code>C</code> n’admettant pas de subdivisions est répété sur les niveaux inférieurs.</p>
<p>Avec la fonction <code>write_hrc2()</code> du package <code>rtauargus</code>, on peut exporter la table de correspondance en un fichier <code>hrc</code>. Comme noté précédemment, Tau-Argus n’acceptant pas que le super-total d’une variable hiérarchique soit présent dans le fichier <code>.hrc</code> on le supprime:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_hrc2</span>(corr_tab <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>niv0), <span class="at">file_name =</span> <span class="st">"fichiers_tauargus/hrc/exemple_TA.hrc"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span>(<span class="st">"fichiers_tauargus/hrc/exemple_TA.hrc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     V1
1     A
2   @A1
3   @A2
4     B
5   @B1
6   @B2
7 @@B21
8 @@B22
9     C</code></pre>
</div>
</div>
</section>
</section>
<section id="protection" class="level2">
<h2 class="anchored" data-anchor-id="protection">Protection</h2>
<p>A présent nous protégeons le tableau T0 pour lequel on vient de construire la hiérarchie.</p>
<p>La variable <code>geo</code> est hiérarchique (Pays = Nord + Ouest + Est + Sud, par exemple), on construit le fichier adéquat.</p>
<p>Table de passage (habituellement elle existe déjà mais pour l’exercice nous la créons) et appel à <code>rtauargus::write_hrc2()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>corr_pays <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv1 =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Nord"</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">"Ouest"</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="st">"Est"</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">"Sud"</span>, <span class="dv">2</span>)),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv2 =</span> <span class="fu">c</span>(<span class="st">"N1"</span>, <span class="st">"N2"</span>, <span class="st">"N3"</span>, <span class="st">"O1"</span>, <span class="st">"O2"</span>, <span class="st">"O3"</span>, <span class="st">"O4"</span>, <span class="st">"E1"</span>, <span class="st">"E2"</span>, <span class="st">"E3"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_hrc2</span>(corr_pays, <span class="at">file_name =</span> <span class="st">"fichiers_tauargus/hrc/pays.hrc"</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span>(<span class="st">"fichiers_tauargus/hrc/pays.hrc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      V1
1   Nord
2    @N1
3    @N2
4    @N3
5  Ouest
6    @O1
7    @O2
8    @O3
9    @O4
10   Est
11   @E1
12   @E2
13   @E3
14   Sud
15   @S1
16   @S2</code></pre>
</div>
</div>
<p>Nous pouvons dès lors poser le masque de secret sur ce tableau. Pour cela, nous faisons toujours appel à la fonction <code>tab_rtauargus</code>.</p>
<section id="poser-le-secret-primaire-1" class="level3">
<h3 class="anchored" data-anchor-id="poser-le-secret-primaire-1">1. Poser le secret primaire</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(T0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   17 obs. of  2 variables:
 $ geo : chr  "Pays" "Nord" "Ouest" "Est" ...
 $ freq: num  400 46 191 80 83 21 2 23 32 54 ...</code></pre>
</div>
</div>
<p>Il s’agit d’un tableau d’effectifs/de fréquence, on pose donc seulement le secret primaire de fréquence.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>T0_detect <span class="ot">&lt;-</span> T0 <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_secret_freq =</span> freq <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> freq <span class="sc">&lt;</span> <span class="dv">3</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(T0_detect<span class="sc">$</span>is_secret_freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE  TRUE 
   16     1 </code></pre>
</div>
</div>
</section>
<section id="lancer-tau-argus-pour-poser-le-secret-secondaire" class="level3">
<h3 class="anchored" data-anchor-id="lancer-tau-argus-pour-poser-le-secret-secondaire">2. Lancer Tau-Argus pour poser le secret secondaire</h3>
<p>Pour que l’information hiérarchique soit bien prise en compte lors de la pose du secret secondaire par Tau-Argus, il suffit de renseigner l’argument <code>hrc =</code> sous la forme d’un vecteur nommé <code>c(var1 = fichier1, var2 = fichier2,...)</code>: le nom de chaque élément étant le nom de la variable concernée et la valeur étant la localisation du fichier <code>.hrc</code> correspondant.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>T0_masq <span class="ot">&lt;-</span> <span class="fu">tab_rtauargus</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  T0_detect,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"fichiers_tauargus/sorties/ex_hrc_pays"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">files_name =</span> <span class="st">"T0"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">explanatory_vars =</span> <span class="st">"geo"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc =</span> <span class="fu">c</span>(<span class="at">geo =</span> <span class="st">"fichiers_tauargus/hrc/pays.hrc"</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_freq"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"freq"</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="fu">c</span>(<span class="at">geo=</span><span class="st">"Pays"</span>),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Vérifions que le secret a été posé correctement :</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>T0_masq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     geo freq is_secret_freq Status
1     E1   27          FALSE      V
2     E2   41          FALSE      V
3     E3   12          FALSE      V
4    Est   80          FALSE      V
5     N1   21          FALSE      D
6     N2    2           TRUE      B
7     N3   23          FALSE      V
8   Nord   46          FALSE      V
9     O1   32          FALSE      V
10    O2   54          FALSE      V
11    O3   67          FALSE      V
12    O4   38          FALSE      V
13 Ouest  191          FALSE      V
14  Pays  400          FALSE      V
15    S1   44          FALSE      V
16    S2   39          FALSE      V
17   Sud   83          FALSE      V</code></pre>
</div>
</div>
<p>La cellule N2 est en secret primaire car elle a une fréquence inférieure à 3. Il faut donc poser un secret secondaire pour protéger cette cellule. On voit que N1 est en secret secondaire ce qui permet de protéger N2 de la différenciation avec le total Nord. Donc, on a bien ici une pose de secret qui respecte la hiérarchie de la variable <code>geo</code>.</p>
<p>Regardons à présent le secret posé sans prendre en compte la hiérarchie sur la variable <code>geo</code> :</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>T0_masq_sans_hrc <span class="ot">&lt;-</span> <span class="fu">tab_rtauargus</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  T0_detect,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"fichiers_tauargus/sorties/ex_hrc_pays"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">files_name =</span> <span class="st">"T0"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">explanatory_vars =</span> <span class="st">"geo"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hrc = c(geo = "fichiers_tauargus/hrc/pays.hrc"),</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_freq"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"freq"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="fu">c</span>(<span class="at">geo=</span><span class="st">"Pays"</span>),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Cette fois-ci le secret secondaire est posé en E3, pour minimiser les valeurs supprimées. Mais ce secret ne tient pas car on peut retrouver la valeur de N2 en faisant N2 = Nord - N1.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>T0_masq_sans_hrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     geo freq is_secret_freq Status
1     E1   27          FALSE      V
2     E2   41          FALSE      V
3     E3   12          FALSE      D
4    Est   80          FALSE      V
5     N1   21          FALSE      V
6     N2    2           TRUE      B
7     N3   23          FALSE      V
8   Nord   46          FALSE      V
9     O1   32          FALSE      V
10    O2   54          FALSE      V
11    O3   67          FALSE      V
12    O4   38          FALSE      V
13 Ouest  191          FALSE      V
14  Pays  400          FALSE      V
15    S1   44          FALSE      V
16    S2   39          FALSE      V
17   Sud   83          FALSE      V</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="protéger-des-tableaux-liés" class="level1">
<h1>Protéger des tableaux liés</h1>
<p>Lorsque l’on souhaite publier plusieurs tableaux il faut suivre une démarche permettant de les protéger de manière cohérente. En effet, il faut identifier les cellules communes entre les tableaux afin de préciser leur existence à <code>rtauargus</code> qui se chargera de la cohérence du secret.</p>
<p>Voici la démarche à suivre : - détecter les cellules communes entre les tableaux à partir des métadonnées - tabuler les données et construire les hiérarchies nécessaires - poser le secret primaire - créer des listes de tableaux indépendantes (une liste = un cluster) - poser le secret secondaire avec <code>rtauargus::tab_multi_manager()</code></p>
<section id="analyser-la-demande" class="level2">
<h2 class="anchored" data-anchor-id="analyser-la-demande">Analyser la demande</h2>
<p>A partir des microdonnées présentées dans la partie “Tabuler les données”, on souhaite publier les tableaux suivants.</p>
<div class="cell" data-as-is="true">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Tab</th>
<th style="text-align: left;">Var_reponse</th>
<th style="text-align: left;">expl_var1</th>
<th style="text-align: left;">expl_var2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">T1</td>
<td style="text-align: left;">ca_pizzas</td>
<td style="text-align: left;">Nuts2</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T2</td>
<td style="text-align: left;">ca_pizzas</td>
<td style="text-align: left;">Nuts3</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T3</td>
<td style="text-align: left;">ca_pizzas</td>
<td style="text-align: left;">A10</td>
<td style="text-align: left;">Nuts2</td>
</tr>
<tr class="even">
<td style="text-align: left;">T4</td>
<td style="text-align: left;">ca_pizzas</td>
<td style="text-align: left;">A10</td>
<td style="text-align: left;">Nuts3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T5</td>
<td style="text-align: left;">ca_pizzas</td>
<td style="text-align: left;">A21</td>
<td style="text-align: left;">Nuts2</td>
</tr>
<tr class="even">
<td style="text-align: left;">T6</td>
<td style="text-align: left;">ca_pizzas</td>
<td style="text-align: left;">A21</td>
<td style="text-align: left;">Nuts3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T7</td>
<td style="text-align: left;">ca_pizzas</td>
<td style="text-align: left;">A88</td>
<td style="text-align: left;">Nuts2</td>
</tr>
<tr class="even">
<td style="text-align: left;">T8</td>
<td style="text-align: left;">ca_pizzas</td>
<td style="text-align: left;">A88</td>
<td style="text-align: left;">Nuts3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T9</td>
<td style="text-align: left;">ca_batavia</td>
<td style="text-align: left;">A10</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T10</td>
<td style="text-align: left;">ca_batavia</td>
<td style="text-align: left;">A10</td>
<td style="text-align: left;">CJ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T11</td>
<td style="text-align: left;">ca_batavia</td>
<td style="text-align: left;">A21</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T12</td>
<td style="text-align: left;">ca_batavia</td>
<td style="text-align: left;">A21</td>
<td style="text-align: left;">CJ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T13</td>
<td style="text-align: left;">ca_batavia</td>
<td style="text-align: left;">A88</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T14</td>
<td style="text-align: left;">ca_batavia</td>
<td style="text-align: left;">A88</td>
<td style="text-align: left;">CJ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T15</td>
<td style="text-align: left;">ca_mache</td>
<td style="text-align: left;">A10</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T16</td>
<td style="text-align: left;">ca_mache</td>
<td style="text-align: left;">A10</td>
<td style="text-align: left;">CJ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T17</td>
<td style="text-align: left;">ca_mache</td>
<td style="text-align: left;">A21</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T18</td>
<td style="text-align: left;">ca_mache</td>
<td style="text-align: left;">A21</td>
<td style="text-align: left;">CJ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T19</td>
<td style="text-align: left;">ca_mache</td>
<td style="text-align: left;">A88</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T20</td>
<td style="text-align: left;">ca_mache</td>
<td style="text-align: left;">A88</td>
<td style="text-align: left;">CJ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T21</td>
<td style="text-align: left;">ca_salades</td>
<td style="text-align: left;">A10</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T22</td>
<td style="text-align: left;">ca_salades</td>
<td style="text-align: left;">A10</td>
<td style="text-align: left;">CJ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T23</td>
<td style="text-align: left;">ca_salades</td>
<td style="text-align: left;">A21</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T24</td>
<td style="text-align: left;">ca_salades</td>
<td style="text-align: left;">A21</td>
<td style="text-align: left;">CJ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">T25</td>
<td style="text-align: left;">ca_salades</td>
<td style="text-align: left;">A88</td>
<td style="text-align: left;">TREFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">T26</td>
<td style="text-align: left;">ca_salades</td>
<td style="text-align: left;">A88</td>
<td style="text-align: left;">CJ</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Champ de la population : entreprises françaises.
Informations complémentaires : il n'y a que deux types de salades les batavias et la mâche.</code></pre>
</div>
</div>
<p>Pour n’oublier aucun lien entre les tableaux, on procède étape par étape.</p>
<section id="les-tableaux-sont-ils-sur-le-même-champ" class="level3">
<h3 class="anchored" data-anchor-id="les-tableaux-sont-ils-sur-le-même-champ">Les tableaux sont-ils sur le même champ ?</h3>
<p>Oui les tableaux portent tous sur le même champ des entreprises françaises.</p>
</section>
<section id="les-tableaux-ont-ils-les-mêmes-variables-réponses" class="level3">
<h3 class="anchored" data-anchor-id="les-tableaux-ont-ils-les-mêmes-variables-réponses">Les tableaux ont-ils les mêmes variables réponses ?</h3>
<ul>
<li>T1-T8&nbsp;: variable réponse «&nbsp;ca_pizzas&nbsp;»</li>
<li>T9-T14&nbsp;: variable réponse «&nbsp;ca_batavia&nbsp;»</li>
<li>T15-T20&nbsp;: variable réponse «&nbsp;ca_mache&nbsp;»</li>
<li>T21-T26&nbsp;: variable réponse «&nbsp;ca_salades&nbsp;»</li>
</ul>
</section>
<section id="les-variables-réponses-ont-elles-un-lien-entre-elles" class="level3">
<h3 class="anchored" data-anchor-id="les-variables-réponses-ont-elles-un-lien-entre-elles">Les variables réponses ont-elles un lien entre elles ?</h3>
<p>L’information complémentaire nous identique qu’il n’y a que deux types de salades, les batavias et la mâche. On comprend donc que la somme des chiffres d’affaires des batavias et des mâches est égale au chiffre d’affaires des salades&nbsp;: ca_salades = ca_batavia + ca_mache. On peut donc regrouper tous les tableaux qui ont les mêmes variables de croisement et l’un de ces trois indicateurs dans un même tableau. Dans ce tableau on crée une nouvelle variable de croisement qu’on peut nommer «&nbsp;crois_salades&nbsp;». C’est le cas pour les tables de 9 à 26, on peut les regrouper comme suit : - T9_T15_T21&nbsp;: ca <span class="math inline">\(\otimes\)</span> {A10 x treff x crois_salades}<br>
- T10_T16_T22&nbsp;: ca <span class="math inline">\(\otimes\)</span> {A10 x cj x crois_salades}<br>
- T11_T17_T23&nbsp;: ca <span class="math inline">\(\otimes\)</span> {A21 x treff x crois_salades}<br>
- T12_T18_T24&nbsp;: ca <span class="math inline">\(\otimes\)</span> {A21 x cj x crois_salades}<br>
- T13_T19_T25&nbsp;: ca <span class="math inline">\(\otimes\)</span> {A88 x treff x crois_salades}<br>
- T14_T20_T26&nbsp;: ca <span class="math inline">\(\otimes\)</span> {A88 x cj x crois_salades}</p>
<p>On en déduit donc qu’il y a deux sous-demandes indépendantes / «&nbsp;clusters&nbsp;»&nbsp;:<br>
- T1-T8 (cluster pizza)<br>
- T9-T26 (cluster salades)</p>
</section>
<section id="dans-chacun-des-clusters-variables-de-croisement-identiques" class="level3">
<h3 class="anchored" data-anchor-id="dans-chacun-des-clusters-variables-de-croisement-identiques">Dans chacun des clusters variables de croisement identiques ?</h3>
<p>Dans chacun des clusters y a-t-il des variables de croisement identiques&nbsp;? Y a-t-il des variables de croisements liés par un lien hiérarchique&nbsp;? Cluster pizza :<br>
- les variables «&nbsp;nuts2&nbsp;» et «&nbsp;nuts3&nbsp;» font partie de la même hiérarchie «&nbsp;nuts&nbsp;», autrement dit une hiérarchie sur la zone géographique<br>
- les variables A10, A21 et A88 font partie de la hiérarchie «&nbsp;NAF&nbsp;»</p>
<p>On peut donc regrouper ces variables de croisement en deux variables de croisement «&nbsp;nuts&nbsp;» et «&nbsp;NAF&nbsp;». On obtient donc 2 tableaux à protéger dans le cluster pizza :<br>
- T_A&nbsp;: ca_pizzas <span class="math inline">\(\otimes\)</span> {nuts x treff}<br>
- T_B&nbsp;: ca_pizzas <span class="math inline">\(\otimes\)</span> {naf x nuts}</p>
<p>Ces deux tableaux sont liés par leur marge sur nuts. Il faut les traiter ensemble dans le même <code>tab_multi_manager()</code>.</p>
<p>Cluster salades&nbsp;: - les variables A10, A21 et A88 font partie de la hiérarchie «&nbsp;NAF&nbsp;»</p>
<p>Ainsi, on peut réecrire les 6 tableaux écrits plus haut de cette façon :<br>
- T9_T15_T21&nbsp;: ca <span class="math inline">\(\otimes\)</span> {naf x treff x crois_salades}<br>
- T10_T16_T22&nbsp;: ca <span class="math inline">\(\otimes\)</span> {naf x cj x crois_salades}<br>
- T11_T17_T23&nbsp;: ca <span class="math inline">\(\otimes\)</span> {naf x treff x crois_salades}<br>
- T12_T18_T24&nbsp;: ca <span class="math inline">\(\otimes\)</span> {naf x cj x crois_salades}<br>
- T13_T19_T25&nbsp;: ca <span class="math inline">\(\otimes\)</span> {naf x treff x crois_salades}<br>
- T14_T20_T26&nbsp;: ca <span class="math inline">\(\otimes\)</span> {naf x cj x crois_salades}</p>
<p>On voit bien que plusieurs de ces tableaux sont en fait exactement les mêmes, donc finalement les tableaux à traiter pour ce cluster sont : - T_C&nbsp;: ca <span class="math inline">\(\otimes\)</span> {naf x treff x crois_salades}<br>
- T_D: ca <span class="math inline">\(\otimes\)</span> {naf x cj x crois_salades}</p>
</section>
</section>
<section id="tabuler-les-données-1" class="level2">
<h2 class="anchored" data-anchor-id="tabuler-les-données-1">Tabuler les données</h2>
<p>On commence par tabuler les données pour l’indicateur “chiffre d’affaires vente pizzas”.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pizzas_tabule <span class="ot">&lt;-</span> <span class="fu">tabulate_micro_data</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  micro,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"treff"</span>),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc_vars =</span> <span class="fu">list</span>(<span class="at">naf =</span> <span class="fu">c</span>(<span class="st">"a10"</span>,<span class="st">"a21"</span>,<span class="st">"a88"</span>), <span class="at">nuts =</span> <span class="fu">c</span>(<span class="st">"nuts2"</span>,<span class="st">"nuts3"</span>)),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">pond_var =</span> <span class="st">"poids"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp_var =</span> <span class="fu">c</span>(<span class="st">"pizzas"</span>),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">marge_label =</span> <span class="st">"Total"</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pizzas_tabule)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  32222 obs. of  6 variables:
 $ naf       : chr  "BE" "MN" "OQ" "RU" ...
 $ nuts      : chr  "Total" "Total" "Total" "Total" ...
 $ treff     : chr  "Total" "Total" "Total" "Total" ...
 $ nb_obs    : num  608493 239202 75471 171537 184607 ...
 $ pizzas_tot: num  2.34e+11 9.00e+10 3.14e+10 6.65e+10 7.09e+10 ...
 $ pizzas_max: num  899871 898861 899157 898798 899906 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>On tabule ensuite pour les indicateurs “chiffre d’affaires vente mâches, batavia et salades”. N.B. il faut créer une nouvelle variable de croisement.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>salades_tabule <span class="ot">&lt;-</span> <span class="fu">tabulate_micro_data</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  micro,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"treff"</span>,<span class="st">"cj"</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc_vars =</span> <span class="fu">list</span>(<span class="at">naf =</span> <span class="fu">c</span>(<span class="st">"a10"</span>,<span class="st">"a21"</span>,<span class="st">"a88"</span>)),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">pond_var =</span> <span class="st">"poids"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp_var =</span> <span class="fu">c</span>(<span class="st">"salades"</span>,<span class="st">"batavias"</span>,<span class="st">"maches"</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">marge_label =</span> <span class="st">"Total"</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>salades_tabule_3var <span class="ot">&lt;-</span> salades_tabule <span class="sc">%&gt;%</span> </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(salades_tot, maches_tot, batavias_tot, </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>             salades_max, maches_max, batavias_max),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"crois_salades"</span>, <span class="st">".value"</span>),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.*)_(tot|max)"</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(salades_tabule_3var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [5,484 × 7] (S3: tbl_df/tbl/data.frame)
 $ naf          : chr [1:5484] "BE" "BE" "BE" "MN" ...
 $ treff        : chr [1:5484] "Total" "Total" "Total" "Total" ...
 $ cj           : chr [1:5484] "Total" "Total" "Total" "Total" ...
 $ nb_obs       : num [1:5484] 608493 608493 608493 239202 239202 ...
 $ crois_salades: chr [1:5484] "salades" "maches" "batavias" "salades" ...
 $ tot          : num [1:5484] 5.48e+10 2.89e+10 2.58e+10 2.15e+10 1.13e+10 ...
 $ max          : num [1:5484] 144352 74992 69992 143830 74974 ...</code></pre>
</div>
</div>
</section>
<section id="poser-le-secret-primaire-2" class="level2">
<h2 class="anchored" data-anchor-id="poser-le-secret-primaire-2">Poser le secret primaire</h2>
<p>Secret primaire pour les pizzas.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pizzas_tabule <span class="ot">&lt;-</span> pizzas_tabule <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_freq =</span> nb_obs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> nb_obs <span class="sc">&lt;</span> <span class="dv">3</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_dom =</span> (pizzas_tot <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">&amp;</span> (pizzas_max <span class="sc">&gt;</span> <span class="fl">0.85</span><span class="sc">*</span>pizzas_tot),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_prim =</span> is_secret_freq <span class="sc">|</span> is_secret_dom</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pizzas_tabule<span class="sc">$</span>is_secret_prim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE  TRUE 
32198    24 </code></pre>
</div>
</div>
<p>Secret primaire pour les salades.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>salades_tabule_3var <span class="ot">&lt;-</span> salades_tabule_3var <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_freq =</span> nb_obs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> nb_obs <span class="sc">&lt;</span> <span class="dv">3</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_dom =</span> (tot <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">&amp;</span> (max <span class="sc">&gt;</span> <span class="fl">0.85</span><span class="sc">*</span>tot),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_prim =</span> is_secret_freq <span class="sc">|</span> is_secret_dom</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pizzas_tabule<span class="sc">$</span>is_secret_prim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE  TRUE 
32198    24 </code></pre>
</div>
</div>
</section>
<section id="création-des-listes-de-tableaux" class="level2">
<h2 class="anchored" data-anchor-id="création-des-listes-de-tableaux">Création des listes de tableaux</h2>
<p>Pour le cluster des pizzas.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>tableaux_pizza <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pizza_nuts_treff =</span> pizzas_tabule <span class="sc">%&gt;%</span> <span class="fu">filter</span>(naf <span class="sc">==</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>naf), <span class="co"># T1.T2</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pizza_nuts_naf =</span> pizzas_tabule <span class="sc">%&gt;%</span> <span class="fu">filter</span>(treff <span class="sc">==</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>treff) <span class="co"># T3.T4.T5.T6.T7.T8</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tableaux_pizza)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ pizza_nuts_treff:Classes 'data.table' and 'data.frame':  516 obs. of  8 variables:
  ..$ nuts          : chr [1:516] "FR10" "FRC2" "FRJ2" "FRF2" ...
  ..$ treff         : chr [1:516] "Total" "Total" "Total" "Total" ...
  ..$ nb_obs        : num [1:516] 127326 67459 117119 60272 72450 ...
  ..$ pizzas_tot    : num [1:516] 4.90e+10 2.63e+10 4.40e+10 2.25e+10 2.60e+10 ...
  ..$ pizzas_max    : num [1:516] 897221 897459 898798 899167 898691 ...
  ..$ is_secret_freq: logi [1:516] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..$ is_secret_dom : logi [1:516] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..$ is_secret_prim: logi [1:516] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 $ pizza_nuts_naf  :Classes 'data.table' and 'data.frame':  11943 obs. of  8 variables:
  ..$ naf           : chr [1:11943] "BE" "MN" "OQ" "RU" ...
  ..$ nuts          : chr [1:11943] "Total" "Total" "Total" "Total" ...
  ..$ nb_obs        : num [1:11943] 608493 239202 75471 171537 184607 ...
  ..$ pizzas_tot    : num [1:11943] 2.34e+11 9.00e+10 3.14e+10 6.65e+10 7.09e+10 ...
  ..$ pizzas_max    : num [1:11943] 899871 898861 899157 898798 899906 ...
  ..$ is_secret_freq: logi [1:11943] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..$ is_secret_dom : logi [1:11943] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..$ is_secret_prim: logi [1:11943] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>Pour le cluster des salades.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>tableaux_salades <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">salades_naf_treff =</span> salades_tabule_3var <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cj <span class="sc">==</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>cj), <span class="co"># T9.T15.T21.T11.T17.T23.T13.T19.T25</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">salades_naf_cj =</span> salades_tabule_3var <span class="sc">%&gt;%</span> <span class="fu">filter</span>(treff <span class="sc">==</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>treff) <span class="co"># T10.T16.T22.T12.T18.T24.T14.T20.T26</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tableaux_salades)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ salades_naf_treff: tibble [1,425 × 9] (S3: tbl_df/tbl/data.frame)
  ..$ naf           : chr [1:1425] "BE" "BE" "BE" "MN" ...
  ..$ treff         : chr [1:1425] "Total" "Total" "Total" "Total" ...
  ..$ nb_obs        : num [1:1425] 608493 608493 608493 239202 239202 ...
  ..$ crois_salades : chr [1:1425] "salades" "maches" "batavias" "salades" ...
  ..$ tot           : num [1:1425] 5.48e+10 2.89e+10 2.58e+10 2.15e+10 1.13e+10 ...
  ..$ max           : num [1:1425] 144352 74992 69992 143830 74974 ...
  ..$ is_secret_freq: logi [1:1425] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..$ is_secret_dom : logi [1:1425] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..$ is_secret_prim: logi [1:1425] FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ salades_naf_cj   : tibble [1,428 × 9] (S3: tbl_df/tbl/data.frame)
  ..$ naf           : chr [1:1428] "BE" "BE" "BE" "MN" ...
  ..$ cj            : chr [1:1428] "Total" "Total" "Total" "Total" ...
  ..$ nb_obs        : num [1:1428] 608493 608493 608493 239202 239202 ...
  ..$ crois_salades : chr [1:1428] "salades" "maches" "batavias" "salades" ...
  ..$ tot           : num [1:1428] 5.48e+10 2.89e+10 2.58e+10 2.15e+10 1.13e+10 ...
  ..$ max           : num [1:1428] 144352 74992 69992 143830 74974 ...
  ..$ is_secret_freq: logi [1:1428] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..$ is_secret_dom : logi [1:1428] FALSE FALSE FALSE FALSE FALSE FALSE ...
  ..$ is_secret_prim: logi [1:1428] FALSE FALSE FALSE FALSE FALSE FALSE ...</code></pre>
</div>
</div>
</section>
<section id="créer-les-hiérarchies" class="level2">
<h2 class="anchored" data-anchor-id="créer-les-hiérarchies">Créer les hiérarchies</h2>
<p>Comme vu dans la partie <a href="#proteger-un-tableau-hierarchique">Protéger un tableau hiérarchique</a>, on crée les hiérarchies à l’aide de <code>rtauargus::write_hrc2()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># en deux temps</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>corres_naf <span class="ot">&lt;-</span> micro <span class="sc">%&gt;%</span> <span class="fu">select</span>(a10,a21,a88) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(a10,a21,a88)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>chemin_hrc_naf <span class="ot">&lt;-</span> <span class="fu">write_hrc2</span>(corres_naf, <span class="at">file_name =</span> <span class="st">"fichiers_tauargus/hrc/naf.hrc"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># d'un seul coup</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>chemin_hrc_nuts <span class="ot">&lt;-</span> <span class="fu">write_hrc2</span>(micro <span class="sc">%&gt;%</span> <span class="fu">select</span>(nuts2,nuts3) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(nuts2),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"fichiers_tauargus/hrc/nuts.hrc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>N.B. la bonne pratique est de partir d’une table de passage définie à priori. Ici, il est plus simple de partir des microdonnées et on a confiance dans les strcutures des hiérarchies qui en sortiront.</p>
</section>
<section id="poser-le-secret-secondaire-1" class="level2">
<h2 class="anchored" data-anchor-id="poser-le-secret-secondaire-1">Poser le secret secondaire</h2>
<p>On pose le secret puis on unifie les masques afin de les regrouper dans un seul dataframe.</p>
<p>Pour le cluster pizzas.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>masques_pizza <span class="ot">&lt;-</span> <span class="fu">tab_multi_manager</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">list_tables =</span> tableaux_pizza,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">list_explanatory_vars =</span> <span class="fu">list</span>(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pizza_nuts_treff =</span> <span class="fu">c</span>(<span class="st">"nuts"</span>,<span class="st">"treff"</span>), <span class="co"># T1.T2</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pizza_nuts_naf =</span> <span class="fu">c</span>(<span class="st">"nuts"</span>,<span class="st">"naf"</span>) <span class="co"># T3.T4.T5.T6.T7.T8</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"./Exos/tauargus_files/ex_analyse_demande/"</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc =</span> <span class="fu">list</span>(<span class="at">naf =</span> chemin_hrc_naf, <span class="at">nuts =</span> chemin_hrc_nuts),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="st">"Total"</span>,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"pizzas_tot"</span>,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="st">"nb_obs"</span>,</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_prim"</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unification des masques</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>masque_pizza <span class="ot">&lt;-</span> masques_pizza <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(tab){</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    tab <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">treff =</span> <span class="cf">if</span> (<span class="st">"treff"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) treff <span class="cf">else</span> <span class="st">"Total"</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">cj =</span> <span class="cf">if</span> (<span class="st">"cj"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) cj <span class="cf">else</span> <span class="st">"Total"</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">naf =</span> <span class="cf">if</span> (<span class="st">"naf"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) naf <span class="cf">else</span> <span class="st">"Total"</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="st">"naf"</span>,<span class="st">"treff"</span>,<span class="st">"cj"</span>,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span><span class="st">"is_secret_final"</span>, <span class="fu">last_col</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">statut_final =</span> <span class="fu">case_when</span>(</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>          is_secret_freq <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>          is_secret_dom <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>          is_secret_final <span class="sc">~</span><span class="st">"D"</span>,</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"V"</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">%&gt;%</span> </span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"is_secret_"</span>))</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>masque_pizza <span class="sc">%&gt;%</span> </span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(statut_final) <span class="sc">%&gt;%</span> </span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cell =</span> <span class="fu">n</span>(),</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">val_cell =</span> <span class="fu">sum</span>(pizzas_tot)</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_n_cell =</span> n_cell<span class="sc">/</span><span class="fu">sum</span>(n_cell)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_val_cell =</span> val_cell<span class="sc">/</span><span class="fu">sum</span>(val_cell)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  statut_final n_cell      val_cell pc_n_cell pc_val_cell
  &lt;chr&gt;         &lt;int&gt;         &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
1 A                11       9160149    0.0892    0.000102
2 D                33   14236278602    0.268     0.158   
3 V             12286 8993596429774   99.6      99.8     </code></pre>
</div>
</div>
<p>Pour le cluster salades.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>masques_salades <span class="ot">&lt;-</span> <span class="fu">tab_multi_manager</span>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">list_tables =</span> tableaux_salades,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">list_explanatory_vars =</span> <span class="fu">list</span>(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">salades_naf_treff =</span> <span class="fu">c</span>(<span class="st">"naf"</span>,<span class="st">"treff"</span>, <span class="st">"crois_salades"</span>),</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">salades_naf_cj =</span> <span class="fu">c</span>(<span class="st">"naf"</span>,<span class="st">"cj"</span>, <span class="st">"crois_salades"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"./Exos/tauargus_files/ex_analyse_demande/"</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc =</span> <span class="fu">list</span>(<span class="at">naf =</span> chemin_hrc_naf),</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="fu">c</span>(<span class="at">naf =</span> <span class="st">"Total"</span>, <span class="at">treff =</span> <span class="st">"Total"</span>, <span class="at">cj =</span> <span class="st">"Total"</span>, <span class="at">crois_salades =</span> <span class="st">"salades"</span>),</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"tot"</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="st">"nb_obs"</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_prim"</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>masque_salades <span class="ot">&lt;-</span> masques_salades <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(tab){</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    tab <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">treff =</span> <span class="cf">if</span> (<span class="st">"treff"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) treff <span class="cf">else</span> <span class="st">"Total"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">cj =</span> <span class="cf">if</span> (<span class="st">"cj"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) cj <span class="cf">else</span> <span class="st">"Total"</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">naf =</span> <span class="cf">if</span> (<span class="st">"naf"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) naf <span class="cf">else</span> <span class="st">"Total"</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="st">"naf"</span>,<span class="st">"treff"</span>,<span class="st">"cj"</span>,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span><span class="st">"is_secret_final"</span>, <span class="fu">last_col</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">statut_final =</span> <span class="fu">case_when</span>(</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>          is_secret_freq <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>          is_secret_dom <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>          is_secret_final <span class="sc">~</span><span class="st">"D"</span>,</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"V"</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">%&gt;%</span> </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"is_secret_"</span>))</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>masque_salades <span class="sc">%&gt;%</span> </span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(statut_final) <span class="sc">%&gt;%</span> </span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cell =</span> <span class="fu">n</span>(),</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">val_cell =</span> <span class="fu">sum</span>(tot)</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_n_cell =</span> n_cell<span class="sc">/</span><span class="fu">sum</span>(n_cell)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_val_cell =</span> val_cell<span class="sc">/</span><span class="fu">sum</span>(val_cell)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  statut_final n_cell      val_cell pc_n_cell pc_val_cell
  &lt;chr&gt;         &lt;int&gt;         &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
1 A                21       1380020    0.842   0.0000408 
2 B                 1         47973    0.0401  0.00000142
3 D                43   14228897507    1.72    0.421     
4 V              2428 3366561853460   97.4    99.6       </code></pre>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/InseeFrLab\.github\.io\/formation_protection_donnees\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb57" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Protéger des tableaux avec une méthode suppressive</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="an">order:</span><span class="co"> 1</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>Cette fiche pratique présente une façon de protéger des tableaux en utilisant une méthode suppressive grâce au package <span class="in">`rtauargus`</span> qui appelle Tau-Argus depuis R. Le code peut être entièrement caché ou visible grâce au bouton à droite du titre. Vous pouvez aussi le faire apparaître ou disparaître au fur et à mesure de la lecture en appuyant sur les boutons &lt;/&gt; Code.</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="fu"># Initialisation</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>Installation du package rtauargus.</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r installation_rtauargus, warning=FALSE, message=FALSE}</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">'InseeFrLab/rtauargus'</span>,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">dependencies =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">build_vignettes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">upgrade =</span> <span class="st">'never'</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>Import des packages.</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import_packages, warning=FALSE, message=FALSE}</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtauargus)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>Modifier le chemin ci-dessous :</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loc_tauargus, warning=FALSE, message=FALSE}</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="co"># préciser le chemin de Tau-Argus avant d'utiliser tab_rtauargus() et </span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="co"># tab_multi_manger() car ces fonctions appelent Tau-Argus</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>loc_tauargus <span class="ot">&lt;-</span> <span class="st">"chemin_vers/TauArgus.exe"</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">rtauargus.tauargus_exe =</span> loc_tauargus)</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import_sorties_TA, echo=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="co"># import des sorties Tau-Argus faites tournées en local dans un environnement</span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a><span class="co"># windows afin de pouvoir utiliser Tau-Argus</span></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./fichiers_tauargus/sorties/sorties_TA.RData"</span>)</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># Tabuler les données</span></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>Pour faciliter le passage des microdonnées aux données tabulées une fonction est incluse dans <span class="in">`rtauargus`</span> : <span class="in">`tabulate_micro_data()`</span>.</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>Les arguments de la fonction sont les suivants :  </span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`df`</span>: jeu de données individuelles (data.frame ou data.table)  </span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`cat_vars`</span>: variables de croisements (catégorielles) non hiérarchiques (vecteur)  </span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`hrc_vars`</span>: variables de croisements hiérarchiques sous la forme d'une liste nommée  </span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`pond_var`</span>: variable de pondération  </span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`resp_var`</span>: indicateur(s), variable(s) de réponse  </span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`marge_label`</span>: label utilisé pour les marges (sous-totaux)  </span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Présentation des données individuelles</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>Nous créons un jeu de données entreprises (1 ligne = 1 entreprise) pour lesquelles </span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>on dispose d'informations telles que l'activité, la catégorie juridique, </span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>la géographie d'implantation (variables NUTS) et la tranche d'effectifs. Pour </span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>chaque entreprise on dispose également du chiffre d'affaires (CA) selon le type de produits (salades, </span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>pizzas, batavias, légumes rouges, etc.).</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r creation_micro}</span></span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>generer_micro <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>  a88 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A01"</span>,<span class="st">"A02"</span>,<span class="st">"A03"</span>,<span class="st">"B05"</span>,<span class="st">"B06"</span>,<span class="st">"B07"</span>,<span class="st">"B08"</span>,<span class="st">"B09"</span>,<span class="st">"C10"</span>,<span class="st">"C11"</span>,<span class="st">"C12"</span>,<span class="st">"C13"</span>,</span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>         <span class="st">"C14"</span>,<span class="st">"C15"</span>,<span class="st">"C16"</span>,<span class="st">"C17"</span>,<span class="st">"C18"</span>,<span class="st">"C19"</span>,<span class="st">"C20"</span>,<span class="st">"C21"</span>,<span class="st">"C22"</span>,<span class="st">"C23"</span>,<span class="st">"C24"</span>,<span class="st">"C25"</span>,</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>         <span class="st">"C26"</span>,<span class="st">"C27"</span>,<span class="st">"C28"</span>,<span class="st">"C29"</span>,<span class="st">"C30"</span>,<span class="st">"C31"</span>,<span class="st">"C32"</span>,<span class="st">"C33"</span>,<span class="st">"D35"</span>,<span class="st">"E36"</span>,<span class="st">"E37"</span>,<span class="st">"E38"</span>,</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>         <span class="st">"E39"</span>,<span class="st">"F41"</span>,<span class="st">"F42"</span>,<span class="st">"F43"</span>,<span class="st">"G45"</span>,<span class="st">"G46"</span>,<span class="st">"G47"</span>,<span class="st">"H49"</span>,<span class="st">"H50"</span>,<span class="st">"H51"</span>,<span class="st">"H52"</span>,<span class="st">"H53"</span>,</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>         <span class="st">"I55"</span>,<span class="st">"I56"</span>,<span class="st">"J58"</span>,<span class="st">"J59"</span>,<span class="st">"J60"</span>,<span class="st">"J61"</span>,<span class="st">"J62"</span>,<span class="st">"J63"</span>,<span class="st">"K64"</span>,<span class="st">"K65"</span>,<span class="st">"K66"</span>,<span class="st">"L68"</span>,</span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>         <span class="st">"M69"</span>,<span class="st">"M70"</span>,<span class="st">"M71"</span>,<span class="st">"M72"</span>,<span class="st">"M73"</span>,<span class="st">"M74"</span>,<span class="st">"M75"</span>,<span class="st">"N77"</span>,<span class="st">"N78"</span>,<span class="st">"N79"</span>,<span class="st">"N80"</span>,<span class="st">"N81"</span>,</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>         <span class="st">"N82"</span>,<span class="st">"O84"</span>,<span class="st">"P85"</span>,<span class="st">"Q86"</span>,<span class="st">"Q87"</span>,<span class="st">"Q88"</span>,<span class="st">"R90"</span>,<span class="st">"R91"</span>,<span class="st">"R92"</span>,<span class="st">"R93"</span>,<span class="st">"S94"</span>,<span class="st">"S95"</span>,</span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>         <span class="st">"S96"</span>,<span class="st">"T97"</span>,<span class="st">"T98"</span>,<span class="st">"U99"</span>)</span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Modalités rares</span></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>  modalites_rares <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"C29"</span>, <span class="st">"J58"</span>, <span class="st">"Q88"</span>)</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Probabilités : base égale pour toutes, sauf rares</span></span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>  proba_a88 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(a88))</span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>  proba_a88[a88 <span class="sc">%in%</span> modalites_rares] <span class="ot">&lt;-</span> <span class="fl">0.01</span>  <span class="co"># très faible proba</span></span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalisation des proba</span></span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>  proba_a88 <span class="ot">&lt;-</span> proba_a88 <span class="sc">/</span> <span class="fu">sum</span>(proba_a88)</span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>  correspondance_naf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(a88) <span class="sc">%&gt;%</span> </span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">a21 =</span> <span class="fu">substr</span>(a88,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>           <span class="at">a10 =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">==</span> <span class="st">"A"</span> <span class="sc">~</span> <span class="st">"AZ"</span>,</span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span>) <span class="sc">~</span> <span class="st">"BE"</span>,</span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> <span class="st">"FZ"</span>,</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"G"</span>,<span class="st">"H"</span>,<span class="st">"I"</span>) <span class="sc">~</span> <span class="st">"GI"</span>,</span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">==</span> <span class="st">"J"</span> <span class="sc">~</span> <span class="st">"JZ"</span>,</span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">==</span> <span class="st">"K"</span> <span class="sc">~</span> <span class="st">"KZ"</span>,</span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">==</span> <span class="st">"L"</span> <span class="sc">~</span> <span class="st">"LZ"</span>,</span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"M"</span>,<span class="st">"N"</span>) <span class="sc">~</span> <span class="st">"MN"</span>,</span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"O"</span>,<span class="st">"P"</span>,<span class="st">"Q"</span>) <span class="sc">~</span> <span class="st">"OQ"</span>,</span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a>             a21 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"R"</span>,<span class="st">"S"</span>,<span class="st">"T"</span>,<span class="st">"U"</span>) <span class="sc">~</span> <span class="st">"RU"</span></span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a>           )) <span class="sc">%&gt;%</span> </span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(a10,a21,a88)</span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a>  nuts3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FR101"</span>,<span class="st">"FR102"</span>,<span class="st">"FR103"</span>,<span class="st">"FR104"</span>,<span class="st">"FR105"</span>,<span class="st">"FR106"</span>,<span class="st">"FR107"</span>,<span class="st">"FR108"</span>,<span class="st">"FRB01"</span>,</span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRB02"</span>,<span class="st">"FRB03"</span>,<span class="st">"FRB04"</span>,<span class="st">"FRB05"</span>,<span class="st">"FRB06"</span>,<span class="st">"FRC11"</span>,<span class="st">"FRC12"</span>,<span class="st">"FRC13"</span>,<span class="st">"FRC14"</span>,</span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRC21"</span>,<span class="st">"FRC22"</span>,<span class="st">"FRC23"</span>,<span class="st">"FRC24"</span>,<span class="st">"FRD11"</span>,<span class="st">"FRD12"</span>,<span class="st">"FRD13"</span>,<span class="st">"FRD21"</span>,<span class="st">"FRD22"</span>,</span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRE11"</span>,<span class="st">"FRE12"</span>,<span class="st">"FRE21"</span>,<span class="st">"FRE22"</span>,<span class="st">"FRE23"</span>,<span class="st">"FRF11"</span>,<span class="st">"FRF12"</span>,<span class="st">"FRF21"</span>,<span class="st">"FRF22"</span>,</span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRF23"</span>,<span class="st">"FRF24"</span>,<span class="st">"FRF31"</span>,<span class="st">"FRF32"</span>,<span class="st">"FRF33"</span>,<span class="st">"FRF34"</span>,<span class="st">"FRG01"</span>,<span class="st">"FRG02"</span>,<span class="st">"FRG03"</span>,</span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRG04"</span>,<span class="st">"FRG05"</span>,<span class="st">"FRH01"</span>,<span class="st">"FRH02"</span>,<span class="st">"FRH03"</span>,<span class="st">"FRH04"</span>,<span class="st">"FRI11"</span>,<span class="st">"FRI12"</span>,<span class="st">"FRI13"</span>,</span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRI14"</span>,<span class="st">"FRI15"</span>,<span class="st">"FRI21"</span>,<span class="st">"FRI22"</span>,<span class="st">"FRI23"</span>,<span class="st">"FRI31"</span>,<span class="st">"FRI32"</span>,<span class="st">"FRI33"</span>,<span class="st">"FRI34"</span>,</span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRJ11"</span>,<span class="st">"FRJ12"</span>,<span class="st">"FRJ13"</span>,<span class="st">"FRJ14"</span>,<span class="st">"FRJ15"</span>,<span class="st">"FRJ21"</span>,<span class="st">"FRJ22"</span>,<span class="st">"FRJ23"</span>,<span class="st">"FRJ24"</span>,</span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRJ25"</span>,<span class="st">"FRJ26"</span>,<span class="st">"FRJ27"</span>,<span class="st">"FRJ28"</span>,<span class="st">"FRK11"</span>,<span class="st">"FRK12"</span>,<span class="st">"FRK13"</span>,<span class="st">"FRK14"</span>,<span class="st">"FRK21"</span>,</span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRK22"</span>,<span class="st">"FRK23"</span>,<span class="st">"FRK24"</span>,<span class="st">"FRK25"</span>,<span class="st">"FRK26"</span>,<span class="st">"FRK27"</span>,<span class="st">"FRK28"</span>,<span class="st">"FRL01"</span>,<span class="st">"FRL02"</span>,</span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRL03"</span>,<span class="st">"FRL04"</span>,<span class="st">"FRL05"</span>,<span class="st">"FRL06"</span>,<span class="st">"FRM01"</span>,<span class="st">"FRM02"</span>,<span class="st">"FRY10"</span>,<span class="st">"FRY20"</span>,<span class="st">"FRY30"</span>,</span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a>             <span class="st">"FRY40"</span>,<span class="st">"FRY50"</span>)</span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a>  correspondance_nuts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(nuts3) <span class="sc">%&gt;%</span> </span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">nuts1 =</span> <span class="fu">substr</span>(nuts3,<span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a>           <span class="at">nuts2 =</span> <span class="fu">substr</span>(nuts3,<span class="dv">1</span>,<span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(nuts1,nuts2,nuts3)</span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a>  micro <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">a88 =</span> <span class="fu">sample</span>(a88, n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> proba_a88),</span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">nuts3 =</span> <span class="fu">sample</span>(nuts3, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">treff =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"tr1"</span>, <span class="st">"tr2"</span>, <span class="st">"tr3"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.45</span>, <span class="fl">0.05</span>, <span class="fl">0.5</span>)),</span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">cj =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"LL"</span>, <span class="st">"PA"</span>, <span class="st">"SP"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.45</span>, <span class="fl">0.45</span>, <span class="fl">0.1</span>)),</span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">maches =</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(n) <span class="sc">&lt;</span> <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">30000</span>, <span class="dv">75000</span>))),</span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">batavias =</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(n) <span class="sc">&lt;</span> <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">25000</span>, <span class="dv">70000</span>))),</span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a>    <span class="at">salades =</span> maches <span class="sc">+</span> batavias,</span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">tomates =</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(n) <span class="sc">&lt;</span> <span class="fl">0.08</span>, <span class="dv">0</span>, <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">50000</span>, <span class="dv">500000</span>))),</span>
<span id="cb57-132"><a href="#cb57-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">pizzas =</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(n) <span class="sc">&lt;</span> <span class="fl">0.2</span>, <span class="dv">0</span>, <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">60000</span>, <span class="dv">900000</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb57-133"><a href="#cb57-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Détecter les lignes "rares"</span></span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a>      <span class="at">rare =</span> a88 <span class="sc">%in%</span> modalites_rares <span class="sc">|</span> (a88 <span class="sc">==</span> <span class="st">"J58"</span> <span class="sc">&amp;</span> treff <span class="sc">==</span> <span class="st">"tr1"</span>),</span>
<span id="cb57-136"><a href="#cb57-136" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Attribution des poids en fonction de la rareté</span></span>
<span id="cb57-137"><a href="#cb57-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">poids =</span> <span class="fu">ifelse</span>(rare, <span class="fu">round</span>(<span class="fu">runif</span>(<span class="fu">n</span>(), <span class="dv">1</span>, <span class="dv">3</span>)), <span class="fu">round</span>(<span class="fu">runif</span>(<span class="fu">n</span>(), <span class="dv">10</span>, <span class="dv">300</span>)))</span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(correspondance_naf, <span class="at">by =</span> <span class="st">"a88"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(correspondance_nuts, <span class="at">by =</span> <span class="st">"nuts3"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-141"><a href="#cb57-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(a10,a21,a88,nuts1,nuts2,nuts3,treff,cj,maches,batavias,salades,tomates,pizzas,poids)</span>
<span id="cb57-142"><a href="#cb57-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(micro)</span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a>micro <span class="ot">&lt;-</span> <span class="fu">generer_micro</span>(<span class="dv">10000</span>)</span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-147"><a href="#cb57-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-148"><a href="#cb57-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r presentation micro}</span></span>
<span id="cb57-149"><a href="#cb57-149" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(micro)</span>
<span id="cb57-150"><a href="#cb57-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-151"><a href="#cb57-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-152"><a href="#cb57-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-153"><a href="#cb57-153" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tabuler un indicateur</span></span>
<span id="cb57-154"><a href="#cb57-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-155"><a href="#cb57-155" aria-hidden="true" tabindex="-1"></a>On veut construire le chiffre d'affaires en salades des entreprises par activité (niveau a88) et par tranche d'effectifs (treff).</span>
<span id="cb57-156"><a href="#cb57-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-157"><a href="#cb57-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tabuler_1resp}</span></span>
<span id="cb57-158"><a href="#cb57-158" aria-hidden="true" tabindex="-1"></a>salades <span class="ot">&lt;-</span> <span class="fu">tabulate_micro_data</span>(</span>
<span id="cb57-159"><a href="#cb57-159" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> micro,</span>
<span id="cb57-160"><a href="#cb57-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_var =</span> <span class="fu">c</span>(<span class="st">"a88"</span>, <span class="st">"treff"</span>),</span>
<span id="cb57-161"><a href="#cb57-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">pond_var =</span> <span class="st">"poids"</span>,</span>
<span id="cb57-162"><a href="#cb57-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp_var =</span> <span class="st">"salades"</span>,</span>
<span id="cb57-163"><a href="#cb57-163" aria-hidden="true" tabindex="-1"></a>  <span class="at">marge_label =</span> <span class="st">"Total"</span></span>
<span id="cb57-164"><a href="#cb57-164" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-165"><a href="#cb57-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-166"><a href="#cb57-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-167"><a href="#cb57-167" aria-hidden="true" tabindex="-1"></a>Le résultat est un tableau long avec :</span>
<span id="cb57-168"><a href="#cb57-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-169"><a href="#cb57-169" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Les variables de croisement (a88 et treff)</span>
<span id="cb57-170"><a href="#cb57-170" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Différents indicateurs :</span>
<span id="cb57-171"><a href="#cb57-171" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span><span class="in">`nb_obs`</span>: comptage du nombre d'entreprises (pour appliquer la règle de fréquence)</span>
<span id="cb57-172"><a href="#cb57-172" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span><span class="in">`salades_tot`</span>: indicateur / variable de réponse (ici total du chiffre d'affaire de salades)</span>
<span id="cb57-173"><a href="#cb57-173" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span><span class="in">`salades_max`</span>: contribution maximale au chiffre d'affaires (pour appliquer la règle de dominance)</span>
<span id="cb57-174"><a href="#cb57-174" aria-hidden="true" tabindex="-1"></a>Toutes les marges (totaux et sous-totaux) ont été ajoutées à la table.</span>
<span id="cb57-175"><a href="#cb57-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-178"><a href="#cb57-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-179"><a href="#cb57-179" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(salades)</span>
<span id="cb57-180"><a href="#cb57-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-181"><a href="#cb57-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-182"><a href="#cb57-182" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculer plusieurs indicateurs en même temps</span></span>
<span id="cb57-183"><a href="#cb57-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-184"><a href="#cb57-184" aria-hidden="true" tabindex="-1"></a>On veut construire deux tableaux :  </span>
<span id="cb57-185"><a href="#cb57-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-186"><a href="#cb57-186" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>le chiffre d'affaires de la production de pizzas des entreprises par activité (niveau A10), </span>
<span id="cb57-187"><a href="#cb57-187" aria-hidden="true" tabindex="-1"></a>par tranche d'effectifs (treff) et catégorie juridique (cj);</span>
<span id="cb57-188"><a href="#cb57-188" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>le chiffre d'affaires de la production de tomates des entreprises par activité (niveau A10), </span>
<span id="cb57-189"><a href="#cb57-189" aria-hidden="true" tabindex="-1"></a>par tranche d'effectifs (treff) et catégorie juridique (cj).</span>
<span id="cb57-190"><a href="#cb57-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-191"><a href="#cb57-191" aria-hidden="true" tabindex="-1"></a>Ces deux tableaux ont les mêmes variables de croisement et deux indicateurs </span>
<span id="cb57-192"><a href="#cb57-192" aria-hidden="true" tabindex="-1"></a>différents. Ils peuvent être construits en même temps.</span>
<span id="cb57-193"><a href="#cb57-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-194"><a href="#cb57-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tabuler_2resp}</span></span>
<span id="cb57-195"><a href="#cb57-195" aria-hidden="true" tabindex="-1"></a>pizzas_tomates <span class="ot">&lt;-</span> <span class="fu">tabulate_micro_data</span>(</span>
<span id="cb57-196"><a href="#cb57-196" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> micro,</span>
<span id="cb57-197"><a href="#cb57-197" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"a10"</span>, <span class="st">"treff"</span>,<span class="st">"cj"</span>),</span>
<span id="cb57-198"><a href="#cb57-198" aria-hidden="true" tabindex="-1"></a>  <span class="at">pond_var =</span> <span class="st">"poids"</span>,</span>
<span id="cb57-199"><a href="#cb57-199" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp_var =</span> <span class="fu">c</span>(<span class="st">"pizzas"</span>,<span class="st">"tomates"</span>),</span>
<span id="cb57-200"><a href="#cb57-200" aria-hidden="true" tabindex="-1"></a>  <span class="at">marge_label =</span> <span class="st">"Ensemble"</span></span>
<span id="cb57-201"><a href="#cb57-201" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-202"><a href="#cb57-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-203"><a href="#cb57-203" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pizzas_tomates)</span>
<span id="cb57-204"><a href="#cb57-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-205"><a href="#cb57-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-206"><a href="#cb57-206" aria-hidden="true" tabindex="-1"></a><span class="fu"># Poser le secret primaire</span></span>
<span id="cb57-207"><a href="#cb57-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-208"><a href="#cb57-208" aria-hidden="true" tabindex="-1"></a>**Objectif** : détecter les cellules ne respectant pas les règles de confidentialité</span>
<span id="cb57-209"><a href="#cb57-209" aria-hidden="true" tabindex="-1"></a>dans les tableaux proposés.</span>
<span id="cb57-210"><a href="#cb57-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-211"><a href="#cb57-211" aria-hidden="true" tabindex="-1"></a>**Consignes** : vous utiliserez les règles en vigueur à l'Insee pour la diffusion des</span>
<span id="cb57-212"><a href="#cb57-212" aria-hidden="true" tabindex="-1"></a>tableaux issus des enquêtes entreprises.</span>
<span id="cb57-213"><a href="#cb57-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-214"><a href="#cb57-214" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Pour chacun des tableaux, vous ajouterez une variable booléenne</span>
<span id="cb57-215"><a href="#cb57-215" aria-hidden="true" tabindex="-1"></a>    indiquant si la cellule est problématique (<span class="in">`TRUE`</span>) ou non (<span class="in">`FALSE`</span>),</span>
<span id="cb57-216"><a href="#cb57-216" aria-hidden="true" tabindex="-1"></a>    au regard de chacune des règles pertinentes à appliquer:</span>
<span id="cb57-217"><a href="#cb57-217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-218"><a href="#cb57-218" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Si vous appliquez la règle de fréquence, la variable créée</span>
<span id="cb57-219"><a href="#cb57-219" aria-hidden="true" tabindex="-1"></a>    s'appellera <span class="in">`is_secret_freq`</span>;</span>
<span id="cb57-220"><a href="#cb57-220" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Si vous appliquez la règle de dominance, la variable créée</span>
<span id="cb57-221"><a href="#cb57-221" aria-hidden="true" tabindex="-1"></a>    s'appellera <span class="in">`is_secret_dom`</span>.</span>
<span id="cb57-222"><a href="#cb57-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-223"><a href="#cb57-223" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Après avoir posé le secret, vous calculerez le nombre de cellules</span>
<span id="cb57-224"><a href="#cb57-224" aria-hidden="true" tabindex="-1"></a>    détectées comme à risque.</span>
<span id="cb57-225"><a href="#cb57-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-226"><a href="#cb57-226" aria-hidden="true" tabindex="-1"></a>Le tableau <span class="in">`salades`</span> est un tableau de volumes (CA), les règles de fréquence</span>
<span id="cb57-227"><a href="#cb57-227" aria-hidden="true" tabindex="-1"></a>et de dominance s'appliquent. D'après la jurisprudence Insee sur la</span>
<span id="cb57-228"><a href="#cb57-228" aria-hidden="true" tabindex="-1"></a>diffusion des données entreprises, le seuil de fréquence est fixé à 3 et</span>
<span id="cb57-229"><a href="#cb57-229" aria-hidden="true" tabindex="-1"></a>le plus gros contributeur ne doit pas contribuer à plus de 85% de la</span>
<span id="cb57-230"><a href="#cb57-230" aria-hidden="true" tabindex="-1"></a>cellule.</span>
<span id="cb57-231"><a href="#cb57-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-232"><a href="#cb57-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r detect-salades}</span></span>
<span id="cb57-233"><a href="#cb57-233" aria-hidden="true" tabindex="-1"></a>salades_detect <span class="ot">&lt;-</span> salades <span class="sc">%&gt;%</span></span>
<span id="cb57-234"><a href="#cb57-234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb57-235"><a href="#cb57-235" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_secret_freq =</span> nb_obs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> nb_obs <span class="sc">&lt;</span> <span class="dv">3</span>,</span>
<span id="cb57-236"><a href="#cb57-236" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_secret_dom =</span> (salades_tot <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">&amp;</span> (salades_max <span class="sc">&gt;</span> <span class="fl">0.85</span><span class="sc">*</span>salades_tot),</span>
<span id="cb57-237"><a href="#cb57-237" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_secret_prim =</span> is_secret_freq <span class="sc">|</span> is_secret_dom</span>
<span id="cb57-238"><a href="#cb57-238" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-239"><a href="#cb57-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-240"><a href="#cb57-240" aria-hidden="true" tabindex="-1"></a>salades_detect <span class="sc">%&gt;%</span> <span class="fu">count</span>(is_secret_freq, is_secret_dom)</span>
<span id="cb57-241"><a href="#cb57-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-242"><a href="#cb57-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-243"><a href="#cb57-243" aria-hidden="true" tabindex="-1"></a><span class="fu"># Protéger un tableau simple</span></span>
<span id="cb57-244"><a href="#cb57-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-245"><a href="#cb57-245" aria-hidden="true" tabindex="-1"></a>**Objectif** : protéger un tableau simple en appelant Tau-Argus depuis R pour poser le secret secondaire.</span>
<span id="cb57-246"><a href="#cb57-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-247"><a href="#cb57-247" aria-hidden="true" tabindex="-1"></a>**Consignes** : vous utiliserez les règles en vigueur à l'Insee pour la diffusion des</span>
<span id="cb57-248"><a href="#cb57-248" aria-hidden="true" tabindex="-1"></a>tableaux issus des enquêtes entreprises.</span>
<span id="cb57-249"><a href="#cb57-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-250"><a href="#cb57-250" aria-hidden="true" tabindex="-1"></a><span class="fu">## Poser le secret secondaire</span></span>
<span id="cb57-251"><a href="#cb57-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-252"><a href="#cb57-252" aria-hidden="true" tabindex="-1"></a>Poser un masque de secret sur un tableau comprend les étapes suivantes:</span>
<span id="cb57-253"><a href="#cb57-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-254"><a href="#cb57-254" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Tout d'abord on pose le secret primaire. Pour cela, il faut créer créer des variables indicatrices :</span>
<span id="cb57-255"><a href="#cb57-255" aria-hidden="true" tabindex="-1"></a><span class="ss">   1. </span>Pour chacun des tableaux, vous ajouterez une variable booléenne indiquant si la cellule est problématique (<span class="in">`TRUE`</span>) ou non (<span class="in">`FALSE`</span>), au regard de chacune des règles pertinentes à appliquer :</span>
<span id="cb57-256"><a href="#cb57-256" aria-hidden="true" tabindex="-1"></a><span class="ss">      - </span>Si vous appliquez la règle de fréquence, la variable créée s'appellera <span class="in">`is_secret_freq`</span>;</span>
<span id="cb57-257"><a href="#cb57-257" aria-hidden="true" tabindex="-1"></a><span class="ss">      - </span>Si vous appliquez la règle de dominance, la variable créée s'appellera <span class="in">`is_secret_dom`</span>.</span>
<span id="cb57-258"><a href="#cb57-258" aria-hidden="true" tabindex="-1"></a><span class="ss">   2. </span>Puis de créer une variable qu'on appellera <span class="in">`is_secret_prim`</span>, définie ainsi :</span>
<span id="cb57-259"><a href="#cb57-259" aria-hidden="true" tabindex="-1"></a><span class="ss">      - </span><span class="in">`is_secret_prim = is_secret_freq`</span> si seule la règle de fréquence doit s'appliquer;</span>
<span id="cb57-260"><a href="#cb57-260" aria-hidden="true" tabindex="-1"></a><span class="ss">      - </span><span class="in">`is_secret_prim = is_secret_freq | is_secret_dom`</span> si les deux règles doivent s'appliquer;</span>
<span id="cb57-261"><a href="#cb57-261" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Après avoir posé le secret primaire, vous calculerez le nombre de cellules détectées comme à risque.</span>
<span id="cb57-262"><a href="#cb57-262" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Ensuite, il s'agit de poser le secret secondaire en utilisant le package <span class="in">`rtauargus`</span>. Les consignes d'installation de <span class="in">`rtauargus`</span> et du logiciel Tau-Argus sont indiquées dans la partie <span class="co">[</span><span class="ot">Initialisation</span><span class="co">](#initialisation)</span>. Vous utiliserez la fonction <span class="in">`tab_rtauargus()`</span>.</span>
<span id="cb57-263"><a href="#cb57-263" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Enfin, vous calculerez le nombre de cellules selon leur statut final. Nous utiliserons pour cela la norme européenne en notant :</span>
<span id="cb57-264"><a href="#cb57-264" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`A`</span> les cellules en secret primaire à cause de la règle de fréquence</span>
<span id="cb57-265"><a href="#cb57-265" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`B`</span> les cellules en secret primaire à cause de la règle de dominance (dans le futur ces cellules pourraient être notées <span class="in">`O`</span>)</span>
<span id="cb57-266"><a href="#cb57-266" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`D`</span> les cellules concernées par le secret secondaire</span>
<span id="cb57-267"><a href="#cb57-267" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`V`</span> les cellules non touchées par le secret, cad les cellules qui pourront être diffusées.</span>
<span id="cb57-268"><a href="#cb57-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-269"><a href="#cb57-269" aria-hidden="true" tabindex="-1"></a>La fonction <span class="in">`tab_rtauargus()`</span> permet de poser le secret secondaire et requiert les arguments suivants :  </span>
<span id="cb57-270"><a href="#cb57-270" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`tabular`</span> : la table à protéger</span>
<span id="cb57-271"><a href="#cb57-271" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`dir_name`</span> : le nom du répertoire où  les fichiers seront sauvegardés</span>
<span id="cb57-272"><a href="#cb57-272" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`files_name`</span> : le nom utilisé pour nommer les fichiers (chaque fichier a une extension différente);</span>
<span id="cb57-273"><a href="#cb57-273" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`explanatory_vars`</span> : le nom des variables de croisements présents dans la table;</span>
<span id="cb57-274"><a href="#cb57-274" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`secret_var`</span> : le nom de la variable indiquant si une cellule est à risque ou non (secret primaire);</span>
<span id="cb57-275"><a href="#cb57-275" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`value`</span> : nom de la variable de réponse;</span>
<span id="cb57-276"><a href="#cb57-276" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`freq`</span> : nom de la variable d'effectifs;</span>
<span id="cb57-277"><a href="#cb57-277" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`totcode`</span> : le code utilisé pour indiquer le total pour chacune des variables de croisements (<span class="in">`explanatory_vars`</span>).</span>
<span id="cb57-278"><a href="#cb57-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-279"><a href="#cb57-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb57-280"><a href="#cb57-280" aria-hidden="true" tabindex="-1"></a>salades_masq <span class="ot">&lt;-</span> <span class="fu">tab_rtauargus</span>(</span>
<span id="cb57-281"><a href="#cb57-281" aria-hidden="true" tabindex="-1"></a>  salades_detect,</span>
<span id="cb57-282"><a href="#cb57-282" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"tauargus_files/exo2"</span>,</span>
<span id="cb57-283"><a href="#cb57-283" aria-hidden="true" tabindex="-1"></a>  <span class="at">files_name =</span> <span class="st">"T0"</span>,</span>
<span id="cb57-284"><a href="#cb57-284" aria-hidden="true" tabindex="-1"></a>  <span class="at">explanatory_vars =</span> <span class="fu">c</span>(<span class="st">"a88"</span>,<span class="st">"treff"</span>),</span>
<span id="cb57-285"><a href="#cb57-285" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_prim"</span>,</span>
<span id="cb57-286"><a href="#cb57-286" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"salades_tot"</span>,</span>
<span id="cb57-287"><a href="#cb57-287" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="st">"nb_obs"</span>,</span>
<span id="cb57-288"><a href="#cb57-288" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="fu">c</span>(<span class="at">a88=</span><span class="st">"Total"</span>,<span class="at">treff=</span><span class="st">"Total"</span>),</span>
<span id="cb57-289"><a href="#cb57-289" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb57-290"><a href="#cb57-290" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-291"><a href="#cb57-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-292"><a href="#cb57-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-293"><a href="#cb57-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-294"><a href="#cb57-294" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analyser les résultats</span></span>
<span id="cb57-295"><a href="#cb57-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-296"><a href="#cb57-296" aria-hidden="true" tabindex="-1"></a><span class="fu">### Les fichiers créés lors de l'exécution de Tau-Argus</span></span>
<span id="cb57-297"><a href="#cb57-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-298"><a href="#cb57-298" aria-hidden="true" tabindex="-1"></a>L'ensemble des fichiers créés pendant le processus se trouvent dans le répertoire</span>
<span id="cb57-299"><a href="#cb57-299" aria-hidden="true" tabindex="-1"></a>mentionné dans l'argument <span class="in">`dir_name`</span>. Tous les fichiers ont le même nom,</span>
<span id="cb57-300"><a href="#cb57-300" aria-hidden="true" tabindex="-1"></a>mais pas la même extension:</span>
<span id="cb57-301"><a href="#cb57-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-302"><a href="#cb57-302" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`T0.tab`</span> : tableau de données</span>
<span id="cb57-303"><a href="#cb57-303" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`T0.hst`</span> : fichier d'apriori où sont listées les cellules à risque (secret primaire)</span>
<span id="cb57-304"><a href="#cb57-304" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`T0.rda`</span> : fichier de métadonnées;</span>
<span id="cb57-305"><a href="#cb57-305" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`T0.arb`</span> : fichier batch, qui sera exécuté par Tau-Argus</span>
<span id="cb57-306"><a href="#cb57-306" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`T0.txt`</span> : fichier log, retraçant les étapes exécutées par Tau-Argus</span>
<span id="cb57-307"><a href="#cb57-307" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`T0.csv`</span> : masque au format csv</span>
<span id="cb57-308"><a href="#cb57-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-309"><a href="#cb57-309" aria-hidden="true" tabindex="-1"></a><span class="fu">### Le masque</span></span>
<span id="cb57-310"><a href="#cb57-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-311"><a href="#cb57-311" aria-hidden="true" tabindex="-1"></a>Le masque est retourné par la fonction. Ce masque est une copie de la table fournie en entrée à laquelle une variable supplémentaire, <span class="in">`Status`</span>, est fournie indiquant </span>
<span id="cb57-312"><a href="#cb57-312" aria-hidden="true" tabindex="-1"></a>le statut final de la cellule: </span>
<span id="cb57-313"><a href="#cb57-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-314"><a href="#cb57-314" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`B`</span> : secret primaire (ou apriori)</span>
<span id="cb57-315"><a href="#cb57-315" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`D`</span> : secret secondaire</span>
<span id="cb57-316"><a href="#cb57-316" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`V`</span> : cellule valide, cad qui peut être diffusée</span>
<span id="cb57-317"><a href="#cb57-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-320"><a href="#cb57-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-321"><a href="#cb57-321" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(salades_masq)</span>
<span id="cb57-322"><a href="#cb57-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-323"><a href="#cb57-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-324"><a href="#cb57-324" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bilan du secret</span></span>
<span id="cb57-325"><a href="#cb57-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-326"><a href="#cb57-326" aria-hidden="true" tabindex="-1"></a>Pour faire le bilan du secret le mieux est de modifier la variable <span class="in">`Status`</span> </span>
<span id="cb57-327"><a href="#cb57-327" aria-hidden="true" tabindex="-1"></a>fournie par Tau-Argus. En effet, cette variable ne permet pas de faire la </span>
<span id="cb57-328"><a href="#cb57-328" aria-hidden="true" tabindex="-1"></a>distinction entre l'origine du secret primaire (fréquence ou dominance).</span>
<span id="cb57-329"><a href="#cb57-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-332"><a href="#cb57-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-333"><a href="#cb57-333" aria-hidden="true" tabindex="-1"></a>salades_masq_statut_final <span class="ot">&lt;-</span> salades_masq <span class="sc">%&gt;%</span> </span>
<span id="cb57-334"><a href="#cb57-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-335"><a href="#cb57-335" aria-hidden="true" tabindex="-1"></a>    <span class="at">statut_final =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-336"><a href="#cb57-336" aria-hidden="true" tabindex="-1"></a>      is_secret_freq <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb57-337"><a href="#cb57-337" aria-hidden="true" tabindex="-1"></a>      is_secret_dom <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb57-338"><a href="#cb57-338" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> Status,</span>
<span id="cb57-339"><a href="#cb57-339" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-340"><a href="#cb57-340" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-341"><a href="#cb57-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-342"><a href="#cb57-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-343"><a href="#cb57-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-344"><a href="#cb57-344" aria-hidden="true" tabindex="-1"></a>Afin de bien appréhender l'impact du secret posé, on va non seulement compter</span>
<span id="cb57-345"><a href="#cb57-345" aria-hidden="true" tabindex="-1"></a>le nombre de cellules masquées, mais aussi calculer la valeur des cellules masquées.</span>
<span id="cb57-346"><a href="#cb57-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-349"><a href="#cb57-349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-350"><a href="#cb57-350" aria-hidden="true" tabindex="-1"></a>salades_masq_statut_final <span class="sc">%&gt;%</span> </span>
<span id="cb57-351"><a href="#cb57-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(statut_final) <span class="sc">%&gt;%</span> </span>
<span id="cb57-352"><a href="#cb57-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb57-353"><a href="#cb57-353" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cell =</span> <span class="fu">n</span>(),</span>
<span id="cb57-354"><a href="#cb57-354" aria-hidden="true" tabindex="-1"></a>    <span class="at">val_cell =</span> <span class="fu">sum</span>(salades_tot)</span>
<span id="cb57-355"><a href="#cb57-355" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb57-356"><a href="#cb57-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-357"><a href="#cb57-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_n_cell =</span> n_cell<span class="sc">/</span><span class="fu">sum</span>(n_cell)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb57-358"><a href="#cb57-358" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_val_cell =</span> val_cell<span class="sc">/</span><span class="fu">sum</span>(val_cell)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb57-359"><a href="#cb57-359" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-360"><a href="#cb57-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-361"><a href="#cb57-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-362"><a href="#cb57-362" aria-hidden="true" tabindex="-1"></a>On masque 1.5% des cellules mais moins de 0.01% de l'information totale.</span>
<span id="cb57-363"><a href="#cb57-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-364"><a href="#cb57-364" aria-hidden="true" tabindex="-1"></a><span class="fu"># Protéger un tableau hiérarchique {#proteger-un-tableau-hierarchique}</span></span>
<span id="cb57-365"><a href="#cb57-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-366"><a href="#cb57-366" aria-hidden="true" tabindex="-1"></a>**Objectifs** : comprendre la notion de variables hiérarchiques et savoir manipuler les objets et </span>
<span id="cb57-367"><a href="#cb57-367" aria-hidden="true" tabindex="-1"></a>fichiers argus qui y sont associés. Pour ensuite, protéger un tableau contenant une ou plusieurs variables hiérarchiques</span>
<span id="cb57-368"><a href="#cb57-368" aria-hidden="true" tabindex="-1"></a>en appelant Tau-Argus depuis R pour poser le secret secondaire.</span>
<span id="cb57-369"><a href="#cb57-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-370"><a href="#cb57-370" aria-hidden="true" tabindex="-1"></a>Reprenons l'exemple présenté dans le diaporama:</span>
<span id="cb57-371"><a href="#cb57-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-374"><a href="#cb57-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-375"><a href="#cb57-375" aria-hidden="true" tabindex="-1"></a>T0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb57-376"><a href="#cb57-376" aria-hidden="true" tabindex="-1"></a>  <span class="at">geo =</span> <span class="fu">c</span>(<span class="st">"Pays"</span>,<span class="st">"Nord"</span>,<span class="st">"Ouest"</span>,<span class="st">"Est"</span>,<span class="st">"Sud"</span>,<span class="fu">paste0</span>(<span class="st">"N"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),<span class="fu">paste0</span>(<span class="st">"O"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),<span class="fu">paste0</span>(<span class="st">"E"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="fu">paste0</span>(<span class="st">"S"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb57-377"><a href="#cb57-377" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="fu">c</span>(<span class="dv">400</span>, <span class="dv">46</span>, <span class="dv">191</span>, <span class="dv">80</span>, <span class="dv">83</span>, <span class="dv">21</span>, <span class="dv">2</span>, <span class="dv">23</span>, <span class="dv">32</span>, <span class="dv">54</span>, <span class="dv">67</span>, <span class="dv">38</span>, <span class="dv">27</span>, <span class="dv">41</span>, <span class="dv">12</span>, <span class="dv">44</span>, <span class="dv">39</span>)</span>
<span id="cb57-378"><a href="#cb57-378" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-379"><a href="#cb57-379" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(T0)</span>
<span id="cb57-380"><a href="#cb57-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-381"><a href="#cb57-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-382"><a href="#cb57-382" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`geo`</span> est une variable hiérarchique puisqu'il existe des emboîtements </span>
<span id="cb57-383"><a href="#cb57-383" aria-hidden="true" tabindex="-1"></a>entre les différents niveaux :  </span>
<span id="cb57-384"><a href="#cb57-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-385"><a href="#cb57-385" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pays = Nord + Ouest + Est + Sud</span>
<span id="cb57-386"><a href="#cb57-386" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Nord = N1 + N2 + N3</span>
<span id="cb57-387"><a href="#cb57-387" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ouest = O1 + O2 + O3 + O4</span>
<span id="cb57-388"><a href="#cb57-388" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Est = E1 + E2 + E3</span>
<span id="cb57-389"><a href="#cb57-389" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sud = S1 + S2</span>
<span id="cb57-390"><a href="#cb57-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-391"><a href="#cb57-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-392"><a href="#cb57-392" aria-hidden="true" tabindex="-1"></a>Avant de penser à protéger un tel tableau, il faut pouvoir représenter correctement </span>
<span id="cb57-393"><a href="#cb57-393" aria-hidden="true" tabindex="-1"></a>cette hiérarchie, c'est-à-dire de telle sorte que tau-argus sache comprendre les différents</span>
<span id="cb57-394"><a href="#cb57-394" aria-hidden="true" tabindex="-1"></a>emboîtements présents.</span>
<span id="cb57-395"><a href="#cb57-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-396"><a href="#cb57-396" aria-hidden="true" tabindex="-1"></a><span class="fu">## Construction du fichier hiérarchique pour Tau-Argus</span></span>
<span id="cb57-397"><a href="#cb57-397" aria-hidden="true" tabindex="-1"></a><span class="fu">### "A la main"</span></span>
<span id="cb57-398"><a href="#cb57-398" aria-hidden="true" tabindex="-1"></a>La première option consiste à créer le fichier nécessaire (extension .hrc) à la main.</span>
<span id="cb57-399"><a href="#cb57-399" aria-hidden="true" tabindex="-1"></a>Ceci est tout à fait pertinent si la hiérarchie n'est pas trop étendue.</span>
<span id="cb57-400"><a href="#cb57-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-401"><a href="#cb57-401" aria-hidden="true" tabindex="-1"></a>Tau-Argus attend en effet un type de fichier bien particulier, dont l'extension </span>
<span id="cb57-402"><a href="#cb57-402" aria-hidden="true" tabindex="-1"></a>est <span class="in">`.hrc`</span>. Il s'agit d'un simple fichier texte où les différents emboîtements </span>
<span id="cb57-403"><a href="#cb57-403" aria-hidden="true" tabindex="-1"></a>sont écrits les uns en-dessous des autres. Un symbole (le <span class="in">`@`</span>) est utilisé pour </span>
<span id="cb57-404"><a href="#cb57-404" aria-hidden="true" tabindex="-1"></a>préciser le niveau de chacun des emboîtements au sein de la hiérarchie.</span>
<span id="cb57-405"><a href="#cb57-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-406"><a href="#cb57-406" aria-hidden="true" tabindex="-1"></a>Par exemple, un fichier contenant les lignes suivantes :</span>
<span id="cb57-407"><a href="#cb57-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-408"><a href="#cb57-408" aria-hidden="true" tabindex="-1"></a>ALL  </span>
<span id="cb57-409"><a href="#cb57-409" aria-hidden="true" tabindex="-1"></a>@A  </span>
<span id="cb57-410"><a href="#cb57-410" aria-hidden="true" tabindex="-1"></a>@@A1  </span>
<span id="cb57-411"><a href="#cb57-411" aria-hidden="true" tabindex="-1"></a>@@A2  </span>
<span id="cb57-412"><a href="#cb57-412" aria-hidden="true" tabindex="-1"></a>@B  </span>
<span id="cb57-413"><a href="#cb57-413" aria-hidden="true" tabindex="-1"></a>@@B1  </span>
<span id="cb57-414"><a href="#cb57-414" aria-hidden="true" tabindex="-1"></a>@@B2  </span>
<span id="cb57-415"><a href="#cb57-415" aria-hidden="true" tabindex="-1"></a>@@@B21  </span>
<span id="cb57-416"><a href="#cb57-416" aria-hidden="true" tabindex="-1"></a>@@@B22  </span>
<span id="cb57-417"><a href="#cb57-417" aria-hidden="true" tabindex="-1"></a>@C  </span>
<span id="cb57-418"><a href="#cb57-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-419"><a href="#cb57-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-420"><a href="#cb57-420" aria-hidden="true" tabindex="-1"></a>décrit une hiérarchie contenant les emboîtements suivants:  </span>
<span id="cb57-421"><a href="#cb57-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-422"><a href="#cb57-422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ALL = A + B + C =&gt; ALL est le total et A, B et C sont les emboîtements de niveau 1;</span>
<span id="cb57-423"><a href="#cb57-423" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A = A1 + A2 =&gt; A1 et A2 sont des sous-niveaux de A, donc des emboîtements de niveau 2;</span>
<span id="cb57-424"><a href="#cb57-424" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>B = B1 + B2</span>
<span id="cb57-425"><a href="#cb57-425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>B2 = B21 + B22</span>
<span id="cb57-426"><a href="#cb57-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-427"><a href="#cb57-427" aria-hidden="true" tabindex="-1"></a>Néanmoins, pour utiliser cette hiérarchie avec Tau-Argus, **le super-total (ici "ALL")</span>
<span id="cb57-428"><a href="#cb57-428" aria-hidden="true" tabindex="-1"></a>ne doit pas apparaître dans le fichier .hrc** qui lui est fourni.</span>
<span id="cb57-429"><a href="#cb57-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-430"><a href="#cb57-430" aria-hidden="true" tabindex="-1"></a>Le bon fichier est donc le suivant :</span>
<span id="cb57-431"><a href="#cb57-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-432"><a href="#cb57-432" aria-hidden="true" tabindex="-1"></a>@A  </span>
<span id="cb57-433"><a href="#cb57-433" aria-hidden="true" tabindex="-1"></a>@@A1  </span>
<span id="cb57-434"><a href="#cb57-434" aria-hidden="true" tabindex="-1"></a>@@A2  </span>
<span id="cb57-435"><a href="#cb57-435" aria-hidden="true" tabindex="-1"></a>@B  </span>
<span id="cb57-436"><a href="#cb57-436" aria-hidden="true" tabindex="-1"></a>@@B1  </span>
<span id="cb57-437"><a href="#cb57-437" aria-hidden="true" tabindex="-1"></a>@@B2  </span>
<span id="cb57-438"><a href="#cb57-438" aria-hidden="true" tabindex="-1"></a>@@@B21  </span>
<span id="cb57-439"><a href="#cb57-439" aria-hidden="true" tabindex="-1"></a>@@@B22  </span>
<span id="cb57-440"><a href="#cb57-440" aria-hidden="true" tabindex="-1"></a>@C  </span>
<span id="cb57-441"><a href="#cb57-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-442"><a href="#cb57-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-443"><a href="#cb57-443" aria-hidden="true" tabindex="-1"></a><span class="fu">### Automatiquement</span></span>
<span id="cb57-444"><a href="#cb57-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-445"><a href="#cb57-445" aria-hidden="true" tabindex="-1"></a>Quand la hiérarchie est très étendue, l'écriture manuelle du fichier de hiérarchie </span>
<span id="cb57-446"><a href="#cb57-446" aria-hidden="true" tabindex="-1"></a>est pénible. Or, quand ce genre de cas se présente, il existe souvent une table </span>
<span id="cb57-447"><a href="#cb57-447" aria-hidden="true" tabindex="-1"></a>de correspondance permettant d'associer les différents niveaux entre eux.</span>
<span id="cb57-448"><a href="#cb57-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-449"><a href="#cb57-449" aria-hidden="true" tabindex="-1"></a>Nous appelons table de correspondance une table qui précise l'ensemble des niveaux </span>
<span id="cb57-450"><a href="#cb57-450" aria-hidden="true" tabindex="-1"></a>associés aux emboîtements les plus fins.</span>
<span id="cb57-451"><a href="#cb57-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-452"><a href="#cb57-452" aria-hidden="true" tabindex="-1"></a>La table de correspondance représentant la hiérarchie suivante :</span>
<span id="cb57-453"><a href="#cb57-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-454"><a href="#cb57-454" aria-hidden="true" tabindex="-1"></a>ALL  </span>
<span id="cb57-455"><a href="#cb57-455" aria-hidden="true" tabindex="-1"></a>@A  </span>
<span id="cb57-456"><a href="#cb57-456" aria-hidden="true" tabindex="-1"></a>@@A1  </span>
<span id="cb57-457"><a href="#cb57-457" aria-hidden="true" tabindex="-1"></a>@@A2  </span>
<span id="cb57-458"><a href="#cb57-458" aria-hidden="true" tabindex="-1"></a>@B  </span>
<span id="cb57-459"><a href="#cb57-459" aria-hidden="true" tabindex="-1"></a>@@B1  </span>
<span id="cb57-460"><a href="#cb57-460" aria-hidden="true" tabindex="-1"></a>@@B2  </span>
<span id="cb57-461"><a href="#cb57-461" aria-hidden="true" tabindex="-1"></a>@@@B21  </span>
<span id="cb57-462"><a href="#cb57-462" aria-hidden="true" tabindex="-1"></a>@@@B22  </span>
<span id="cb57-463"><a href="#cb57-463" aria-hidden="true" tabindex="-1"></a>@C  </span>
<span id="cb57-464"><a href="#cb57-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-465"><a href="#cb57-465" aria-hidden="true" tabindex="-1"></a>est la suivante:</span>
<span id="cb57-466"><a href="#cb57-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-467"><a href="#cb57-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-470"><a href="#cb57-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-471"><a href="#cb57-471" aria-hidden="true" tabindex="-1"></a>corr_tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb57-472"><a href="#cb57-472" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv0 =</span> <span class="st">"ALL"</span>,</span>
<span id="cb57-473"><a href="#cb57-473" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv1 =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"A"</span>,<span class="dv">2</span>),<span class="fu">rep</span>(<span class="st">"B"</span>,<span class="dv">3</span>), <span class="st">"C"</span>),</span>
<span id="cb57-474"><a href="#cb57-474" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv2 =</span> <span class="fu">c</span>(<span class="st">"A1"</span>,<span class="st">"A2"</span>,<span class="st">"B1"</span>,<span class="fu">rep</span>(<span class="st">"B2"</span>,<span class="dv">2</span>), <span class="st">"C"</span>),</span>
<span id="cb57-475"><a href="#cb57-475" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv3 =</span> <span class="fu">c</span>(<span class="st">"A1"</span>,<span class="st">"A2"</span>,<span class="st">"B1"</span>, <span class="st">"B21"</span>, <span class="st">"B22"</span>, <span class="st">"C"</span>)</span>
<span id="cb57-476"><a href="#cb57-476" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-477"><a href="#cb57-477" aria-hidden="true" tabindex="-1"></a>corr_tab</span>
<span id="cb57-478"><a href="#cb57-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-479"><a href="#cb57-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-480"><a href="#cb57-480" aria-hidden="true" tabindex="-1"></a>Remarque: La fonction <span class="in">`rtauargus::write_hrc2()`</span> qui permet de construire le fichier <span class="in">`.hrc`</span> </span>
<span id="cb57-481"><a href="#cb57-481" aria-hidden="true" tabindex="-1"></a>à partir d'une table de correspondance n'accepte pas de valeurs manquantes dans </span>
<span id="cb57-482"><a href="#cb57-482" aria-hidden="true" tabindex="-1"></a>la table en entrée. C'est pourquoi, à la dernière ligne, par exemple, <span class="in">`C`</span> </span>
<span id="cb57-483"><a href="#cb57-483" aria-hidden="true" tabindex="-1"></a>n'admettant pas de subdivisions est répété sur les niveaux inférieurs.</span>
<span id="cb57-484"><a href="#cb57-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-485"><a href="#cb57-485" aria-hidden="true" tabindex="-1"></a>Avec la fonction <span class="in">`write_hrc2()`</span> du package <span class="in">`rtauargus`</span>, on peut exporter la </span>
<span id="cb57-486"><a href="#cb57-486" aria-hidden="true" tabindex="-1"></a>table de correspondance en un fichier <span class="in">`hrc`</span>.</span>
<span id="cb57-487"><a href="#cb57-487" aria-hidden="true" tabindex="-1"></a>Comme noté précédemment, Tau-Argus n'acceptant pas que le super-total d'une variable </span>
<span id="cb57-488"><a href="#cb57-488" aria-hidden="true" tabindex="-1"></a>hiérarchique soit présent dans le fichier <span class="in">`.hrc`</span> on le supprime:</span>
<span id="cb57-489"><a href="#cb57-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-492"><a href="#cb57-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-493"><a href="#cb57-493" aria-hidden="true" tabindex="-1"></a><span class="fu">write_hrc2</span>(corr_tab <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>niv0), <span class="at">file_name =</span> <span class="st">"fichiers_tauargus/hrc/exemple_TA.hrc"</span>)</span>
<span id="cb57-494"><a href="#cb57-494" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span>(<span class="st">"fichiers_tauargus/hrc/exemple_TA.hrc"</span>)</span>
<span id="cb57-495"><a href="#cb57-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-496"><a href="#cb57-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-497"><a href="#cb57-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-498"><a href="#cb57-498" aria-hidden="true" tabindex="-1"></a><span class="fu">## Protection</span></span>
<span id="cb57-499"><a href="#cb57-499" aria-hidden="true" tabindex="-1"></a>A présent nous protégeons le tableau T0 pour lequel on vient de construire la hiérarchie.</span>
<span id="cb57-500"><a href="#cb57-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-501"><a href="#cb57-501" aria-hidden="true" tabindex="-1"></a>La variable <span class="in">`geo`</span> est hiérarchique (Pays = Nord + Ouest + Est + Sud, par exemple), on construit le fichier adéquat.</span>
<span id="cb57-502"><a href="#cb57-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-503"><a href="#cb57-503" aria-hidden="true" tabindex="-1"></a>Table de passage (habituellement elle existe déjà mais pour l'exercice nous la créons) et appel à <span class="in">`rtauargus::write_hrc2()`</span>.</span>
<span id="cb57-504"><a href="#cb57-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-507"><a href="#cb57-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-508"><a href="#cb57-508" aria-hidden="true" tabindex="-1"></a>corr_pays <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb57-509"><a href="#cb57-509" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv1 =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Nord"</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">"Ouest"</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="st">"Est"</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">"Sud"</span>, <span class="dv">2</span>)),</span>
<span id="cb57-510"><a href="#cb57-510" aria-hidden="true" tabindex="-1"></a>  <span class="at">niv2 =</span> <span class="fu">c</span>(<span class="st">"N1"</span>, <span class="st">"N2"</span>, <span class="st">"N3"</span>, <span class="st">"O1"</span>, <span class="st">"O2"</span>, <span class="st">"O3"</span>, <span class="st">"O4"</span>, <span class="st">"E1"</span>, <span class="st">"E2"</span>, <span class="st">"E3"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span>)</span>
<span id="cb57-511"><a href="#cb57-511" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-512"><a href="#cb57-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-513"><a href="#cb57-513" aria-hidden="true" tabindex="-1"></a><span class="fu">write_hrc2</span>(corr_pays, <span class="at">file_name =</span> <span class="st">"fichiers_tauargus/hrc/pays.hrc"</span>)</span>
<span id="cb57-514"><a href="#cb57-514" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span>(<span class="st">"fichiers_tauargus/hrc/pays.hrc"</span>)</span>
<span id="cb57-515"><a href="#cb57-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-516"><a href="#cb57-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-517"><a href="#cb57-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-518"><a href="#cb57-518" aria-hidden="true" tabindex="-1"></a>Nous pouvons dès lors poser le masque de secret sur ce tableau. Pour cela, nous faisons toujours appel à la fonction <span class="in">`tab_rtauargus`</span>.</span>
<span id="cb57-519"><a href="#cb57-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-520"><a href="#cb57-520" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Poser le secret primaire</span></span>
<span id="cb57-521"><a href="#cb57-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-524"><a href="#cb57-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-525"><a href="#cb57-525" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(T0)</span>
<span id="cb57-526"><a href="#cb57-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-527"><a href="#cb57-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-528"><a href="#cb57-528" aria-hidden="true" tabindex="-1"></a>Il s'agit d'un tableau d'effectifs/de fréquence, on pose donc seulement le secret primaire de fréquence.</span>
<span id="cb57-529"><a href="#cb57-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-532"><a href="#cb57-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-533"><a href="#cb57-533" aria-hidden="true" tabindex="-1"></a>T0_detect <span class="ot">&lt;-</span> T0 <span class="sc">%&gt;%</span> </span>
<span id="cb57-534"><a href="#cb57-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-535"><a href="#cb57-535" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_secret_freq =</span> freq <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> freq <span class="sc">&lt;</span> <span class="dv">3</span></span>
<span id="cb57-536"><a href="#cb57-536" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-537"><a href="#cb57-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-538"><a href="#cb57-538" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(T0_detect<span class="sc">$</span>is_secret_freq)</span>
<span id="cb57-539"><a href="#cb57-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-540"><a href="#cb57-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-541"><a href="#cb57-541" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Lancer Tau-Argus pour poser le secret secondaire</span></span>
<span id="cb57-542"><a href="#cb57-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-543"><a href="#cb57-543" aria-hidden="true" tabindex="-1"></a>Pour que l'information hiérarchique soit bien prise en compte lors de la pose du</span>
<span id="cb57-544"><a href="#cb57-544" aria-hidden="true" tabindex="-1"></a>secret secondaire par Tau-Argus, il suffit de renseigner l'argument <span class="in">`hrc = `</span> </span>
<span id="cb57-545"><a href="#cb57-545" aria-hidden="true" tabindex="-1"></a>sous la forme d'un vecteur nommé <span class="in">`c(var1 = fichier1, var2 = fichier2,...)`</span>:</span>
<span id="cb57-546"><a href="#cb57-546" aria-hidden="true" tabindex="-1"></a>le nom de chaque élément étant le nom de la variable concernée et la valeur étant </span>
<span id="cb57-547"><a href="#cb57-547" aria-hidden="true" tabindex="-1"></a>la localisation du fichier <span class="in">`.hrc`</span> correspondant.</span>
<span id="cb57-548"><a href="#cb57-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-549"><a href="#cb57-549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb57-550"><a href="#cb57-550" aria-hidden="true" tabindex="-1"></a>T0_masq <span class="ot">&lt;-</span> <span class="fu">tab_rtauargus</span>(</span>
<span id="cb57-551"><a href="#cb57-551" aria-hidden="true" tabindex="-1"></a>  T0_detect,</span>
<span id="cb57-552"><a href="#cb57-552" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"fichiers_tauargus/sorties/ex_hrc_pays"</span>,</span>
<span id="cb57-553"><a href="#cb57-553" aria-hidden="true" tabindex="-1"></a>  <span class="at">files_name =</span> <span class="st">"T0"</span>,</span>
<span id="cb57-554"><a href="#cb57-554" aria-hidden="true" tabindex="-1"></a>  <span class="at">explanatory_vars =</span> <span class="st">"geo"</span>,</span>
<span id="cb57-555"><a href="#cb57-555" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc =</span> <span class="fu">c</span>(<span class="at">geo =</span> <span class="st">"fichiers_tauargus/hrc/pays.hrc"</span>),</span>
<span id="cb57-556"><a href="#cb57-556" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_freq"</span>,</span>
<span id="cb57-557"><a href="#cb57-557" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"freq"</span>,</span>
<span id="cb57-558"><a href="#cb57-558" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="fu">c</span>(<span class="at">geo=</span><span class="st">"Pays"</span>),</span>
<span id="cb57-559"><a href="#cb57-559" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb57-560"><a href="#cb57-560" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-561"><a href="#cb57-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-562"><a href="#cb57-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-563"><a href="#cb57-563" aria-hidden="true" tabindex="-1"></a>Vérifions que le secret a été posé correctement : </span>
<span id="cb57-564"><a href="#cb57-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-567"><a href="#cb57-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-568"><a href="#cb57-568" aria-hidden="true" tabindex="-1"></a>T0_masq</span>
<span id="cb57-569"><a href="#cb57-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-570"><a href="#cb57-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-571"><a href="#cb57-571" aria-hidden="true" tabindex="-1"></a>La cellule N2 est en secret primaire car elle a une fréquence inférieure à 3. Il faut donc poser un secret secondaire pour protéger cette cellule. On voit que N1 est en secret secondaire ce qui permet de protéger N2 de la différenciation avec le total Nord. Donc, on a bien ici une pose de secret qui respecte la hiérarchie de la variable <span class="in">`geo`</span>.</span>
<span id="cb57-572"><a href="#cb57-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-573"><a href="#cb57-573" aria-hidden="true" tabindex="-1"></a>Regardons à présent le secret posé sans prendre en compte la hiérarchie sur la variable <span class="in">`geo`</span> :</span>
<span id="cb57-574"><a href="#cb57-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-575"><a href="#cb57-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb57-576"><a href="#cb57-576" aria-hidden="true" tabindex="-1"></a>T0_masq_sans_hrc <span class="ot">&lt;-</span> <span class="fu">tab_rtauargus</span>(</span>
<span id="cb57-577"><a href="#cb57-577" aria-hidden="true" tabindex="-1"></a>  T0_detect,</span>
<span id="cb57-578"><a href="#cb57-578" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"fichiers_tauargus/sorties/ex_hrc_pays"</span>,</span>
<span id="cb57-579"><a href="#cb57-579" aria-hidden="true" tabindex="-1"></a>  <span class="at">files_name =</span> <span class="st">"T0"</span>,</span>
<span id="cb57-580"><a href="#cb57-580" aria-hidden="true" tabindex="-1"></a>  <span class="at">explanatory_vars =</span> <span class="st">"geo"</span>,</span>
<span id="cb57-581"><a href="#cb57-581" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hrc = c(geo = "fichiers_tauargus/hrc/pays.hrc"),</span></span>
<span id="cb57-582"><a href="#cb57-582" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_freq"</span>,</span>
<span id="cb57-583"><a href="#cb57-583" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"freq"</span>,</span>
<span id="cb57-584"><a href="#cb57-584" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="fu">c</span>(<span class="at">geo=</span><span class="st">"Pays"</span>),</span>
<span id="cb57-585"><a href="#cb57-585" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb57-586"><a href="#cb57-586" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-587"><a href="#cb57-587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-588"><a href="#cb57-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-589"><a href="#cb57-589" aria-hidden="true" tabindex="-1"></a>Cette fois-ci le secret secondaire est posé en E3, pour minimiser les valeurs supprimées.</span>
<span id="cb57-590"><a href="#cb57-590" aria-hidden="true" tabindex="-1"></a>Mais ce secret ne tient pas car on peut retrouver la valeur de N2 en faisant N2 = Nord - N1.</span>
<span id="cb57-591"><a href="#cb57-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-594"><a href="#cb57-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-595"><a href="#cb57-595" aria-hidden="true" tabindex="-1"></a>T0_masq_sans_hrc</span>
<span id="cb57-596"><a href="#cb57-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-597"><a href="#cb57-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-598"><a href="#cb57-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-599"><a href="#cb57-599" aria-hidden="true" tabindex="-1"></a><span class="fu"># Protéger des tableaux liés</span></span>
<span id="cb57-600"><a href="#cb57-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-601"><a href="#cb57-601" aria-hidden="true" tabindex="-1"></a>Lorsque l'on souhaite publier plusieurs tableaux il faut suivre une démarche permettant de les protéger de manière cohérente. En effet, il faut identifier les cellules communes entre les tableaux afin de préciser leur existence à <span class="in">`rtauargus`</span> qui se chargera de la cohérence du secret.</span>
<span id="cb57-602"><a href="#cb57-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-603"><a href="#cb57-603" aria-hidden="true" tabindex="-1"></a>Voici la démarche à suivre :</span>
<span id="cb57-604"><a href="#cb57-604" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>détecter les cellules communes entre les tableaux à partir des métadonnées</span>
<span id="cb57-605"><a href="#cb57-605" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>tabuler les données et construire les hiérarchies nécessaires</span>
<span id="cb57-606"><a href="#cb57-606" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>poser le secret primaire</span>
<span id="cb57-607"><a href="#cb57-607" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>créer des listes de tableaux indépendantes (une liste = un cluster)</span>
<span id="cb57-608"><a href="#cb57-608" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>poser le secret secondaire avec <span class="in">`rtauargus::tab_multi_manager()`</span></span>
<span id="cb57-609"><a href="#cb57-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-610"><a href="#cb57-610" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analyser la demande</span></span>
<span id="cb57-611"><a href="#cb57-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-612"><a href="#cb57-612" aria-hidden="true" tabindex="-1"></a>A partir des microdonnées présentées dans la partie "Tabuler les données", on souhaite publier les tableaux suivants.</span>
<span id="cb57-613"><a href="#cb57-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-614"><a href="#cb57-614" aria-hidden="true" tabindex="-1"></a><span class="in">```{r metadonnees}</span></span>
<span id="cb57-615"><a href="#cb57-615" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb57-616"><a href="#cb57-616" aria-hidden="true" tabindex="-1"></a><span class="co">#| as-is: true</span></span>
<span id="cb57-617"><a href="#cb57-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-618"><a href="#cb57-618" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb57-619"><a href="#cb57-619" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb57-620"><a href="#cb57-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-621"><a href="#cb57-621" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb57-622"><a href="#cb57-622" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Tab, <span class="sc">~</span>Var_reponse, <span class="sc">~</span>expl_var1, <span class="sc">~</span>expl_var2,</span>
<span id="cb57-623"><a href="#cb57-623" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T1"</span>, <span class="st">"ca_pizzas"</span>, <span class="st">"Nuts2"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-624"><a href="#cb57-624" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T2"</span>, <span class="st">"ca_pizzas"</span>, <span class="st">"Nuts3"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-625"><a href="#cb57-625" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T3"</span>, <span class="st">"ca_pizzas"</span>, <span class="st">"A10"</span>, <span class="st">"Nuts2"</span>,</span>
<span id="cb57-626"><a href="#cb57-626" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T4"</span>, <span class="st">"ca_pizzas"</span>, <span class="st">"A10"</span>, <span class="st">"Nuts3"</span>,</span>
<span id="cb57-627"><a href="#cb57-627" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T5"</span>, <span class="st">"ca_pizzas"</span>, <span class="st">"A21"</span>, <span class="st">"Nuts2"</span>,</span>
<span id="cb57-628"><a href="#cb57-628" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T6"</span>, <span class="st">"ca_pizzas"</span>, <span class="st">"A21"</span>, <span class="st">"Nuts3"</span>,</span>
<span id="cb57-629"><a href="#cb57-629" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T7"</span>, <span class="st">"ca_pizzas"</span>, <span class="st">"A88"</span>, <span class="st">"Nuts2"</span>,</span>
<span id="cb57-630"><a href="#cb57-630" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T8"</span>, <span class="st">"ca_pizzas"</span>, <span class="st">"A88"</span>, <span class="st">"Nuts3"</span>,</span>
<span id="cb57-631"><a href="#cb57-631" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T9"</span>, <span class="st">"ca_batavia"</span>, <span class="st">"A10"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-632"><a href="#cb57-632" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T10"</span>, <span class="st">"ca_batavia"</span>, <span class="st">"A10"</span>, <span class="st">"CJ"</span>,</span>
<span id="cb57-633"><a href="#cb57-633" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T11"</span>, <span class="st">"ca_batavia"</span>, <span class="st">"A21"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-634"><a href="#cb57-634" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T12"</span>, <span class="st">"ca_batavia"</span>, <span class="st">"A21"</span>, <span class="st">"CJ"</span>,</span>
<span id="cb57-635"><a href="#cb57-635" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T13"</span>, <span class="st">"ca_batavia"</span>, <span class="st">"A88"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-636"><a href="#cb57-636" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T14"</span>, <span class="st">"ca_batavia"</span>, <span class="st">"A88"</span>, <span class="st">"CJ"</span>,</span>
<span id="cb57-637"><a href="#cb57-637" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T15"</span>, <span class="st">"ca_mache"</span>, <span class="st">"A10"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-638"><a href="#cb57-638" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T16"</span>, <span class="st">"ca_mache"</span>, <span class="st">"A10"</span>, <span class="st">"CJ"</span>,</span>
<span id="cb57-639"><a href="#cb57-639" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T17"</span>, <span class="st">"ca_mache"</span>, <span class="st">"A21"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-640"><a href="#cb57-640" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T18"</span>, <span class="st">"ca_mache"</span>, <span class="st">"A21"</span>, <span class="st">"CJ"</span>,</span>
<span id="cb57-641"><a href="#cb57-641" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T19"</span>, <span class="st">"ca_mache"</span>, <span class="st">"A88"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-642"><a href="#cb57-642" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T20"</span>, <span class="st">"ca_mache"</span>, <span class="st">"A88"</span>, <span class="st">"CJ"</span>,</span>
<span id="cb57-643"><a href="#cb57-643" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T21"</span>, <span class="st">"ca_salades"</span>, <span class="st">"A10"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-644"><a href="#cb57-644" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T22"</span>, <span class="st">"ca_salades"</span>, <span class="st">"A10"</span>, <span class="st">"CJ"</span>,</span>
<span id="cb57-645"><a href="#cb57-645" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T23"</span>, <span class="st">"ca_salades"</span>, <span class="st">"A21"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-646"><a href="#cb57-646" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T24"</span>, <span class="st">"ca_salades"</span>, <span class="st">"A21"</span>, <span class="st">"CJ"</span>,</span>
<span id="cb57-647"><a href="#cb57-647" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T25"</span>, <span class="st">"ca_salades"</span>, <span class="st">"A88"</span>, <span class="st">"TREFF"</span>,</span>
<span id="cb57-648"><a href="#cb57-648" aria-hidden="true" tabindex="-1"></a>  <span class="st">"T26"</span>, <span class="st">"ca_salades"</span>, <span class="st">"A88"</span>, <span class="st">"CJ"</span></span>
<span id="cb57-649"><a href="#cb57-649" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-650"><a href="#cb57-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-651"><a href="#cb57-651" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(t)</span>
<span id="cb57-652"><a href="#cb57-652" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Champ de la population : entreprises françaises.</span><span class="sc">\n</span><span class="st">Informations complémentaires : il n'y a que deux types de salades les batavias et la mâche."</span>)</span>
<span id="cb57-653"><a href="#cb57-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-654"><a href="#cb57-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-655"><a href="#cb57-655" aria-hidden="true" tabindex="-1"></a>Pour n'oublier aucun lien entre les tableaux, on procède étape par étape.</span>
<span id="cb57-656"><a href="#cb57-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-657"><a href="#cb57-657" aria-hidden="true" tabindex="-1"></a><span class="fu">### Les tableaux sont-ils sur le même champ ?</span></span>
<span id="cb57-658"><a href="#cb57-658" aria-hidden="true" tabindex="-1"></a>Oui les tableaux portent tous sur le même champ des entreprises françaises.</span>
<span id="cb57-659"><a href="#cb57-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-660"><a href="#cb57-660" aria-hidden="true" tabindex="-1"></a><span class="fu">### Les tableaux ont-ils les mêmes variables réponses ?</span></span>
<span id="cb57-661"><a href="#cb57-661" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T1-T8&nbsp;: variable réponse «&nbsp;ca_pizzas&nbsp;»</span>
<span id="cb57-662"><a href="#cb57-662" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T9-T14&nbsp;: variable réponse «&nbsp;ca_batavia&nbsp;»</span>
<span id="cb57-663"><a href="#cb57-663" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T15-T20&nbsp;: variable réponse «&nbsp;ca_mache&nbsp;»</span>
<span id="cb57-664"><a href="#cb57-664" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T21-T26&nbsp;: variable réponse «&nbsp;ca_salades&nbsp;»</span>
<span id="cb57-665"><a href="#cb57-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-666"><a href="#cb57-666" aria-hidden="true" tabindex="-1"></a><span class="fu">### Les variables réponses ont-elles un lien entre elles ?</span></span>
<span id="cb57-667"><a href="#cb57-667" aria-hidden="true" tabindex="-1"></a>L’information complémentaire nous identique qu’il n’y a que deux types de salades, les batavias et la mâche. On comprend donc que la somme des chiffres d’affaires des batavias et des mâches est égale au chiffre d’affaires des salades&nbsp;: ca_salades = ca_batavia + ca_mache.</span>
<span id="cb57-668"><a href="#cb57-668" aria-hidden="true" tabindex="-1"></a>On peut donc regrouper tous les tableaux qui ont les mêmes variables de croisement et l’un de ces trois indicateurs dans un même tableau. Dans ce tableau on crée une nouvelle variable de croisement qu’on peut nommer «&nbsp;crois_salades&nbsp;». C’est le cas pour les tables de 9 à 26, on peut les regrouper comme suit : </span>
<span id="cb57-669"><a href="#cb57-669" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T9_T15_T21&nbsp;: ca $\otimes$ {A10 x treff x crois_salades}  </span>
<span id="cb57-670"><a href="#cb57-670" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T10_T16_T22&nbsp;: ca $\otimes$ {A10 x cj x crois_salades}  </span>
<span id="cb57-671"><a href="#cb57-671" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T11_T17_T23&nbsp;: ca $\otimes$ {A21 x treff x crois_salades}  </span>
<span id="cb57-672"><a href="#cb57-672" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T12_T18_T24&nbsp;: ca $\otimes$ {A21 x cj x crois_salades}  </span>
<span id="cb57-673"><a href="#cb57-673" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T13_T19_T25&nbsp;: ca $\otimes$ {A88 x treff x crois_salades}  </span>
<span id="cb57-674"><a href="#cb57-674" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T14_T20_T26&nbsp;: ca $\otimes$ {A88 x cj x crois_salades}  </span>
<span id="cb57-675"><a href="#cb57-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-676"><a href="#cb57-676" aria-hidden="true" tabindex="-1"></a>On en déduit donc qu’il y a deux sous-demandes indépendantes / «&nbsp;clusters&nbsp;»&nbsp;:  </span>
<span id="cb57-677"><a href="#cb57-677" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T1-T8 (cluster pizza)  </span>
<span id="cb57-678"><a href="#cb57-678" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T9-T26 (cluster salades) </span>
<span id="cb57-679"><a href="#cb57-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-680"><a href="#cb57-680" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dans chacun des clusters variables de croisement identiques ?</span></span>
<span id="cb57-681"><a href="#cb57-681" aria-hidden="true" tabindex="-1"></a>Dans chacun des clusters y a-t-il des variables de croisement identiques&nbsp;? Y a-t-il des variables de croisements liés par un lien hiérarchique&nbsp;?</span>
<span id="cb57-682"><a href="#cb57-682" aria-hidden="true" tabindex="-1"></a>Cluster pizza :  </span>
<span id="cb57-683"><a href="#cb57-683" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>les variables «&nbsp;nuts2&nbsp;» et «&nbsp;nuts3&nbsp;» font partie de la même hiérarchie «&nbsp;nuts&nbsp;», autrement dit une hiérarchie sur la zone géographique  </span>
<span id="cb57-684"><a href="#cb57-684" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>les variables A10, A21 et A88 font partie de la hiérarchie «&nbsp;NAF&nbsp;»  </span>
<span id="cb57-685"><a href="#cb57-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-686"><a href="#cb57-686" aria-hidden="true" tabindex="-1"></a>On peut donc regrouper ces variables de croisement en deux variables de croisement «&nbsp;nuts&nbsp;» et «&nbsp;NAF&nbsp;». On obtient donc 2 tableaux à protéger dans le cluster pizza :  </span>
<span id="cb57-687"><a href="#cb57-687" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T_A&nbsp;: ca_pizzas $\otimes$ {nuts x treff}  </span>
<span id="cb57-688"><a href="#cb57-688" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T_B&nbsp;: ca_pizzas $\otimes$ {naf x nuts}</span>
<span id="cb57-689"><a href="#cb57-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-690"><a href="#cb57-690" aria-hidden="true" tabindex="-1"></a>Ces deux tableaux sont liés par leur marge sur nuts. Il faut les traiter ensemble dans le même <span class="in">`tab_multi_manager()`</span>.</span>
<span id="cb57-691"><a href="#cb57-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-692"><a href="#cb57-692" aria-hidden="true" tabindex="-1"></a>Cluster salades&nbsp;:</span>
<span id="cb57-693"><a href="#cb57-693" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>les variables A10, A21 et A88 font partie de la hiérarchie «&nbsp;NAF&nbsp;»</span>
<span id="cb57-694"><a href="#cb57-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-695"><a href="#cb57-695" aria-hidden="true" tabindex="-1"></a>Ainsi, on peut réecrire les 6 tableaux écrits plus haut de cette façon :  </span>
<span id="cb57-696"><a href="#cb57-696" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T9_T15_T21&nbsp;: ca $\otimes$ {naf x treff x crois_salades}  </span>
<span id="cb57-697"><a href="#cb57-697" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T10_T16_T22&nbsp;: ca $\otimes$ {naf x cj x crois_salades}  </span>
<span id="cb57-698"><a href="#cb57-698" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T11_T17_T23&nbsp;: ca $\otimes$ {naf x treff x crois_salades}  </span>
<span id="cb57-699"><a href="#cb57-699" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T12_T18_T24&nbsp;: ca $\otimes$ {naf x cj x crois_salades}  </span>
<span id="cb57-700"><a href="#cb57-700" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T13_T19_T25&nbsp;: ca $\otimes$ {naf x treff x crois_salades}  </span>
<span id="cb57-701"><a href="#cb57-701" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T14_T20_T26&nbsp;: ca $\otimes$ {naf x cj x crois_salades}  </span>
<span id="cb57-702"><a href="#cb57-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-703"><a href="#cb57-703" aria-hidden="true" tabindex="-1"></a>On voit bien que plusieurs de ces tableaux sont en fait exactement les mêmes, donc finalement les tableaux à traiter pour ce cluster sont : </span>
<span id="cb57-704"><a href="#cb57-704" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T_C&nbsp;: ca $\otimes$ {naf x treff x crois_salades}  </span>
<span id="cb57-705"><a href="#cb57-705" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>T_D: ca $\otimes$ {naf x cj x crois_salades}  </span>
<span id="cb57-706"><a href="#cb57-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-707"><a href="#cb57-707" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tabuler les données</span></span>
<span id="cb57-708"><a href="#cb57-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-709"><a href="#cb57-709" aria-hidden="true" tabindex="-1"></a>On commence par tabuler les données pour l'indicateur "chiffre d'affaires vente pizzas".</span>
<span id="cb57-712"><a href="#cb57-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-713"><a href="#cb57-713" aria-hidden="true" tabindex="-1"></a>pizzas_tabule <span class="ot">&lt;-</span> <span class="fu">tabulate_micro_data</span>(</span>
<span id="cb57-714"><a href="#cb57-714" aria-hidden="true" tabindex="-1"></a>  micro,</span>
<span id="cb57-715"><a href="#cb57-715" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"treff"</span>),</span>
<span id="cb57-716"><a href="#cb57-716" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc_vars =</span> <span class="fu">list</span>(<span class="at">naf =</span> <span class="fu">c</span>(<span class="st">"a10"</span>,<span class="st">"a21"</span>,<span class="st">"a88"</span>), <span class="at">nuts =</span> <span class="fu">c</span>(<span class="st">"nuts2"</span>,<span class="st">"nuts3"</span>)),</span>
<span id="cb57-717"><a href="#cb57-717" aria-hidden="true" tabindex="-1"></a>  <span class="at">pond_var =</span> <span class="st">"poids"</span>,</span>
<span id="cb57-718"><a href="#cb57-718" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp_var =</span> <span class="fu">c</span>(<span class="st">"pizzas"</span>),</span>
<span id="cb57-719"><a href="#cb57-719" aria-hidden="true" tabindex="-1"></a>  <span class="at">marge_label =</span> <span class="st">"Total"</span></span>
<span id="cb57-720"><a href="#cb57-720" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-721"><a href="#cb57-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-722"><a href="#cb57-722" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pizzas_tabule)</span>
<span id="cb57-723"><a href="#cb57-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-724"><a href="#cb57-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-725"><a href="#cb57-725" aria-hidden="true" tabindex="-1"></a>On tabule ensuite pour les indicateurs "chiffre d'affaires vente mâches, batavia et salades". N.B. il faut créer une nouvelle variable de croisement.</span>
<span id="cb57-728"><a href="#cb57-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-729"><a href="#cb57-729" aria-hidden="true" tabindex="-1"></a>salades_tabule <span class="ot">&lt;-</span> <span class="fu">tabulate_micro_data</span>(</span>
<span id="cb57-730"><a href="#cb57-730" aria-hidden="true" tabindex="-1"></a>  micro,</span>
<span id="cb57-731"><a href="#cb57-731" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"treff"</span>,<span class="st">"cj"</span>),</span>
<span id="cb57-732"><a href="#cb57-732" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc_vars =</span> <span class="fu">list</span>(<span class="at">naf =</span> <span class="fu">c</span>(<span class="st">"a10"</span>,<span class="st">"a21"</span>,<span class="st">"a88"</span>)),</span>
<span id="cb57-733"><a href="#cb57-733" aria-hidden="true" tabindex="-1"></a>  <span class="at">pond_var =</span> <span class="st">"poids"</span>,</span>
<span id="cb57-734"><a href="#cb57-734" aria-hidden="true" tabindex="-1"></a>  <span class="at">resp_var =</span> <span class="fu">c</span>(<span class="st">"salades"</span>,<span class="st">"batavias"</span>,<span class="st">"maches"</span>),</span>
<span id="cb57-735"><a href="#cb57-735" aria-hidden="true" tabindex="-1"></a>  <span class="at">marge_label =</span> <span class="st">"Total"</span></span>
<span id="cb57-736"><a href="#cb57-736" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-737"><a href="#cb57-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-738"><a href="#cb57-738" aria-hidden="true" tabindex="-1"></a>salades_tabule_3var <span class="ot">&lt;-</span> salades_tabule <span class="sc">%&gt;%</span> </span>
<span id="cb57-739"><a href="#cb57-739" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb57-740"><a href="#cb57-740" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(salades_tot, maches_tot, batavias_tot, </span>
<span id="cb57-741"><a href="#cb57-741" aria-hidden="true" tabindex="-1"></a>             salades_max, maches_max, batavias_max),</span>
<span id="cb57-742"><a href="#cb57-742" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"crois_salades"</span>, <span class="st">".value"</span>),</span>
<span id="cb57-743"><a href="#cb57-743" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.*)_(tot|max)"</span></span>
<span id="cb57-744"><a href="#cb57-744" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-745"><a href="#cb57-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-746"><a href="#cb57-746" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(salades_tabule_3var)</span>
<span id="cb57-747"><a href="#cb57-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-748"><a href="#cb57-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-749"><a href="#cb57-749" aria-hidden="true" tabindex="-1"></a><span class="fu">## Poser le secret primaire</span></span>
<span id="cb57-750"><a href="#cb57-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-751"><a href="#cb57-751" aria-hidden="true" tabindex="-1"></a>Secret primaire pour les pizzas.</span>
<span id="cb57-754"><a href="#cb57-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-755"><a href="#cb57-755" aria-hidden="true" tabindex="-1"></a>pizzas_tabule <span class="ot">&lt;-</span> pizzas_tabule <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb57-756"><a href="#cb57-756" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_freq =</span> nb_obs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> nb_obs <span class="sc">&lt;</span> <span class="dv">3</span>,</span>
<span id="cb57-757"><a href="#cb57-757" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_dom =</span> (pizzas_tot <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">&amp;</span> (pizzas_max <span class="sc">&gt;</span> <span class="fl">0.85</span><span class="sc">*</span>pizzas_tot),</span>
<span id="cb57-758"><a href="#cb57-758" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_prim =</span> is_secret_freq <span class="sc">|</span> is_secret_dom</span>
<span id="cb57-759"><a href="#cb57-759" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-760"><a href="#cb57-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-761"><a href="#cb57-761" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pizzas_tabule<span class="sc">$</span>is_secret_prim)</span>
<span id="cb57-762"><a href="#cb57-762" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-763"><a href="#cb57-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-764"><a href="#cb57-764" aria-hidden="true" tabindex="-1"></a>Secret primaire pour les salades.</span>
<span id="cb57-767"><a href="#cb57-767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-768"><a href="#cb57-768" aria-hidden="true" tabindex="-1"></a>salades_tabule_3var <span class="ot">&lt;-</span> salades_tabule_3var <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb57-769"><a href="#cb57-769" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_freq =</span> nb_obs <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> nb_obs <span class="sc">&lt;</span> <span class="dv">3</span>,</span>
<span id="cb57-770"><a href="#cb57-770" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_dom =</span> (tot <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">&amp;</span> (max <span class="sc">&gt;</span> <span class="fl">0.85</span><span class="sc">*</span>tot),</span>
<span id="cb57-771"><a href="#cb57-771" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_secret_prim =</span> is_secret_freq <span class="sc">|</span> is_secret_dom</span>
<span id="cb57-772"><a href="#cb57-772" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-773"><a href="#cb57-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-774"><a href="#cb57-774" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pizzas_tabule<span class="sc">$</span>is_secret_prim)</span>
<span id="cb57-775"><a href="#cb57-775" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-776"><a href="#cb57-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-777"><a href="#cb57-777" aria-hidden="true" tabindex="-1"></a><span class="fu">## Création des listes de tableaux</span></span>
<span id="cb57-778"><a href="#cb57-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-779"><a href="#cb57-779" aria-hidden="true" tabindex="-1"></a>Pour le cluster des pizzas.</span>
<span id="cb57-782"><a href="#cb57-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-783"><a href="#cb57-783" aria-hidden="true" tabindex="-1"></a>tableaux_pizza <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb57-784"><a href="#cb57-784" aria-hidden="true" tabindex="-1"></a>  <span class="at">pizza_nuts_treff =</span> pizzas_tabule <span class="sc">%&gt;%</span> <span class="fu">filter</span>(naf <span class="sc">==</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>naf), <span class="co"># T1.T2</span></span>
<span id="cb57-785"><a href="#cb57-785" aria-hidden="true" tabindex="-1"></a>  <span class="at">pizza_nuts_naf =</span> pizzas_tabule <span class="sc">%&gt;%</span> <span class="fu">filter</span>(treff <span class="sc">==</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>treff) <span class="co"># T3.T4.T5.T6.T7.T8</span></span>
<span id="cb57-786"><a href="#cb57-786" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-787"><a href="#cb57-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-788"><a href="#cb57-788" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tableaux_pizza)</span>
<span id="cb57-789"><a href="#cb57-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-790"><a href="#cb57-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-791"><a href="#cb57-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-792"><a href="#cb57-792" aria-hidden="true" tabindex="-1"></a>Pour le cluster des salades.</span>
<span id="cb57-795"><a href="#cb57-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-796"><a href="#cb57-796" aria-hidden="true" tabindex="-1"></a>tableaux_salades <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb57-797"><a href="#cb57-797" aria-hidden="true" tabindex="-1"></a>  <span class="at">salades_naf_treff =</span> salades_tabule_3var <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cj <span class="sc">==</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>cj), <span class="co"># T9.T15.T21.T11.T17.T23.T13.T19.T25</span></span>
<span id="cb57-798"><a href="#cb57-798" aria-hidden="true" tabindex="-1"></a>  <span class="at">salades_naf_cj =</span> salades_tabule_3var <span class="sc">%&gt;%</span> <span class="fu">filter</span>(treff <span class="sc">==</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>treff) <span class="co"># T10.T16.T22.T12.T18.T24.T14.T20.T26</span></span>
<span id="cb57-799"><a href="#cb57-799" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-800"><a href="#cb57-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-801"><a href="#cb57-801" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tableaux_salades)</span>
<span id="cb57-802"><a href="#cb57-802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-803"><a href="#cb57-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-804"><a href="#cb57-804" aria-hidden="true" tabindex="-1"></a><span class="fu">## Créer les hiérarchies</span></span>
<span id="cb57-805"><a href="#cb57-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-806"><a href="#cb57-806" aria-hidden="true" tabindex="-1"></a>Comme vu dans la partie <span class="co">[</span><span class="ot">Protéger un tableau hiérarchique</span><span class="co">](#proteger-un-tableau-hierarchique)</span>, on crée les hiérarchies à l'aide de <span class="in">`rtauargus::write_hrc2()`</span>.</span>
<span id="cb57-807"><a href="#cb57-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-810"><a href="#cb57-810" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-811"><a href="#cb57-811" aria-hidden="true" tabindex="-1"></a><span class="co"># en deux temps</span></span>
<span id="cb57-812"><a href="#cb57-812" aria-hidden="true" tabindex="-1"></a>corres_naf <span class="ot">&lt;-</span> micro <span class="sc">%&gt;%</span> <span class="fu">select</span>(a10,a21,a88) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(a10,a21,a88)</span>
<span id="cb57-813"><a href="#cb57-813" aria-hidden="true" tabindex="-1"></a>chemin_hrc_naf <span class="ot">&lt;-</span> <span class="fu">write_hrc2</span>(corres_naf, <span class="at">file_name =</span> <span class="st">"fichiers_tauargus/hrc/naf.hrc"</span>)</span>
<span id="cb57-814"><a href="#cb57-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-815"><a href="#cb57-815" aria-hidden="true" tabindex="-1"></a><span class="co"># d'un seul coup</span></span>
<span id="cb57-816"><a href="#cb57-816" aria-hidden="true" tabindex="-1"></a>chemin_hrc_nuts <span class="ot">&lt;-</span> <span class="fu">write_hrc2</span>(micro <span class="sc">%&gt;%</span> <span class="fu">select</span>(nuts2,nuts3) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(nuts2),</span>
<span id="cb57-817"><a href="#cb57-817" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"fichiers_tauargus/hrc/nuts.hrc"</span>)</span>
<span id="cb57-818"><a href="#cb57-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-819"><a href="#cb57-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-820"><a href="#cb57-820" aria-hidden="true" tabindex="-1"></a>N.B. la bonne pratique est de partir d'une table de passage définie à priori. Ici, il est plus simple de partir des microdonnées et on a confiance dans les strcutures des hiérarchies qui en sortiront.</span>
<span id="cb57-821"><a href="#cb57-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-822"><a href="#cb57-822" aria-hidden="true" tabindex="-1"></a><span class="fu">## Poser le secret secondaire</span></span>
<span id="cb57-823"><a href="#cb57-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-824"><a href="#cb57-824" aria-hidden="true" tabindex="-1"></a>On pose le secret puis on unifie les masques afin de les regrouper dans un seul dataframe.</span>
<span id="cb57-825"><a href="#cb57-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-826"><a href="#cb57-826" aria-hidden="true" tabindex="-1"></a>Pour le cluster pizzas.</span>
<span id="cb57-829"><a href="#cb57-829" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-830"><a href="#cb57-830" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb57-831"><a href="#cb57-831" aria-hidden="true" tabindex="-1"></a>masques_pizza <span class="ot">&lt;-</span> <span class="fu">tab_multi_manager</span>(</span>
<span id="cb57-832"><a href="#cb57-832" aria-hidden="true" tabindex="-1"></a>  <span class="at">list_tables =</span> tableaux_pizza,</span>
<span id="cb57-833"><a href="#cb57-833" aria-hidden="true" tabindex="-1"></a>  <span class="at">list_explanatory_vars =</span> <span class="fu">list</span>(</span>
<span id="cb57-834"><a href="#cb57-834" aria-hidden="true" tabindex="-1"></a>    <span class="at">pizza_nuts_treff =</span> <span class="fu">c</span>(<span class="st">"nuts"</span>,<span class="st">"treff"</span>), <span class="co"># T1.T2</span></span>
<span id="cb57-835"><a href="#cb57-835" aria-hidden="true" tabindex="-1"></a>    <span class="at">pizza_nuts_naf =</span> <span class="fu">c</span>(<span class="st">"nuts"</span>,<span class="st">"naf"</span>) <span class="co"># T3.T4.T5.T6.T7.T8</span></span>
<span id="cb57-836"><a href="#cb57-836" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb57-837"><a href="#cb57-837" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"./Exos/tauargus_files/ex_analyse_demande/"</span>,</span>
<span id="cb57-838"><a href="#cb57-838" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc =</span> <span class="fu">list</span>(<span class="at">naf =</span> chemin_hrc_naf, <span class="at">nuts =</span> chemin_hrc_nuts),</span>
<span id="cb57-839"><a href="#cb57-839" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="st">"Total"</span>,</span>
<span id="cb57-840"><a href="#cb57-840" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"pizzas_tot"</span>,</span>
<span id="cb57-841"><a href="#cb57-841" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="st">"nb_obs"</span>,</span>
<span id="cb57-842"><a href="#cb57-842" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_prim"</span></span>
<span id="cb57-843"><a href="#cb57-843" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-844"><a href="#cb57-844" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-845"><a href="#cb57-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-848"><a href="#cb57-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-849"><a href="#cb57-849" aria-hidden="true" tabindex="-1"></a><span class="co"># unification des masques</span></span>
<span id="cb57-850"><a href="#cb57-850" aria-hidden="true" tabindex="-1"></a>masque_pizza <span class="ot">&lt;-</span> masques_pizza <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb57-851"><a href="#cb57-851" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(tab){</span>
<span id="cb57-852"><a href="#cb57-852" aria-hidden="true" tabindex="-1"></a>    tab <span class="sc">%&gt;%</span> </span>
<span id="cb57-853"><a href="#cb57-853" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb57-854"><a href="#cb57-854" aria-hidden="true" tabindex="-1"></a>        <span class="at">treff =</span> <span class="cf">if</span> (<span class="st">"treff"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) treff <span class="cf">else</span> <span class="st">"Total"</span>,</span>
<span id="cb57-855"><a href="#cb57-855" aria-hidden="true" tabindex="-1"></a>        <span class="at">cj =</span> <span class="cf">if</span> (<span class="st">"cj"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) cj <span class="cf">else</span> <span class="st">"Total"</span>,</span>
<span id="cb57-856"><a href="#cb57-856" aria-hidden="true" tabindex="-1"></a>        <span class="at">naf =</span> <span class="cf">if</span> (<span class="st">"naf"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) naf <span class="cf">else</span> <span class="st">"Total"</span></span>
<span id="cb57-857"><a href="#cb57-857" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb57-858"><a href="#cb57-858" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="st">"naf"</span>,<span class="st">"treff"</span>,<span class="st">"cj"</span>,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb57-859"><a href="#cb57-859" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span><span class="st">"is_secret_final"</span>, <span class="fu">last_col</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb57-860"><a href="#cb57-860" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb57-861"><a href="#cb57-861" aria-hidden="true" tabindex="-1"></a>        <span class="at">statut_final =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-862"><a href="#cb57-862" aria-hidden="true" tabindex="-1"></a>          is_secret_freq <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb57-863"><a href="#cb57-863" aria-hidden="true" tabindex="-1"></a>          is_secret_dom <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb57-864"><a href="#cb57-864" aria-hidden="true" tabindex="-1"></a>          is_secret_final <span class="sc">~</span><span class="st">"D"</span>,</span>
<span id="cb57-865"><a href="#cb57-865" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"V"</span></span>
<span id="cb57-866"><a href="#cb57-866" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">%&gt;%</span> </span>
<span id="cb57-867"><a href="#cb57-867" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"is_secret_"</span>))</span>
<span id="cb57-868"><a href="#cb57-868" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-869"><a href="#cb57-869" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb57-870"><a href="#cb57-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-871"><a href="#cb57-871" aria-hidden="true" tabindex="-1"></a>masque_pizza <span class="sc">%&gt;%</span> </span>
<span id="cb57-872"><a href="#cb57-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(statut_final) <span class="sc">%&gt;%</span> </span>
<span id="cb57-873"><a href="#cb57-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb57-874"><a href="#cb57-874" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cell =</span> <span class="fu">n</span>(),</span>
<span id="cb57-875"><a href="#cb57-875" aria-hidden="true" tabindex="-1"></a>    <span class="at">val_cell =</span> <span class="fu">sum</span>(pizzas_tot)</span>
<span id="cb57-876"><a href="#cb57-876" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb57-877"><a href="#cb57-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-878"><a href="#cb57-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_n_cell =</span> n_cell<span class="sc">/</span><span class="fu">sum</span>(n_cell)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb57-879"><a href="#cb57-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_val_cell =</span> val_cell<span class="sc">/</span><span class="fu">sum</span>(val_cell)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb57-880"><a href="#cb57-880" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-881"><a href="#cb57-881" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-882"><a href="#cb57-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-883"><a href="#cb57-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-884"><a href="#cb57-884" aria-hidden="true" tabindex="-1"></a>Pour le cluster salades.</span>
<span id="cb57-887"><a href="#cb57-887" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-888"><a href="#cb57-888" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb57-889"><a href="#cb57-889" aria-hidden="true" tabindex="-1"></a>masques_salades <span class="ot">&lt;-</span> <span class="fu">tab_multi_manager</span>(</span>
<span id="cb57-890"><a href="#cb57-890" aria-hidden="true" tabindex="-1"></a>  <span class="at">list_tables =</span> tableaux_salades,</span>
<span id="cb57-891"><a href="#cb57-891" aria-hidden="true" tabindex="-1"></a>  <span class="at">list_explanatory_vars =</span> <span class="fu">list</span>(</span>
<span id="cb57-892"><a href="#cb57-892" aria-hidden="true" tabindex="-1"></a>    <span class="at">salades_naf_treff =</span> <span class="fu">c</span>(<span class="st">"naf"</span>,<span class="st">"treff"</span>, <span class="st">"crois_salades"</span>),</span>
<span id="cb57-893"><a href="#cb57-893" aria-hidden="true" tabindex="-1"></a>    <span class="at">salades_naf_cj =</span> <span class="fu">c</span>(<span class="st">"naf"</span>,<span class="st">"cj"</span>, <span class="st">"crois_salades"</span>)</span>
<span id="cb57-894"><a href="#cb57-894" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb57-895"><a href="#cb57-895" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir_name =</span> <span class="st">"./Exos/tauargus_files/ex_analyse_demande/"</span>,</span>
<span id="cb57-896"><a href="#cb57-896" aria-hidden="true" tabindex="-1"></a>  <span class="at">hrc =</span> <span class="fu">list</span>(<span class="at">naf =</span> chemin_hrc_naf),</span>
<span id="cb57-897"><a href="#cb57-897" aria-hidden="true" tabindex="-1"></a>  <span class="at">totcode =</span> <span class="fu">c</span>(<span class="at">naf =</span> <span class="st">"Total"</span>, <span class="at">treff =</span> <span class="st">"Total"</span>, <span class="at">cj =</span> <span class="st">"Total"</span>, <span class="at">crois_salades =</span> <span class="st">"salades"</span>),</span>
<span id="cb57-898"><a href="#cb57-898" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"tot"</span>,</span>
<span id="cb57-899"><a href="#cb57-899" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> <span class="st">"nb_obs"</span>,</span>
<span id="cb57-900"><a href="#cb57-900" aria-hidden="true" tabindex="-1"></a>  <span class="at">secret_var =</span> <span class="st">"is_secret_prim"</span></span>
<span id="cb57-901"><a href="#cb57-901" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-902"><a href="#cb57-902" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-903"><a href="#cb57-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-906"><a href="#cb57-906" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-907"><a href="#cb57-907" aria-hidden="true" tabindex="-1"></a>masque_salades <span class="ot">&lt;-</span> masques_salades <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb57-908"><a href="#cb57-908" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(tab){</span>
<span id="cb57-909"><a href="#cb57-909" aria-hidden="true" tabindex="-1"></a>    tab <span class="sc">%&gt;%</span> </span>
<span id="cb57-910"><a href="#cb57-910" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb57-911"><a href="#cb57-911" aria-hidden="true" tabindex="-1"></a>        <span class="at">treff =</span> <span class="cf">if</span> (<span class="st">"treff"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) treff <span class="cf">else</span> <span class="st">"Total"</span>,</span>
<span id="cb57-912"><a href="#cb57-912" aria-hidden="true" tabindex="-1"></a>        <span class="at">cj =</span> <span class="cf">if</span> (<span class="st">"cj"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) cj <span class="cf">else</span> <span class="st">"Total"</span>,</span>
<span id="cb57-913"><a href="#cb57-913" aria-hidden="true" tabindex="-1"></a>        <span class="at">naf =</span> <span class="cf">if</span> (<span class="st">"naf"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab)) naf <span class="cf">else</span> <span class="st">"Total"</span></span>
<span id="cb57-914"><a href="#cb57-914" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb57-915"><a href="#cb57-915" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="st">"naf"</span>,<span class="st">"treff"</span>,<span class="st">"cj"</span>,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb57-916"><a href="#cb57-916" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span><span class="st">"is_secret_final"</span>, <span class="fu">last_col</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb57-917"><a href="#cb57-917" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb57-918"><a href="#cb57-918" aria-hidden="true" tabindex="-1"></a>        <span class="at">statut_final =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-919"><a href="#cb57-919" aria-hidden="true" tabindex="-1"></a>          is_secret_freq <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb57-920"><a href="#cb57-920" aria-hidden="true" tabindex="-1"></a>          is_secret_dom <span class="sc">~</span> <span class="st">"B"</span>,</span>
<span id="cb57-921"><a href="#cb57-921" aria-hidden="true" tabindex="-1"></a>          is_secret_final <span class="sc">~</span><span class="st">"D"</span>,</span>
<span id="cb57-922"><a href="#cb57-922" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"V"</span></span>
<span id="cb57-923"><a href="#cb57-923" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">%&gt;%</span> </span>
<span id="cb57-924"><a href="#cb57-924" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"is_secret_"</span>))</span>
<span id="cb57-925"><a href="#cb57-925" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-926"><a href="#cb57-926" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb57-927"><a href="#cb57-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-928"><a href="#cb57-928" aria-hidden="true" tabindex="-1"></a>masque_salades <span class="sc">%&gt;%</span> </span>
<span id="cb57-929"><a href="#cb57-929" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(statut_final) <span class="sc">%&gt;%</span> </span>
<span id="cb57-930"><a href="#cb57-930" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb57-931"><a href="#cb57-931" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cell =</span> <span class="fu">n</span>(),</span>
<span id="cb57-932"><a href="#cb57-932" aria-hidden="true" tabindex="-1"></a>    <span class="at">val_cell =</span> <span class="fu">sum</span>(tot)</span>
<span id="cb57-933"><a href="#cb57-933" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb57-934"><a href="#cb57-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-935"><a href="#cb57-935" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_n_cell =</span> n_cell<span class="sc">/</span><span class="fu">sum</span>(n_cell)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb57-936"><a href="#cb57-936" aria-hidden="true" tabindex="-1"></a>    <span class="at">pc_val_cell =</span> val_cell<span class="sc">/</span><span class="fu">sum</span>(val_cell)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb57-937"><a href="#cb57-937" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-938"><a href="#cb57-938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 - Insee</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Site réalisé avec Quarto</p>
</div>
  </div>
</footer>




</body></html>